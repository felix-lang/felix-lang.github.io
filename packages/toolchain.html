<html><head>
<style type="text/css">
body {margin:3%; }
h1 {color:gray; font-size:120%;}
h2 {color:gray; font-size:105%;}
h3 {font-size:100%;}
h4 {font-size:95%;}
h5 {font-size:95%;}
span.fstring {color:darkblue; font-style:italic; }
span.comment {font-family:arial; color:blue; font-style:italic; }
span.doccomment {font-family:arial; color:green; font-style:italic; }
span.big_keyword {color:#FF1010; }
span.small_keyword {color:#802040; }
span.qualifier {color:#A02020; }
span.library {color:#A02000; }
span.ctor {color:#406020; }
span.hack {color:#66DD00; }
span.preproc {color:#005500; }
span.embedded_c{background-color:#DDDDDD; }
span.fpc_fieldname {color:#DD0000; }
span.lineno {color:#101010; background-color:#E0E0E0; font-size:80%; font-family:"courier",monospace; font-style:normal; }
pre.flxbg {background-color:#A0FFA0; color:black; padding:2px; box-shadow:5px 5px 2px #807080; }
pre.uncheckedflxbg {background-color:#D0D0D0; color:black; padding:2px; box-shadow:5px 5px 2px #807080; }
pre.cppbg {background-color:#80FF80; color:black; }
pre.prefmtbg {background-color:#D0D0D0; color:black; }
pre.expected {background-color:#E0FF80; color:black; }
pre.input {background-color:#E08080; color:black; }
pre.inclusion {background-color:#D070D0; color:black; }
code.inclusion {background-color:#D070D0; color:black; }
.obsolete { background-color:#FFEFEF; font-size: small; color:black; }
.future { background-color:#FF8080; font-size: small; color:black; }
.implementation_detail { background-color:#E0E0E0; font-size: small; color:black;  }
.bug { background-color:#FFE0E0; font-size: small; color:black; }
.fixed{ background-color:#FFE0E0; font-size: small; color:black; }
.done { background-color:#FFE0E0; font-size: small; color:black; }
.caveat { background-color:#FF8080; color:black; }
</style>
<title>C and C++ toolchains</title></head><body>
<style>
body {margin:3%; font-family: sans-serif; }
h1 {color:black; font-size:120%; border-bottom: 2px solid #ddd; padding: 0 0 3px 0;}
h2 {color:#202020; font-size:105%;}
h3 {font-size:100%;}
h4 {font-size:95%;}
h5 {font-size:95%;}
span.fstring {color:darkblue; font-style:italic; }
span.comment {font-family:arial; color:blue; font-style:italic; }
span.doccomment {font-family:arial; color:green; font-style:italic; }
span.big_keyword {color:#FF1010; }
span.small_keyword {color:#802040; }
span.qualifier {color:#A02020; }
span.library {color:#A02000; }
span.ctor {color:#406020; }
span.hack {color:#66DD00; }
span.preproc {color:#005500; }
span.embedded_c{background-color:#DDDDDD; }
span.fpc_fieldname {color:#DD0000; }
span.lineno {color:#101010; background-color:#E0E0E0; font-size:80%; font-family:"courier",monospace; font-style:normal; }
pre { border: 1px solid #ccc; color: black; box-shadow:3px 3px 2px rgba(0,0,0,0.1); padding:2px; }
pre.flxbg {background-color:#C2FDC2; box-shadow:3px 3px 2px rgba(0,0,0,0.1) }
pre.uncheckedflxbg {background-color:#eee; box-shadow:3px 3px 2px rgba(0,0,0,0.1); }
pre.cppbg {background-color:#C2FDC2; }
pre.prefmtbg {background-color:#F1F1F1; }
pre.expected {background-color:hsla(74,94%,88%,1); }
pre.input {background-color:hsla(20,94%,88%,1); }
pre.inclusion {
    font-family: Arial;
    font-weight: normal;
    font-size: 0.9em;
    color: #555;
    border: none;
    box-shadow: none;
    text-align: right;
    margin: -7px 11px -12px 0;
    padding: 0;
    background-color:#fafafa;
}
code.inclusion {background-color:#D070D0; color:black; }
.obsolete { background-color:#FFEFEF; font-size: small; color:black; }
.future { background-color:#FF8080; font-size: small; color:black; }
.implementation_detail { background-color:#E0E0E0; font-size: small; color:black;  }
.bug { background-color:#FFE0E0; font-size: small; color:black; }
.fixed{ background-color:#FFE0E0; font-size: small; color:black; }
.done { background-color:#FFE0E0; font-size: small; color:black; }
.caveat { background-color:hsla(0,100%,91%,1); color:black; padding: 0.6em; }
.container {
  position: fixed;
  top:0px;
  left:0px;
  height : 100%;
  width: 100%;
  background-color: grey;
  margin: 0px;
  padding: 0px;
  border-width: 0px;
  color: #404040;
}
.maincontent {
  padding:4px;
  padding-left:8px;
  line-height:1.3em;
  color:#404040; background-color:#fafafa;
}
.maincontent h1 { margin-left:-8px; position: relative; font-family: georgia, serif; font-size: 1.8em; font-weight: normal; }
.maincontent h2 { margin-left:-8px; position: relative; margin-bottom:-5px; }
.maincontent h3 { margin-left:-8px; position: relative; margin-bottom:-5px; }
.maincontent h4 { margin-left:-8px; position: relative; margin-bottom:-5px; }
.maincontent code { color:#902030; }
.toppanel {
  position:absolute; left:0px; top:0px; height:20px; right:0px;
  background-color: #e0e0e0;
}
.bottompanel {
  position:absolute; left:0px; top:22px; bottom:0px; right:0px;
  background-color: #fafafa;
  font-size:14px;
}
.leftpanel {
  position:absolute; left:0px; top:0px; bottom:0px; width: 150px;
  background-color: #eaeaea; overflow: auto;
}
.rightpanel {
  position:absolute; right: 0px; left:160px; top:0px; bottom: 0px;
  background-color: #fafafa; overflow: auto;
}
.divider {
  position:absolute; left: 150px; top:0px; bottom:0px;
  background-color: black; width:2px;
  box-shadow: 0 0 8px #000;
}

#panemover {
    position:absolute;
    left: 150px;
    width : 10px;
    top: 0px;
    bottom: 0px;
    opacity: 0.3;
    cursor:col-resize;
}

div.m {
    margin: 0px;
    padding:0px;
    border-width:2px;
    border-color: green;
}

div.m1 {
    background-color: #86E870;
    border-style:outset;
    border-color:#ccc;
    border-width:2px 0;
    font-size:90%;
    padding: 1px 0 2px 10px;
}

div.m2 {
    background-color: #70C070;
    padding-left:15px;
    padding-top:2px;
    border-style:outset;
    border-color:green;
    border-width:0 0 1px 0;
    font-size:80%;
}

div.m1:hover, div.m2:hover {
    background-color: white;
}

#leftmargintoc a {
    text-decoration: none;
    color: #404040;
}
</style>

<style>
div.m {
    margin: 0px;
    padding:0px;
    border-width:2px;
    border-color: green;
}

div.m1 {
    background-color: #86E870;
    border-style:outset;
    border-color:#ccc;
    border-width:2px 0;
    font-size:90%;
    padding: 1px 0 2px 10px;
}

div.m2 {
    background-color: #70C070;
    padding-left:15px;
    padding-top:2px;
    border-style:outset;
    border-color:green;
    border-width:0 0 1px 0;
    font-size:80%;
}

div.m1:hover, div.m2:hover {
    background-color: white;
}

#leftmargintoc a {
    text-decoration: none;
    color: #404040;
}


</style>

    <script async="true">
      function dragStart(e, left, right){
        document.getElementById("panemover").style.width="70%";
        document.getElementById("panemover").style.left="50px";
        mousedown = true;
        x = e.clientX
        dragOffsetLeft =
          document.getElementById(left).getBoundingClientRect().right -
          document.getElementById(left).getBoundingClientRect().left -
          x
        ;
        dragOffsetDivider= document.getElementById("divider").getBoundingClientRect().left - x;
        dragOffsetRight = document.getElementById(right).getBoundingClientRect().left - x;
      }
      function dragRelease(){
        document.getElementById('panemover').style.width = '10px';
        document.getElementById('panemover').style.left = document.getElementById('divider').offsetLeft + 'px';
        mousedown = false;
      }
      function drag(e, left, right){
        if(!mousedown){return}
        x = e.clientX
        tmpLeft = dragOffsetLeft + x
        tmpDivider= dragOffsetDivider + x
        tmpRight = dragOffsetRight + x
        document.getElementById(left).style.width= tmpLeft + 'px';
        document.getElementById("divider").style.left= tmpDivider + 'px';
        document.getElementById(right).style.left = tmpRight + 'px';
      };
    </script>

<script type="text/javascript">

  function mexpand(id)
  {
    var n = document.getElementById(id).style;
    n.display = "block";
  }

  function mcollapse(id)
  {
    var n = document.getElementById(id).style;
    n.display = "none";
  }

  var counter_max = 0;
  function mshow(id,loc)
  {
    var i;
    for(i=1; i<=counter_max; ++i)
      mcollapse("menu"+String(i));
    mexpand(id);
    window.location.replace(loc);
  }
</script>

<script type="text/javascript">

function expand(but,id)
{
  var n = document.getElementById(id).style;
  var button = document.getElementById(but);
  button.src = "/share/src/web/images/minus.gif";
  button.alt = "-";
  n.display = "block";
}
function collapse(but,id)
{
  var n = document.getElementById(id).style;
  var button = document.getElementById(but);
  button.src = "/share/src/web/images/plus.gif";
  button.alt = "+";
  n.display = "none";
}
function toggle(button,id)
{
  var n = document.getElementById(id).style;
  if (n.display == "none")
  {
    button.src = "/share/src/web/images/minus.gif";
    button.alt = "-";
    n.display = "block";
  }
  else
  {
    button.src = "/share/src/web/images/plus.gif";
    button.alt = "+";
    n.display = "none";
  }
}
var allbuttons = [
"Find C++ packages.",
"Toolchain support",
"Generic C/C++ compiler",
"Dependency Checker",
"Library Builder",
"Toolchains",
"Object for gcc on Linux",
"Object for gcc on OSX",
"Object for clang on Linux",
"Object for clang on OSX",
"Cygwin interface.",
"Cygwin config",
"Object for MSVC++ on Windows",
"Object for clang on iOS",
"Toolchain Plugins",
"iPhone Plugin",
"Plugin for gcc on Linux",
"Plugin for gcc on OSX",
"Plugin for clang on Linux",
"Plugin for clang on OSX",
"MSVC++ Plugin for Win32",
"Flx Plugin"
];
function expand_all(dummy)
{
  for (i in allbuttons)
  {
    expand(allbuttons[i], allbuttons[i]+"_d");
  }
}
function collapse_all(dummy)
{
  for (i in allbuttons)
  {
    collapse(allbuttons[i], allbuttons[i]+"_d");
  }
}
</script>

<script>
function mouseover(id)
{
  var elt = document.getElementById(id);
  elt.style.display="none";
  var elt2 = document.getElementById(id+"_mo");
  elt2.style.display="inline";
}

function mouseout(id)
{
  var elt = document.getElementById(id+"_mo");
  elt.style.display="none";
  var elt2 = document.getElementById(id);
  elt2.style.display="inline";
}

</script>
<script> function nop(dummy) {} </script>
    <div class="container">
      <div class="toppanel">
    <!--Main Content top navbar-->
<span style="position:relative; bottom:6px"
  onmouseover="mouseover('expand')"
  onmouseout="mouseout('expand')"
  onclick="expand_all('expand')"
  ><span id="expand"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:blue;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Expand</text></svg></span><span id="expand_mo" style="display:none"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:red;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Expand</text></svg></span></span><span style="position:relative; bottom:6px"
  onmouseover="mouseover('collapse')"
  onmouseout="mouseout('collapse')"
  onclick="collapse_all('collapse')"
  ><span id="collapse"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:blue;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Collapse</text></svg></span><span id="collapse_mo" style="display:none"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:red;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Collapse</text></svg></span></span>    <!--Main Content top navbar End-->

      </div> <!-- toppanel end -->
      <div class="bottompanel">
        <span id="divider" class="divider"></span>

        <span id="left" class="leftpanel" >
          <div class="menucontent">
  <!--Left Margin Toc-->
  <div id="leftmargintoc">
    <!--Left Margin Toc Main Contents-->
      <div class=m1 onclick="mshow('menu1','#Find C++ packages._h')"> <a href="#Find_C++_packages._h">Find C++ packages.</a></div>
      <div class=sm id=menu1>
      </div>
      <div class=m1 onclick="mshow('menu2','#Toolchain support_h')"> <a href="#Toolchain_support_h">Toolchain support</a></div>
      <div class=sm id=menu2>
      </div>
      <div class=m1 onclick="mshow('menu3','#Generic C/C++ compiler_h')"> <a href="#Generic_C/C++_compiler_h">Generic C/C++ compiler</a></div>
      <div class=sm id=menu3>
      </div>
      <div class=m1 onclick="mshow('menu4','#Dependency Checker_h')"> <a href="#Dependency_Checker_h">Dependency Checker</a></div>
      <div class=sm id=menu4>
      </div>
      <div class=m1 onclick="mshow('menu5','#Library Builder_h')"> <a href="#Library_Builder_h">Library Builder</a></div>
      <div class=sm id=menu5>
      </div>
      <div class=m1 onclick="mshow('menu6','#Toolchains_h')"> <a href="#Toolchains_h">Toolchains</a></div>
      <div class=sm id=menu6>
      <div class=m2><a href="#Object_for_gcc_on_Linux_h">Object for gcc on Linux</a></div>
      <div class=m2><a href="#Object_for_gcc_on_OSX_h">Object for gcc on OSX</a></div>
      <div class=m2><a href="#Object_for_clang_on_Linux_h">Object for clang on Linux</a></div>
      <div class=m2><a href="#Object_for_clang_on_OSX_h">Object for clang on OSX</a></div>
      <div class=m2><a href="#Cygwin_interface._h">Cygwin interface.</a></div>
      <div class=m2><a href="#Cygwin_config_h">Cygwin config</a></div>
      <div class=m2><a href="#Object_for_MSVC++_on_Windows_h">Object for MSVC++ on Windows</a></div>
      <div class=m2><a href="#Object_for_clang_on_iOS_h">Object for clang on iOS</a></div>
      </div>
      <div class=m1 onclick="mshow('menu7','#Toolchain Plugins_h')"> <a href="#Toolchain_Plugins_h">Toolchain Plugins</a></div>
      <div class=sm id=menu7>
      <div class=m2><a href="#iPhone_Plugin_h">iPhone Plugin</a></div>
      <div class=m2><a href="#Plugin_for_gcc_on_Linux_h">Plugin for gcc on Linux</a></div>
      <div class=m2><a href="#Plugin_for_gcc_on_OSX_h">Plugin for gcc on OSX</a></div>
      <div class=m2><a href="#Plugin_for_clang_on_Linux_h">Plugin for clang on Linux</a></div>
      <div class=m2><a href="#Plugin_for_clang_on_OSX_h">Plugin for clang on OSX</a></div>
      <div class=m2><a href="#MSVC++_Plugin_for_Win32_h">MSVC++ Plugin for Win32</a></div>
      </div>
      <div class=m1 onclick="mshow('menu8','#Flx Plugin_h')"> <a href="#Flx_Plugin_h">Flx Plugin</a></div>
      <div class=sm id=menu8>
      </div>
    <script>counter_max=8;</script>
  </div>
  <!--End Left Margin Toc-->

          </div> <!-- leftpanel contents end -->
        </span> <!-- leftpanel end -->

        <span id="right" class="rightpanel">
          <div class="maincontent">
<!--Main Content Body-->
<h1 id='Find_C++_packages._h'><img src='/share/src/web/images/minus.gif' id='Find C++ packages.' onclick='toggle(this,"Find_C++_packages._d")' alt='+'/> 1 Find C++ packages.</h1><div id='Find_C++_packages._d' style='display:block'>
<p>Doesn't really belong here but had to go somewhere!
</p><p>Scans a C or C++ files and produces a list of required packages
on standard output. To be redirected to a *.resh file.
</p><p>Felix compiler generates *.resh file for Felix generated C++,
and puts the #include "filename.includes" into filename.hpp.
For C++ only builds, the user has to put the #include in themselves.
The resulting C++ won't work. This tool makes the filename.resh
file which can then be fed to flx_pkgconfig along with a request
for the include field, to help generate the include file.
</p><pre class='inclusion'>
$PWD/src/tools/flx_find_cxx_packages.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  
<span class="lineno" id=line2></span>  <span class="comment">// FIXME: this function cut and paste from flx.html</span>
<span class="lineno" id=line3></span>  <span class="comment">// hidden inside an object</span>
<span class="lineno" id=line4></span>  
<span class="lineno" id=line5></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> find_cxx_pkgs (src:<span class="library" title="binding of C++ string type">string</span>) : <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>] =
<span class="lineno" id=line6></span>    {
<span class="lineno" id=line7></span>      <span class="comment">//eprintln$ "[flx_find_cxx_pkgs] Scanning " + src + " for package requirements";</span>
<span class="lineno" id=line8></span>      <span class="big_keyword" title="Define a mutable variable">var</span> out = Empty[<span class="library" title="binding of C++ string type">string</span>];
<span class="lineno" id=line9></span>      <span class="big_keyword" title="Define a mutable variable">var</span> pat = RE2(<span class="fstring">'.*@requires package ([A-Za-z][A-Za-z0-9_-]*).*'</span>);
<span class="lineno" id=line10></span>      <span class="big_keyword" title="Define a mutable variable">var</span> f = fopen_input_text src;
<span class="lineno" id=line11></span>      <span class="small_keyword" title="conditional">if</span> valid f <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line12></span>        <span class="small_keyword" title="for loop">for</span> line <span class="small_keyword" title="membership operator, function mem">in</span> f <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line13></span>          <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = Match (pat,line);
<span class="lineno" id=line14></span>          <span class="small_keyword" title="match statement or expression">match</span> <span class="small_keyword" title="value of function return used in post condition">result</span> <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line15></span>          | #None =&gt; ;
<span class="lineno" id=line16></span>          | Some v =&gt; out = v.1  + out;
<span class="lineno" id=line17></span>          <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line18></span>        <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line19></span>        fclose f;
<span class="lineno" id=line20></span>      <span class="small_keyword" title="conditional">else</span>
<span class="lineno" id=line21></span>        eprintln(<span class="fstring">"Can't find C++ source file "</span> + src);
<span class="lineno" id=line22></span>        System::exit(1);
<span class="lineno" id=line23></span>      <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line24></span>      out = <span class="library" title="return data structure with elements reversed">rev</span> out;
<span class="lineno" id=line25></span>      <span class="comment">//if out != Empty[string] call</span>
<span class="lineno" id=line26></span>      <span class="comment">//  eprintln$ "[flx_find_cxx_packages] C++ file "+src+" requires packages " + str (out);</span>
<span class="lineno" id=line27></span>      <span class="small_keyword" title="return">return</span> out;
<span class="lineno" id=line28></span>    }
<span class="lineno" id=line29></span>  
<span class="lineno" id=line30></span>  
<span class="lineno" id=line31></span>  
<span class="lineno" id=line32></span>  <span class="big_keyword" title="Define a mutable variable">var</span> filename = System::argv_dflt 1 <span class="fstring">""</span>;
<span class="lineno" id=line33></span>  <span class="small_keyword" title="conditional">if</span> filename == <span class="fstring">""</span> <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line34></span>    <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"Usage: flx_find_cxx_packages filename.cxx &gt; filename.resh"</span>;
<span class="lineno" id=line35></span>    System::exit 1;
<span class="lineno" id=line36></span>  <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line37></span>  
<span class="lineno" id=line38></span>  <span class="big_keyword" title="Define a mutable variable">var</span> pkgs = find_cxx_pkgs filename;
<span class="lineno" id=line39></span>  
<span class="lineno" id=line40></span>  <span class="small_keyword" title="for loop">for</span> pkg <span class="small_keyword" title="membership operator, function mem">in</span> pkgs perform <span class="library" title="Print a string to standard output with newline appended">println</span>$ pkg;
</pre></p><pre class='inclusion'>
$PWD/src/tools/flx_gen_cxx_includes.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/flx_pkgconfig"</span>;
<span class="lineno" id=line2></span>   
<span class="lineno" id=line3></span>  <span class="big_keyword" title="Define a mutable variable">var</span> pkgconfig_flags = tail #System::args;
<span class="lineno" id=line4></span>  <span class="comment">//println$ "Args to flx_gen_cxx_includes=" + pkgconfig_flags.str;</span>
<span class="lineno" id=line5></span>  
<span class="lineno" id=line6></span>  <span class="big_keyword" title="Define a mutable variable">var</span> infile = stdin;
<span class="lineno" id=line7></span>  <span class="big_keyword" title="Define a mutable variable">var</span> pkgdata = load infile;
<span class="lineno" id=line8></span>  <span class="big_keyword" title="Define a mutable variable">var</span> pkgs = split (pkgdata, <span class="fstring">"\n"</span>);
<span class="lineno" id=line9></span>  pkgs = filter (<span class="big_keyword" title="Define a function with no side-effects">fun</span> (x:<span class="library" title="binding of C++ string type">string</span>) =&gt; x != <span class="fstring">""</span>) pkgs;
<span class="lineno" id=line10></span>  <span class="comment">//for pkg in pkgs perform println$ "PKG=" +  pkg;</span>
<span class="lineno" id=line11></span>  <span class="comment">//var err, result = System::get_stdout("flx_pkgconfig " + cat " " pkgconfig_flags + " --field=includes " + cat " " pkgs);</span>
<span class="lineno" id=line12></span>  <span class="big_keyword" title="Define a mutable variable">var</span> allargs = pkgconfig_flags + <span class="fstring">"--field=includes"</span> + pkgs;
<span class="lineno" id=line13></span>  <span class="comment">//println$ "Calling flx_pkgconfig with args = " + allargs.str;</span>
<span class="lineno" id=line14></span>  <span class="big_keyword" title="Define a mutable variable">var</span> err,<span class="small_keyword" title="value of function return used in post condition">result</span> = FlxPkgConfig::flx_pkgconfig(allargs);
<span class="lineno" id=line15></span>  
<span class="lineno" id=line16></span>  <span class="small_keyword" title="conditional">if</span> err == 0 <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line17></span>    <span class="comment">//println$ "Result = " + result;</span>
<span class="lineno" id=line18></span>    <span class="comment">//var files = split (result," "); // won't work on Windows well ... spaces .. ugg</span>
<span class="lineno" id=line19></span>    <span class="big_keyword" title="Define a mutable variable">var</span> files = <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line20></span>    <span class="small_keyword" title="for loop">for</span> file <span class="small_keyword" title="membership operator, function mem">in</span> files perform <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"#include "</span> + file;
<span class="lineno" id=line21></span>  <span class="small_keyword" title="conditional">else</span>
<span class="lineno" id=line22></span>    eprintln$ <span class="fstring">"Error "</span> + err.<span class="library" title="Convert a value to a string">str</span> + <span class="fstring">" running flx_pkgconfig"</span>;
<span class="lineno" id=line23></span>  <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line24></span>  
</pre></p></div><h1 id='Toolchain_support_h'><img src='/share/src/web/images/minus.gif' id='Toolchain support' onclick='toggle(this,"Toolchain_support_d")' alt='+'/> 2 Toolchain support</h1><div id='Toolchain_support_d' style='display:block'>
<pre class='inclusion'>
share/lib/std/felix/toolchain_config.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  
<span class="lineno" id=line2></span>  <span class="big_keyword" title="Define an alias for a type expression">typedef</span> toolchain_config_t = (
<span class="lineno" id=line3></span>    c_compiler_executable: <span class="library" title="binding of C++ string type">string</span>,
<span class="lineno" id=line4></span>    cxx_compiler_executable: <span class="library" title="binding of C++ string type">string</span>,
<span class="lineno" id=line5></span>    header_search_dirs: <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line6></span>    macros : <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line7></span>    library_search_dirs: <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line8></span>    ccflags: <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line9></span>    dynamic_libraries: <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line10></span>    static_libraries: <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line11></span>    debugln : <span class="library" title="binding of C++ string type">string</span> -&gt; <span class="library" title="Type with no values, returning void indicates a procedure">void</span>
<span class="lineno" id=line12></span>  );
<span class="lineno" id=line13></span>  
</pre></p><pre class='inclusion'>
share/lib/std/felix/toolchain_interface.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="define an object interface">interface</span> toolchain_t {
<span class="lineno" id=line2></span>    whatami : 1 -&gt; <span class="library" title="binding of C++ string type">string</span>;
<span class="lineno" id=line3></span>    host_os : 1 -&gt; <span class="library" title="binding of C++ string type">string</span>;
<span class="lineno" id=line4></span>    target_os : 1 -&gt; <span class="library" title="binding of C++ string type">string</span>;
<span class="lineno" id=line5></span>    cxx_compiler_vendor : 1 -&gt; <span class="library" title="binding of C++ string type">string</span>;
<span class="lineno" id=line6></span>  
<span class="lineno" id=line7></span>    <span class="comment">// Note: this information is available for</span>
<span class="lineno" id=line8></span>    <span class="comment">// the host platform in the Filename class.</span>
<span class="lineno" id=line9></span>    <span class="comment">// and for any platform using the Filename_class[os]</span>
<span class="lineno" id=line10></span>    <span class="comment">// class. The methods below, however, reflect a cross-compilation</span>
<span class="lineno" id=line11></span>    <span class="comment">// target filesystem. For example, on Linux with shared libs .so</span>
<span class="lineno" id=line12></span>    <span class="comment">// you can target Windows with shared libs .dll if you have a</span>
<span class="lineno" id=line13></span>    <span class="comment">// cross compiler.</span>
<span class="lineno" id=line14></span>    <span class="comment">//</span>
<span class="lineno" id=line15></span>    <span class="comment">// This toolchain facility should be separated from</span>
<span class="lineno" id=line16></span>    <span class="comment">// the compiler object, even though the extensions are primarily</span>
<span class="lineno" id=line17></span>    <span class="comment">// about compiler product file names, because other tools may wish</span>
<span class="lineno" id=line18></span>    <span class="comment">// to assist building by, for example, deleting all object files.</span>
<span class="lineno" id=line19></span>    <span class="comment">// Currently you'd have to instantiate a toolchain object to find</span>
<span class="lineno" id=line20></span>    <span class="comment">// this information, needlessly providing dummy header files,</span>
<span class="lineno" id=line21></span>    <span class="comment">// macros, etc, which are primarily useful to compilers.</span>
<span class="lineno" id=line22></span>    dependency_extension: 1 -&gt; <span class="library" title="binding of C++ string type">string</span>;
<span class="lineno" id=line23></span>    executable_extension : 1 -&gt; <span class="library" title="binding of C++ string type">string</span>;
<span class="lineno" id=line24></span>    static_object_extension: 1 -&gt; <span class="library" title="binding of C++ string type">string</span>;
<span class="lineno" id=line25></span>    dynamic_object_extension: 1 -&gt; <span class="library" title="binding of C++ string type">string</span>;
<span class="lineno" id=line26></span>    static_library_extension: 1 -&gt; <span class="library" title="binding of C++ string type">string</span>;
<span class="lineno" id=line27></span>    dynamic_library_extension: 1 -&gt; <span class="library" title="binding of C++ string type">string</span>;
<span class="lineno" id=line28></span>    pathname_separator : 1 -&gt; <span class="library" title="binding of C++ string type">string</span>;
<span class="lineno" id=line29></span>    get_base_c_compile_flags: 1 -&gt; <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>];
<span class="lineno" id=line30></span>    get_base_cxx_compile_flags: 1 -&gt; <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>];
<span class="lineno" id=line31></span>  
<span class="lineno" id=line32></span>    cxx_dependency_generator : (src:<span class="library" title="binding of C++ string type">string</span>) -&gt; <span class="library" title="binding of C int type">int</span> * <span class="library" title="binding of C++ string type">string</span>;
<span class="lineno" id=line33></span>    c_dependency_generator : (src:<span class="library" title="binding of C++ string type">string</span>) -&gt; <span class="library" title="binding of C int type">int</span> * <span class="library" title="binding of C++ string type">string</span>;
<span class="lineno" id=line34></span>    dependency_parser : <span class="library" title="binding of C++ string type">string</span> -&gt; <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>];
<span class="lineno" id=line35></span>  
<span class="lineno" id=line36></span>    cxx_static_object_compiler : (dst:<span class="library" title="binding of C++ string type">string</span>,src: <span class="library" title="binding of C++ string type">string</span>) -&gt; <span class="library" title="binding of C int type">int</span>;
<span class="lineno" id=line37></span>    cxx_static_library_object_compiler : (dst:<span class="library" title="binding of C++ string type">string</span>,src: <span class="library" title="binding of C++ string type">string</span>) -&gt; <span class="library" title="binding of C int type">int</span>;
<span class="lineno" id=line38></span>    c_static_object_compiler : (dst:<span class="library" title="binding of C++ string type">string</span>,src: <span class="library" title="binding of C++ string type">string</span>) -&gt; <span class="library" title="binding of C int type">int</span>;
<span class="lineno" id=line39></span>    static_library_linker : (dst:<span class="library" title="binding of C++ string type">string</span>,srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>]) -&gt; <span class="library" title="binding of C int type">int</span>;
<span class="lineno" id=line40></span>    static_executable_linker : (dst:<span class="library" title="binding of C++ string type">string</span>,srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>]) -&gt; <span class="library" title="binding of C int type">int</span>;
<span class="lineno" id=line41></span>    dynamic_executable_linker : (dst:<span class="library" title="binding of C++ string type">string</span>,srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>]) -&gt; <span class="library" title="binding of C int type">int</span>;
<span class="lineno" id=line42></span>  
<span class="lineno" id=line43></span>    cxx_dynamic_object_compiler : (dst:<span class="library" title="binding of C++ string type">string</span>,src: <span class="library" title="binding of C++ string type">string</span>) -&gt; <span class="library" title="binding of C int type">int</span>;
<span class="lineno" id=line44></span>    c_dynamic_object_compiler : (dst:<span class="library" title="binding of C++ string type">string</span>,src: <span class="library" title="binding of C++ string type">string</span>) -&gt; <span class="library" title="binding of C int type">int</span>;
<span class="lineno" id=line45></span>    dynamic_library_linker : (dst:<span class="library" title="binding of C++ string type">string</span>,srcs: <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>]) -&gt; <span class="library" title="binding of C int type">int</span>;
<span class="lineno" id=line46></span>  
<span class="lineno" id=line47></span>    debug_flags : 1 -&gt; <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>];
<span class="lineno" id=line48></span>  }
<span class="lineno" id=line49></span>  
</pre></p></div><h1 id='Generic_C/C++_compiler_h'><img src='/share/src/web/images/minus.gif' id='Generic C/C++ compiler' onclick='toggle(this,"Generic_C/C++_compiler_d")' alt='+'/> 3 Generic C/C++ compiler</h1><div id='Generic_C/C++_compiler_d' style='display:block'>
<p>For compilers with a gcc like command line interface: 
gcc and clang basically.
</p><pre class='inclusion'>
share/lib/std/felix/flx_cxx.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Define a type class">class</span> CxxCompiler
<span class="lineno" id=line2></span>  {
<span class="lineno" id=line3></span>    <span class="big_keyword" title="Define an alias for a type expression">typedef</span> cxx_dep_spec_t = 
<span class="lineno" id=line4></span>    (
<span class="lineno" id=line5></span>      CCDEP: <span class="library" title="binding of C++ string type">string</span>,
<span class="lineno" id=line6></span>      CCFLAGS: <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line7></span>      INCLUDE_DIRS: <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line8></span>      MACROS: <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line9></span>      debugln: <span class="library" title="binding of C++ string type">string</span> -&gt; 0
<span class="lineno" id=line10></span>    );
<span class="lineno" id=line11></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> mkinc (s:<span class="library" title="binding of C++ string type">string</span>) =&gt; <span class="fstring">"-I"</span> + s;
<span class="lineno" id=line12></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> mkincs (ss:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>]) =&gt; <span class="library" title="return data structure with function applied to each value">map</span> mkinc ss;
<span class="lineno" id=line13></span>  
<span class="lineno" id=line14></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> mkmac (s:<span class="library" title="binding of C++ string type">string</span>) =&gt; <span class="fstring">"-D"</span> + s;
<span class="lineno" id=line15></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> mkmacs (ss:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>]) =&gt; <span class="library" title="return data structure with function applied to each value">map</span> mkmac ss;
<span class="lineno" id=line16></span>  
<span class="lineno" id=line17></span>    <span class="comment">//---------------------------------------------------------------</span>
<span class="lineno" id=line18></span>    <span class="comment">// Generating #include dependencies</span>
<span class="lineno" id=line19></span>    <span class="comment">//---------------------------------------------------------------</span>
<span class="lineno" id=line20></span>  
<span class="lineno" id=line21></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> generic_cxx_gen_deps (spec: cxx_dep_spec_t) (src:<span class="library" title="binding of C++ string type">string</span>) : <span class="library" title="binding of C int type">int</span> * <span class="library" title="binding of C++ string type">string</span> =
<span class="lineno" id=line22></span>    {
<span class="lineno" id=line23></span>      <span class="big_keyword" title="Define a mutable variable">var</span> cmd=
<span class="lineno" id=line24></span>        spec.CCDEP !
<span class="lineno" id=line25></span>        spec.CCFLAGS +
<span class="lineno" id=line26></span>        mkincs spec.INCLUDE_DIRS + 
<span class="lineno" id=line27></span>        mkmacs spec.MACROS + 
<span class="lineno" id=line28></span>        src
<span class="lineno" id=line29></span>      ;
<span class="lineno" id=line30></span>      <span class="big_keyword" title="Define a mutable variable">var</span> CMD = catmap <span class="fstring">' '</span> Shell::quote_arg cmd;
<span class="lineno" id=line31></span>      spec.debugln$ <span class="fstring">"C++ generate dependencies : "</span> + CMD;
<span class="lineno" id=line32></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>, data = System::get_stdout(CMD);
<span class="lineno" id=line33></span>      <span class="small_keyword" title="conditional">if</span> <span class="small_keyword" title="value of function return used in post condition">result</span> != 0 <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line34></span>        eprintln $ <span class="fstring">"C++ command="</span>+CMD + <span class="fstring">" FAILED"</span>;
<span class="lineno" id=line35></span>      <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line36></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>, data;
<span class="lineno" id=line37></span>    }
<span class="lineno" id=line38></span>  
<span class="lineno" id=line39></span>    <span class="comment">// parse the "make" file generated by gcc -M</span>
<span class="lineno" id=line40></span>    <span class="comment">// GIGO: this routine can't fail, but it can return rubbish</span>
<span class="lineno" id=line41></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> generic_dependency_parser (data:<span class="library" title="binding of C++ string type">string</span>) : <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>] =
<span class="lineno" id=line42></span>    {
<span class="lineno" id=line43></span>      <span class="big_keyword" title="Define a mutable variable">var</span> pcolon = <span class="small_keyword" title="match statement or expression">match</span> find (data ,<span class="fstring">':'</span>) <span class="small_keyword" title="type-class constraint">with</span> | Some i =&gt; i+1uz | #None =&gt; 0uz;
<span class="lineno" id=line44></span>      <span class="big_keyword" title="Define a mutable variable">var</span> txt = data.[pcolon <span class="small_keyword" title="substring range separator">to</span>];
<span class="lineno" id=line45></span>      txt = search_and_replace (txt,<span class="fstring">'\\\n'</span>,<span class="fstring">''</span>);
<span class="lineno" id=line46></span>      <span class="big_keyword" title="Define a mutable variable">var</span> files = respectful_split txt;
<span class="lineno" id=line47></span>      files = unbox (<span class="library" title="return data structure with function applied to each value">map</span> Directory::mk_absolute_filename files);
<span class="lineno" id=line48></span>      <span class="small_keyword" title="return">return</span> files;
<span class="lineno" id=line49></span>    }
<span class="lineno" id=line50></span>  
<span class="lineno" id=line51></span>    <span class="comment">//---------------------------------------------------------------</span>
<span class="lineno" id=line52></span>    <span class="comment">// Compiling object files for dynamic links</span>
<span class="lineno" id=line53></span>    <span class="comment">//---------------------------------------------------------------</span>
<span class="lineno" id=line54></span>  
<span class="lineno" id=line55></span>    <span class="big_keyword" title="Define an alias for a type expression">typedef</span> cxx_dynamic_spec_t = 
<span class="lineno" id=line56></span>    (
<span class="lineno" id=line57></span>      CCOBJ_DLLIB: <span class="library" title="binding of C++ string type">string</span>,
<span class="lineno" id=line58></span>      CCFLAGS: <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line59></span>      INCLUDE_DIRS: <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line60></span>      MACROS: <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line61></span>      SPEC_OBJ_FILENAME:<span class="library" title="binding of C++ string type">string</span>,
<span class="lineno" id=line62></span>      debugln: <span class="library" title="binding of C++ string type">string</span> -&gt; 0
<span class="lineno" id=line63></span>    );
<span class="lineno" id=line64></span>  
<span class="lineno" id=line65></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> generic_cxx_compile_for_dynamic (spec: cxx_dynamic_spec_t) (src:<span class="library" title="binding of C++ string type">string</span>, dst:<span class="library" title="binding of C++ string type">string</span>) : <span class="library" title="binding of C int type">int</span> =
<span class="lineno" id=line66></span>    {
<span class="lineno" id=line67></span>      <span class="big_keyword" title="Define a mutable variable">var</span> cmd=
<span class="lineno" id=line68></span>        spec.CCOBJ_DLLIB !
<span class="lineno" id=line69></span>        spec.CCFLAGS +
<span class="lineno" id=line70></span>        mkincs spec.INCLUDE_DIRS + 
<span class="lineno" id=line71></span>        mkmacs spec.MACROS + 
<span class="lineno" id=line72></span>        src
<span class="lineno" id=line73></span>      ;
<span class="lineno" id=line74></span>      <span class="big_keyword" title="Define a mutable variable">var</span> CMD = catmap <span class="fstring">' '</span> Shell::quote_arg cmd + <span class="fstring">' '</span> +
<span class="lineno" id=line75></span>        (spec.SPEC_OBJ_FILENAME+Shell::quote_arg dst)
<span class="lineno" id=line76></span>      ;
<span class="lineno" id=line77></span>     spec.debugln$ <span class="fstring">"C++ compile: "</span> + CMD;
<span class="lineno" id=line78></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = System::system(CMD);
<span class="lineno" id=line79></span>      <span class="small_keyword" title="conditional">if</span> <span class="small_keyword" title="value of function return used in post condition">result</span> != 0 <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line80></span>        eprintln $ <span class="fstring">"C++ command="</span>+CMD + <span class="fstring">" FAILED"</span>;
<span class="lineno" id=line81></span>      <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line82></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line83></span>    }
<span class="lineno" id=line84></span>  
<span class="lineno" id=line85></span>  
<span class="lineno" id=line86></span>    <span class="comment">//---------------------------------------------------------------</span>
<span class="lineno" id=line87></span>    <span class="comment">// Compiling object files for static links</span>
<span class="lineno" id=line88></span>    <span class="comment">//---------------------------------------------------------------</span>
<span class="lineno" id=line89></span>  
<span class="lineno" id=line90></span>    <span class="big_keyword" title="Define an alias for a type expression">typedef</span> cxx_compile_static_t =
<span class="lineno" id=line91></span>    (
<span class="lineno" id=line92></span>      CCOBJ_STATIC_LIB:<span class="library" title="binding of C++ string type">string</span>,
<span class="lineno" id=line93></span>      CCFLAGS:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>], 
<span class="lineno" id=line94></span>      INCLUDE_DIRS:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line95></span>      MACROS:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>], 
<span class="lineno" id=line96></span>      SPEC_OBJ_FILENAME:<span class="library" title="binding of C++ string type">string</span>,
<span class="lineno" id=line97></span>      debugln: <span class="library" title="binding of C++ string type">string</span> -&gt; 0
<span class="lineno" id=line98></span>    );
<span class="lineno" id=line99></span>  
<span class="lineno" id=line100></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> generic_cxx_compile_for_static 
<span class="lineno" id=line101></span>      (spec:cxx_compile_static_t)
<span class="lineno" id=line102></span>      (src:<span class="library" title="binding of C++ string type">string</span>, dst:<span class="library" title="binding of C++ string type">string</span>) : <span class="library" title="binding of C int type">int</span> =
<span class="lineno" id=line103></span>    {
<span class="lineno" id=line104></span>      <span class="big_keyword" title="Define a mutable variable">var</span> cmd=
<span class="lineno" id=line105></span>        spec.CCOBJ_STATIC_LIB !
<span class="lineno" id=line106></span>        spec.CCFLAGS +
<span class="lineno" id=line107></span>        mkincs spec.INCLUDE_DIRS + 
<span class="lineno" id=line108></span>        mkmacs spec.MACROS +
<span class="lineno" id=line109></span>        src
<span class="lineno" id=line110></span>      ;
<span class="lineno" id=line111></span>      <span class="big_keyword" title="Define a mutable variable">var</span> CMD = catmap <span class="fstring">' '</span> Shell::quote_arg cmd + <span class="fstring">' '</span> + 
<span class="lineno" id=line112></span>        (spec.SPEC_OBJ_FILENAME+Shell::quote_arg dst)
<span class="lineno" id=line113></span>      ;
<span class="lineno" id=line114></span>  
<span class="lineno" id=line115></span>      spec.debugln$ <span class="fstring">"C++ command="</span>+CMD;
<span class="lineno" id=line116></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>=System::system(CMD);
<span class="lineno" id=line117></span>  
<span class="lineno" id=line118></span>      <span class="small_keyword" title="conditional">if</span> <span class="small_keyword" title="value of function return used in post condition">result</span> != 0 <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line119></span>        eprintln$ <span class="fstring">"C++ compilation "</span>+src+<span class="fstring">" failed"</span>;
<span class="lineno" id=line120></span>      <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line121></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line122></span>  
<span class="lineno" id=line123></span>    }
<span class="lineno" id=line124></span>  
<span class="lineno" id=line125></span>  
<span class="lineno" id=line126></span>    <span class="comment">//---------------------------------------------------------------</span>
<span class="lineno" id=line127></span>    <span class="comment">// Making a shared library or DLL</span>
<span class="lineno" id=line128></span>    <span class="comment">//---------------------------------------------------------------</span>
<span class="lineno" id=line129></span>  
<span class="lineno" id=line130></span>    <span class="big_keyword" title="Define an alias for a type expression">typedef</span> link_lib_dynamic_spec_t = 
<span class="lineno" id=line131></span>    (
<span class="lineno" id=line132></span>      CCLINK_DLLIB: <span class="library" title="binding of C++ string type">string</span>,
<span class="lineno" id=line133></span>      CCFLAGS: <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line134></span>      EXT_SHARED_OBJ:<span class="library" title="binding of C++ string type">string</span>,
<span class="lineno" id=line135></span>      SPEC_EXE_FILENAME: <span class="library" title="binding of C++ string type">string</span>,
<span class="lineno" id=line136></span>      LINK_STRINGS: <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line137></span>      debugln: <span class="library" title="binding of C++ string type">string</span> -&gt; 0
<span class="lineno" id=line138></span>    );
<span class="lineno" id=line139></span>  
<span class="lineno" id=line140></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> generic_link_lib_dynamic 
<span class="lineno" id=line141></span>      (spec:link_lib_dynamic_spec_t) 
<span class="lineno" id=line142></span>      (cppos: <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line143></span>      LINKER_OUTPUT_FILENAME:<span class="library" title="binding of C++ string type">string</span>)
<span class="lineno" id=line144></span>    : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line145></span>    {
<span class="lineno" id=line146></span>      <span class="big_keyword" title="Define a mutable variable">var</span> cmd =
<span class="lineno" id=line147></span>        spec.CCLINK_DLLIB !
<span class="lineno" id=line148></span>        spec.CCFLAGS +
<span class="lineno" id=line149></span>        cppos
<span class="lineno" id=line150></span>      ;
<span class="lineno" id=line151></span>      <span class="comment">// This weird shit is because Unix use -o filename (space)</span>
<span class="lineno" id=line152></span>      <span class="comment">// But Windows uses /Fefilename (no space)</span>
<span class="lineno" id=line153></span>      <span class="big_keyword" title="Define a mutable variable">var</span> CMD = catmap <span class="fstring">' '</span> Shell::quote_arg cmd + <span class="fstring">' '</span> +
<span class="lineno" id=line154></span>        spec.SPEC_EXE_FILENAME+Shell::quote_arg LINKER_OUTPUT_FILENAME+ <span class="fstring">' '</span> +
<span class="lineno" id=line155></span>        catmap <span class="fstring">' '</span> Shell::quote_arg spec.LINK_STRINGS
<span class="lineno" id=line156></span>      ;
<span class="lineno" id=line157></span>      spec.debugln$ <span class="fstring">"Link command="</span>+CMD;
<span class="lineno" id=line158></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = System::system(CMD);
<span class="lineno" id=line159></span>      <span class="small_keyword" title="conditional">if</span> <span class="small_keyword" title="value of function return used in post condition">result</span> != 0 <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line160></span>        eprintln $ <span class="fstring">"Dynamic link command="</span>+CMD + <span class="fstring">" FAILED"</span>;
<span class="lineno" id=line161></span>      <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line162></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line163></span>    }
<span class="lineno" id=line164></span>  
<span class="lineno" id=line165></span>  
<span class="lineno" id=line166></span>    <span class="comment">//---------------------------------------------------------------</span>
<span class="lineno" id=line167></span>    <span class="comment">// Making a executable which uses shared libraroes</span>
<span class="lineno" id=line168></span>    <span class="comment">//---------------------------------------------------------------</span>
<span class="lineno" id=line169></span>  
<span class="lineno" id=line170></span>    <span class="big_keyword" title="Define an alias for a type expression">typedef</span> generic_link_exe_dynamic_t =
<span class="lineno" id=line171></span>    (
<span class="lineno" id=line172></span>      CCLINK_STATIC: <span class="library" title="binding of C++ string type">string</span>, <span class="comment">// yeah, weird, but it means linker for executables ..</span>
<span class="lineno" id=line173></span>      CCFLAGS: <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line174></span>      SPEC_EXE_FILENAME: <span class="library" title="binding of C++ string type">string</span>,
<span class="lineno" id=line175></span>      LINK_STRINGS: <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line176></span>      debugln: string-&gt;0
<span class="lineno" id=line177></span>    );
<span class="lineno" id=line178></span>  
<span class="lineno" id=line179></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> generic_link_exe_dynamic
<span class="lineno" id=line180></span>      (spec:generic_link_exe_dynamic_t) 
<span class="lineno" id=line181></span>      (cppos:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>], LINKER_OUTPUT_FILENAME:<span class="library" title="binding of C++ string type">string</span>) : <span class="library" title="binding of C int type">int</span> =
<span class="lineno" id=line182></span>    {
<span class="lineno" id=line183></span>  <span class="comment">/*
<span class="lineno" id=line184></span>  println$ "[generic_link_exe_dynamic] cppos=" + cppos.str;
<span class="lineno" id=line185></span>  println$ "[generic_link_exe_dynamic] link strings=" + spec.LINK_STRINGS.str;
<span class="lineno" id=line186></span>  */</span>
<span class="lineno" id=line187></span>      <span class="big_keyword" title="Define a mutable variable">var</span> CMD =
<span class="lineno" id=line188></span>          Shell::quote_arg spec.CCLINK_STATIC + <span class="fstring">' '</span> +
<span class="lineno" id=line189></span>          catmap <span class="fstring">' '</span> Shell::quote_arg spec.CCFLAGS + <span class="fstring">' '</span> +
<span class="lineno" id=line190></span>          (spec.SPEC_EXE_FILENAME+Shell::quote_arg(LINKER_OUTPUT_FILENAME)) + <span class="fstring">' '</span> +
<span class="lineno" id=line191></span>          catmap <span class="fstring">' '</span> Shell::quote_arg cppos + <span class="fstring">' '</span> +
<span class="lineno" id=line192></span>          catmap <span class="fstring">' '</span> Shell::quote_arg spec.LINK_STRINGS
<span class="lineno" id=line193></span>      ;
<span class="lineno" id=line194></span>  
<span class="lineno" id=line195></span>      spec.debugln$ <span class="fstring">"Link command="</span>+CMD;
<span class="lineno" id=line196></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>=System::system(CMD);
<span class="lineno" id=line197></span>      <span class="small_keyword" title="conditional">if</span> <span class="small_keyword" title="value of function return used in post condition">result</span> != 0 <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line198></span>        eprintln$ <span class="fstring">"Link command="</span>+CMD+ <span class="fstring">" FAILED"</span>;
<span class="lineno" id=line199></span>      <span class="small_keyword" title="end of body">done</span> 
<span class="lineno" id=line200></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line201></span>    }
<span class="lineno" id=line202></span>  
<span class="lineno" id=line203></span>    <span class="comment">//---------------------------------------------------------------</span>
<span class="lineno" id=line204></span>    <span class="comment">// Making a fully linked statically executable</span>
<span class="lineno" id=line205></span>    <span class="comment">//---------------------------------------------------------------</span>
<span class="lineno" id=line206></span>  
<span class="lineno" id=line207></span>    <span class="big_keyword" title="Define an alias for a type expression">typedef</span> generic_link_exe_static_t =
<span class="lineno" id=line208></span>    (
<span class="lineno" id=line209></span>      CCLINK_STATIC: <span class="library" title="binding of C++ string type">string</span>,
<span class="lineno" id=line210></span>      CCFLAGS: <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line211></span>      SPEC_EXE_FILENAME: <span class="library" title="binding of C++ string type">string</span>,
<span class="lineno" id=line212></span>      LINK_STRINGS: <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line213></span>      debugln: string-&gt;0
<span class="lineno" id=line214></span>    );
<span class="lineno" id=line215></span>  
<span class="lineno" id=line216></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> generic_link_exe_static 
<span class="lineno" id=line217></span>      (spec:generic_link_exe_static_t) 
<span class="lineno" id=line218></span>      (cppos:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>], LINKER_OUTPUT_FILENAME:<span class="library" title="binding of C++ string type">string</span>) : <span class="library" title="binding of C int type">int</span> =
<span class="lineno" id=line219></span>    {
<span class="lineno" id=line220></span>      <span class="big_keyword" title="Define a mutable variable">var</span> CMD =
<span class="lineno" id=line221></span>          Shell::quote_arg spec.CCLINK_STATIC + <span class="fstring">' '</span> +
<span class="lineno" id=line222></span>          catmap <span class="fstring">' '</span> Shell::quote_arg spec.CCFLAGS + <span class="fstring">' '</span> +
<span class="lineno" id=line223></span>          (spec.SPEC_EXE_FILENAME+Shell::quote_arg(LINKER_OUTPUT_FILENAME)) + <span class="fstring">' '</span> +
<span class="lineno" id=line224></span>          catmap <span class="fstring">' '</span> Shell::quote_arg cppos + <span class="fstring">' '</span> +
<span class="lineno" id=line225></span>          catmap <span class="fstring">' '</span> Shell::quote_arg spec.LINK_STRINGS
<span class="lineno" id=line226></span>      ;
<span class="lineno" id=line227></span>  
<span class="lineno" id=line228></span>      spec.debugln$ <span class="fstring">"Link command="</span>+CMD;
<span class="lineno" id=line229></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>=System::system(CMD);
<span class="lineno" id=line230></span>      <span class="small_keyword" title="conditional">if</span> <span class="small_keyword" title="value of function return used in post condition">result</span> != 0 <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line231></span>        eprintln$ <span class="fstring">"Link command="</span>+CMD+ <span class="fstring">" FAILED"</span>;
<span class="lineno" id=line232></span>      <span class="small_keyword" title="end of body">done</span> 
<span class="lineno" id=line233></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line234></span>    }
<span class="lineno" id=line235></span>  
<span class="lineno" id=line236></span>    <span class="comment">//---------------------------------------------------------------</span>
<span class="lineno" id=line237></span>    <span class="comment">// Making a library archive</span>
<span class="lineno" id=line238></span>    <span class="comment">//---------------------------------------------------------------</span>
<span class="lineno" id=line239></span>    <span class="big_keyword" title="Define an alias for a type expression">typedef</span> generic_lib_static_t =
<span class="lineno" id=line240></span>    (
<span class="lineno" id=line241></span>      CCLINK_STATIC_LIB: <span class="library" title="binding of C++ string type">string</span>,
<span class="lineno" id=line242></span>      CCFLAGS : <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line243></span>      SPEC_LIB_FILENAME: <span class="library" title="binding of C++ string type">string</span>,
<span class="lineno" id=line244></span>      debugln: string-&gt;0
<span class="lineno" id=line245></span>    );
<span class="lineno" id=line246></span>  
<span class="lineno" id=line247></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> generic_static_library 
<span class="lineno" id=line248></span>      (spec:generic_lib_static_t) 
<span class="lineno" id=line249></span>      (cppos:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>], LINKER_OUTPUT_FILENAME:<span class="library" title="binding of C++ string type">string</span>) : <span class="library" title="binding of C int type">int</span> =
<span class="lineno" id=line250></span>    {
<span class="lineno" id=line251></span>      <span class="big_keyword" title="Define a mutable variable">var</span> CMD =
<span class="lineno" id=line252></span>          Shell::quote_arg(spec.CCLINK_STATIC_LIB) + <span class="fstring">' '</span> +
<span class="lineno" id=line253></span>          catmap <span class="fstring">' '</span> Shell::quote_arg spec.CCFLAGS + <span class="fstring">' '</span> +
<span class="lineno" id=line254></span>          (spec.SPEC_LIB_FILENAME+Shell::quote_arg(LINKER_OUTPUT_FILENAME)) + <span class="fstring">' '</span> +
<span class="lineno" id=line255></span>          catmap <span class="fstring">' '</span> Shell::quote_arg cppos
<span class="lineno" id=line256></span>      ;
<span class="lineno" id=line257></span>  
<span class="lineno" id=line258></span>      spec.debugln$ <span class="fstring">"Library archive command="</span>+CMD;
<span class="lineno" id=line259></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>=System::system(CMD);
<span class="lineno" id=line260></span>      <span class="small_keyword" title="conditional">if</span> <span class="small_keyword" title="value of function return used in post condition">result</span> != 0 <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line261></span>        eprintln$ <span class="fstring">"Library archive command="</span>+CMD+ <span class="fstring">" FAILED"</span>;
<span class="lineno" id=line262></span>      <span class="small_keyword" title="end of body">done</span> 
<span class="lineno" id=line263></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line264></span>    }
<span class="lineno" id=line265></span>  
<span class="lineno" id=line266></span>  
<span class="lineno" id=line267></span>  }
<span class="lineno" id=line268></span>  
</pre></p></div><h1 id='Dependency_Checker_h'><img src='/share/src/web/images/minus.gif' id='Dependency Checker' onclick='toggle(this,"Dependency_Checker_d")' alt='+'/> 4 Dependency Checker</h1><div id='Dependency_Checker_d' style='display:block'>
<p>The dependency checker is used to examine a single C or C++
source file and check if the file, or any of dependencies,
has changed. To do this it records a dependency file with a ".d"
suffix as its output which lists all the files which are
depended on as well as the command line switches used
to invoke the compiler. The dependent file list is generated
by the underlying compiler, which must support this ability.
</p><pre class='inclusion'>
share/lib/std/felix/flx/flx_depchk.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/toolchain_interface"</span>;
<span class="lineno" id=line2></span>  
<span class="lineno" id=line3></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_depcheck (tc: toolchain_t, src:<span class="library" title="binding of C++ string type">string</span>, dst:<span class="library" title="binding of C++ string type">string</span>) : bool = 
<span class="lineno" id=line4></span>    {
<span class="lineno" id=line5></span>      <span class="big_keyword" title="Define a function with no side-effects">fun</span> == (a:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>], b:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>]) =
<span class="lineno" id=line6></span>      { 
<span class="lineno" id=line7></span>        <span class="small_keyword" title="match statement or expression">match</span> a,b <span class="small_keyword" title="type-class constraint">with</span>
<span class="lineno" id=line8></span>        | #Empty,Empty =&gt; <span class="small_keyword" title="return">return</span> <span class="library" title="truth value">true</span>;
<span class="lineno" id=line9></span>        | Cons (h1,t1), Cons (h2,t2) =&gt; 
<span class="lineno" id=line10></span>           <span class="small_keyword" title="conditional">if</span> h1 != h2 <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line11></span>             <span class="small_keyword" title="return">return</span> <span class="library" title="false value">false</span>;
<span class="lineno" id=line12></span>           <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line13></span>           <span class="small_keyword" title="return">return</span> t1 == t2; <span class="comment">// tail call</span>
<span class="lineno" id=line14></span>        | _ =&gt;<span class="small_keyword" title="return">return</span> <span class="library" title="false value">false</span>;
<span class="lineno" id=line15></span>        <span class="small_keyword" title="end a match statement or expression">endmatch</span>;
<span class="lineno" id=line16></span>      }
<span class="lineno" id=line17></span>  
<span class="lineno" id=line18></span>      <span class="big_keyword" title="Define a function with no side-effects">fun</span> maxf (t:<span class="library" title="binding of C double float type">double</span>) (f:<span class="library" title="binding of C++ string type">string</span>) =&gt; max (t, FileStat::dfiletime (f, #FileStat::future_time));
<span class="lineno" id=line19></span>  
<span class="lineno" id=line20></span>      <span class="big_keyword" title="Define a mutable variable">var</span> new_switches = cat <span class="fstring">' '</span> #(tc.get_base_cxx_compile_flags);
<span class="lineno" id=line21></span>  
<span class="lineno" id=line22></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>, deps = tc.cxx_dependency_generator (src=src);
<span class="lineno" id=line23></span>      <span class="small_keyword" title="conditional">if</span> <span class="small_keyword" title="value of function return used in post condition">result</span> != 0 <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line24></span>        <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"[flx_depchk] C++ Dependency generator FAILED on "</span> + src;
<span class="lineno" id=line25></span>        <span class="small_keyword" title="return">return</span> <span class="library" title="false value">false</span>;
<span class="lineno" id=line26></span>      <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line27></span>      <span class="big_keyword" title="Define a mutable variable">var</span> newdeps = tc.dependency_parser deps;
<span class="lineno" id=line28></span>      <span class="big_keyword" title="Define a mutable variable">var</span> depfile = dst + <span class="fstring">".d"</span>;
<span class="lineno" id=line29></span>      <span class="big_keyword" title="Define a mutable variable">var</span> olddeptxt = load depfile;
<span class="lineno" id=line30></span>      <span class="big_keyword" title="Define a mutable variable">var</span> old_switches, olddeps = 
<span class="lineno" id=line31></span>        <span class="small_keyword" title="match statement or expression">match</span> filter (<span class="big_keyword" title="Define a function with no side-effects">fun</span> (s:<span class="library" title="binding of C++ string type">string</span>)=&gt; s != <span class="fstring">""</span>) (split (olddeptxt,<span class="fstring">"\n"</span>)) <span class="small_keyword" title="type-class constraint">with</span>
<span class="lineno" id=line32></span>        | h ! t =&gt; h,t
<span class="lineno" id=line33></span>        | _ =&gt; <span class="fstring">""</span>,Empty[<span class="library" title="binding of C++ string type">string</span>]
<span class="lineno" id=line34></span>      ;
<span class="lineno" id=line35></span>  
<span class="lineno" id=line36></span>      <span class="big_keyword" title="Define a mutable variable">var</span> samedeps = new_switches == old_switches <span class="small_keyword" title="logical conjunction">and</span> newdeps == olddeps;
<span class="lineno" id=line37></span>      <span class="comment">//if not samedeps do</span>
<span class="lineno" id=line38></span>      <span class="comment">//  println$ "DEPS CHANGED"; </span>
<span class="lineno" id=line39></span>      <span class="comment">//  println$ "Old deps = " + olddeps.str;</span>
<span class="lineno" id=line40></span>      <span class="comment">//  println$ "New deps = " + newdeps.str;</span>
<span class="lineno" id=line41></span>      <span class="comment">//done</span>
<span class="lineno" id=line42></span>      save$ depfile, new_switches ! newdeps;
<span class="lineno" id=line43></span>      <span class="big_keyword" title="Define a mutable variable">var</span> fresh = samedeps <span class="small_keyword" title="logical conjunction">and</span> #{
<span class="lineno" id=line44></span>        <span class="big_keyword" title="Define a mutable variable">var</span> t = <span class="library" title="accumulated values of data structure from left into initial value using function">fold_left</span> maxf #FileStat::past_time newdeps;
<span class="lineno" id=line45></span>        <span class="small_keyword" title="return">return</span> t &lt; FileStat::dfiletime (dst, #FileStat::past_time);
<span class="lineno" id=line46></span>      };
<span class="lineno" id=line47></span>      <span class="comment">//println$ "[flx] Output " + dst + " is " + if fresh then "FRESH" else "STALE" endif;</span>
<span class="lineno" id=line48></span>      <span class="small_keyword" title="return">return</span> fresh;
<span class="lineno" id=line49></span>    }
<span class="lineno" id=line50></span>  
<span class="lineno" id=line51></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> c_depcheck (tc: toolchain_t, src:<span class="library" title="binding of C++ string type">string</span>, dst:<span class="library" title="binding of C++ string type">string</span>) : bool = 
<span class="lineno" id=line52></span>    {
<span class="lineno" id=line53></span>      <span class="big_keyword" title="Define a function with no side-effects">fun</span> == (a:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>], b:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>]) =
<span class="lineno" id=line54></span>      { 
<span class="lineno" id=line55></span>        <span class="small_keyword" title="match statement or expression">match</span> a,b <span class="small_keyword" title="type-class constraint">with</span>
<span class="lineno" id=line56></span>        | #Empty,Empty =&gt;  <span class="small_keyword" title="return">return</span> <span class="library" title="truth value">true</span>;
<span class="lineno" id=line57></span>        | Cons (h1,t1), Cons (h2,t2) =&gt; 
<span class="lineno" id=line58></span>           <span class="small_keyword" title="conditional">if</span> h1 != h2 <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line59></span>             <span class="small_keyword" title="return">return</span> <span class="library" title="false value">false</span>;
<span class="lineno" id=line60></span>           <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line61></span>           <span class="small_keyword" title="return">return</span> t1 == t2; <span class="comment">// tail call</span>
<span class="lineno" id=line62></span>        | _ =&gt; <span class="small_keyword" title="return">return</span> <span class="library" title="false value">false</span>;
<span class="lineno" id=line63></span>        <span class="small_keyword" title="end a match statement or expression">endmatch</span>;
<span class="lineno" id=line64></span>      }
<span class="lineno" id=line65></span>  
<span class="lineno" id=line66></span>      <span class="big_keyword" title="Define a function with no side-effects">fun</span> maxf (t:<span class="library" title="binding of C double float type">double</span>) (f:<span class="library" title="binding of C++ string type">string</span>) =&gt;
<span class="lineno" id=line67></span>        max(t, FileStat::dfiletime (f, #FileStat::future_time))
<span class="lineno" id=line68></span>      ;
<span class="lineno" id=line69></span>  
<span class="lineno" id=line70></span>      <span class="big_keyword" title="Define a mutable variable">var</span> new_switches = cat <span class="fstring">' '</span> #(tc.get_base_c_compile_flags);
<span class="lineno" id=line71></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>, deps = tc.c_dependency_generator (src=src);
<span class="lineno" id=line72></span>      <span class="small_keyword" title="conditional">if</span> <span class="small_keyword" title="value of function return used in post condition">result</span> != 0 <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line73></span>        <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"[flx_depchk] C Dependency generator FAILED on "</span> + src;
<span class="lineno" id=line74></span>        <span class="small_keyword" title="return">return</span> <span class="library" title="false value">false</span>;
<span class="lineno" id=line75></span>      <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line76></span>      <span class="big_keyword" title="Define a mutable variable">var</span> newdeps = tc.dependency_parser deps;
<span class="lineno" id=line77></span>      <span class="big_keyword" title="Define a mutable variable">var</span> depfile = dst + <span class="fstring">".d"</span>;
<span class="lineno" id=line78></span>      <span class="big_keyword" title="Define a mutable variable">var</span> olddeptxt = load depfile;
<span class="lineno" id=line79></span>      <span class="big_keyword" title="Define a mutable variable">var</span> old_switches, olddeps = 
<span class="lineno" id=line80></span>        <span class="small_keyword" title="match statement or expression">match</span> filter (<span class="big_keyword" title="Define a function with no side-effects">fun</span> (s:<span class="library" title="binding of C++ string type">string</span>)=&gt; s != <span class="fstring">""</span>) (split (olddeptxt,<span class="fstring">"\n"</span>)) <span class="small_keyword" title="type-class constraint">with</span>
<span class="lineno" id=line81></span>        | h ! t =&gt; h,t
<span class="lineno" id=line82></span>        | _ =&gt; <span class="fstring">""</span>,Empty[<span class="library" title="binding of C++ string type">string</span>]
<span class="lineno" id=line83></span>      ;
<span class="lineno" id=line84></span>  
<span class="lineno" id=line85></span>      <span class="big_keyword" title="Define a mutable variable">var</span> samedeps = new_switches == old_switches <span class="small_keyword" title="logical conjunction">and</span> newdeps == olddeps;
<span class="lineno" id=line86></span>      save$ depfile, new_switches ! newdeps;
<span class="lineno" id=line87></span>      <span class="big_keyword" title="Define a mutable variable">var</span> fresh = samedeps <span class="small_keyword" title="logical conjunction">and</span> #{
<span class="lineno" id=line88></span>        <span class="big_keyword" title="Define a mutable variable">var</span> t = <span class="library" title="accumulated values of data structure from left into initial value using function">fold_left</span> maxf #FileStat::past_time newdeps;
<span class="lineno" id=line89></span>        <span class="small_keyword" title="return">return</span> t &lt; FileStat::dfiletime (dst, #FileStat::past_time);
<span class="lineno" id=line90></span>      };
<span class="lineno" id=line91></span>      <span class="comment">//println$ "[flx] Output " + dst + " is " + if fresh then "FRESH" else "STALE" endif;</span>
<span class="lineno" id=line92></span>      <span class="small_keyword" title="return">return</span> fresh;
<span class="lineno" id=line93></span>    }
<span class="lineno" id=line94></span>  
<span class="lineno" id=line95></span>  
</pre></p></div><h1 id='Library_Builder_h'><img src='/share/src/web/images/minus.gif' id='Library Builder' onclick='toggle(this,"Library_Builder_d")' alt='+'/> 5 Library Builder</h1><div id='Library_Builder_d' style='display:block'>
<p>Builds a complete library from a flx_pkgconfig database
specification. Used by the flx_build_rtl tool.
</p><pre class='inclusion'>
share/lib/std/felix/flx_mklib.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/toolchain_config"</span>;
<span class="lineno" id=line2></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/flx_pkg"</span>; <span class="comment">// only for "fix2word_flags"</span>
<span class="lineno" id=line3></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/flx_cp"</span>;
<span class="lineno" id=line4></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/flx/flx_depchk"</span>;
<span class="lineno" id=line5></span>  
<span class="lineno" id=line6></span>  <span class="big_keyword" title="Define a type class">class</span> FlxLibBuild
<span class="lineno" id=line7></span>  {
<span class="lineno" id=line8></span>    <span class="qualifier" title="Symbol visible only in enclosing module or typeclass namespace">private</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> / (x:<span class="library" title="binding of C++ string type">string</span>,y:<span class="library" title="binding of C++ string type">string</span>) =&gt; Filename::join(x,y);
<span class="lineno" id=line9></span>  
<span class="lineno" id=line10></span>    <span class="qualifier" title="Function or procedure which must not be inlined">noinline</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> make_lib 
<span class="lineno" id=line11></span>    (
<span class="lineno" id=line12></span>      db: FlxPkgConfig::FlxPkgConfigQuery_t,  
<span class="lineno" id=line13></span>      toolchain-maker: toolchain_config_t -&gt; toolchain_t, 
<span class="lineno" id=line14></span>      c_compiler_executable: <span class="library" title="binding of C++ string type">string</span>,
<span class="lineno" id=line15></span>      cxx_compiler_executable: <span class="library" title="binding of C++ string type">string</span>,
<span class="lineno" id=line16></span>      src_dir:<span class="library" title="binding of C++ string type">string</span>, 
<span class="lineno" id=line17></span>      target_dir:<span class="library" title="binding of C++ string type">string</span>, 
<span class="lineno" id=line18></span>      share_rtl:<span class="library" title="binding of C++ string type">string</span>,
<span class="lineno" id=line19></span>      pkg:<span class="library" title="binding of C++ string type">string</span>, 
<span class="lineno" id=line20></span>      tmpdir:<span class="library" title="binding of C++ string type">string</span>,
<span class="lineno" id=line21></span>      static_only:bool,
<span class="lineno" id=line22></span>      debug: bool
<span class="lineno" id=line23></span>    ) () : bool = 
<span class="lineno" id=line24></span>    {
<span class="lineno" id=line25></span>      <span class="big_keyword" title="Define a procedure, a function with side-effects not returning a value">proc</span> dbug (x:<span class="library" title="binding of C++ string type">string</span>) =&gt; <span class="small_keyword" title="conditional">if</span> debug <span class="small_keyword" title="call a procedure">call</span> <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">'[make_lib: '</span>+pkg+<span class="fstring">']'</span> x;
<span class="lineno" id=line26></span>  
<span class="lineno" id=line27></span>      <span class="big_keyword" title="Define a procedure, a function with side-effects not returning a value">proc</span> ehandler () {
<span class="lineno" id=line28></span>        eprintln$ <span class="fstring">"toolchain: make_lib failed, temporary ehandler invoked"</span>;
<span class="lineno" id=line29></span>        System::exit 1;
<span class="lineno" id=line30></span>      }
<span class="lineno" id=line31></span>  
<span class="lineno" id=line32></span>  
<span class="lineno" id=line33></span>      <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"------------"</span>;
<span class="lineno" id=line34></span>      <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"Make lib "</span> + pkg;
<span class="lineno" id=line35></span>      <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"------------"</span>;
<span class="lineno" id=line36></span>      <span class="big_keyword" title="Define a mutable variable">var</span> srcdir = db.getpkgfielddflt ehandler (pkg,<span class="fstring">"srcdir"</span>);
<span class="lineno" id=line37></span>      <span class="big_keyword" title="Define a mutable variable">var</span> srcpath = src_dir / srcdir;
<span class="lineno" id=line38></span>  <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"[make_lib] source directory "</span> + srcpath;
<span class="lineno" id=line39></span>  
<span class="lineno" id=line40></span>      <span class="big_keyword" title="Define a mutable variable">var</span> build_includes= db.getpkgfield ehandler (pkg,<span class="fstring">"build_includes"</span>);
<span class="lineno" id=line41></span>  <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"[make_lib] build_includes "</span> + build_includes;
<span class="lineno" id=line42></span>  
<span class="lineno" id=line43></span>      <span class="big_keyword" title="Define a mutable variable">var</span> result3,ddeps= db.query$ <span class="library" title="functional, singly linked list">list</span>$ pkg, <span class="fstring">"--keepleftmost"</span>, <span class="fstring">"--field=requires_dlibs"</span>;
<span class="lineno" id=line44></span>      ddeps = FlxPkg::fix2word_flags ddeps;
<span class="lineno" id=line45></span>      <span class="big_keyword" title="Define a mutable variable">var</span> deps = db.getpkgfield ehandler (pkg,<span class="fstring">"Requires"</span>);
<span class="lineno" id=line46></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>,depdlibs =  db.query(<span class="fstring">"--field=provides_dlib"</span>+deps); <span class="comment">// packaged dlibs</span>
<span class="lineno" id=line47></span>      <span class="big_keyword" title="Define a mutable variable">var</span> macros = db.getpkgfield ehandler (pkg,<span class="fstring">"macros"</span>);
<span class="lineno" id=line48></span>      <span class="big_keyword" title="Define a mutable variable">var</span> result2,ccflags = db.query$ <span class="library" title="functional, singly linked list">list</span>$ pkg, <span class="fstring">"--keepleftmost"</span>, <span class="fstring">"--field=cflags"</span>;
<span class="lineno" id=line49></span>      <span class="big_keyword" title="Define a mutable variable">var</span> toolchain_config = 
<span class="lineno" id=line50></span>        (
<span class="lineno" id=line51></span>          c_compiler_executable = c_compiler_executable,
<span class="lineno" id=line52></span>          cxx_compiler_executable = cxx_compiler_executable,
<span class="lineno" id=line53></span>          header_search_dirs= <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>] (target_dir, srcpath, share_rtl)+build_includes,
<span class="lineno" id=line54></span>          macros= macros,
<span class="lineno" id=line55></span>          ccflags = ccflags,
<span class="lineno" id=line56></span>          library_search_dirs= <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>] (<span class="fstring">"-L"</span>+target_dir), <span class="comment">// HACK!!!</span>
<span class="lineno" id=line57></span>          dynamic_libraries= ddeps+depdlibs,
<span class="lineno" id=line58></span>          static_libraries= Empty[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line59></span>          debugln = dbug
<span class="lineno" id=line60></span>        )
<span class="lineno" id=line61></span>      ;
<span class="lineno" id=line62></span>      <span class="big_keyword" title="Define a mutable variable">var</span> toolchain = toolchain-maker toolchain_config;
<span class="lineno" id=line63></span>      <span class="library" title="Print a string to standard output with newline appended">println</span>$ #(toolchain.whatami);
<span class="lineno" id=line64></span>  
<span class="lineno" id=line65></span>      <span class="comment">// THIS DOES NOT SEEM RIGHT, we're copying headers from share/src</span>
<span class="lineno" id=line66></span>      <span class="comment">// into share/lib/rtl</span>
<span class="lineno" id=line67></span>      <span class="comment">//</span>
<span class="lineno" id=line68></span>      <span class="comment">// previously we copied into host/lib/rtl but that's even wronger</span>
<span class="lineno" id=line69></span>      <span class="comment">// because only calculated configuration headers go there</span>
<span class="lineno" id=line70></span>      <span class="comment">//</span>
<span class="lineno" id=line71></span>      <span class="comment">// the thing is, the share directory is supposed to be read-only,</span>
<span class="lineno" id=line72></span>      <span class="comment">// and the files in it immutable, so the contents should already</span>
<span class="lineno" id=line73></span>      <span class="comment">// have been put there direct from the repository</span>
<span class="lineno" id=line74></span>      <span class="comment">//</span>
<span class="lineno" id=line75></span>      <span class="comment">// of course, for add on packages, share may need updating ..</span>
<span class="lineno" id=line76></span>      <span class="comment">// its all confusing :)</span>
<span class="lineno" id=line77></span>      <span class="comment">//</span>
<span class="lineno" id=line78></span>      <span class="comment">// Leave this in there for now because demux is not actually packaged.</span>
<span class="lineno" id=line79></span>      <span class="comment">// the fbuild process has put stuff in share already though!</span>
<span class="lineno" id=line80></span>  
<span class="lineno" id=line81></span>      <span class="big_keyword" title="Define a mutable variable">var</span> headers = db.getpkgfielddflt ehandler (pkg,<span class="fstring">"headers"</span>);
<span class="lineno" id=line82></span>      <span class="small_keyword" title="conditional">if</span> headers == <span class="fstring">""</span> <span class="small_keyword" title="imperative code begins">do</span> headers = r<span class="fstring">".*\.h(pp)?"</span>; <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"copying all header files"</span>; <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line83></span>      <span class="big_keyword" title="Define a mutable variable">var</span> hsrc, hdst = <span class="fstring">""</span>,<span class="fstring">""</span>;
<span class="lineno" id=line84></span>      <span class="small_keyword" title="match statement or expression">match</span> split (headers, <span class="fstring">"&gt;"</span>) <span class="small_keyword" title="type-class constraint">with</span>
<span class="lineno" id=line85></span>      | #Empty =&gt; ;
<span class="lineno" id=line86></span>      | Cons (h,#Empty) =&gt; hsrc = h;
<span class="lineno" id=line87></span>      | Cons (h,Cons (d,#Empty)) =&gt; hsrc = h; hdst = d;
<span class="lineno" id=line88></span>      | _ =&gt; <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"Header file too many &gt; characters "</span> + headers;
<span class="lineno" id=line89></span>      <span class="small_keyword" title="end a match statement or expression">endmatch</span>;
<span class="lineno" id=line90></span>  
<span class="lineno" id=line91></span>      <span class="small_keyword" title="conditional">if</span> hdst == <span class="fstring">""</span> <span class="small_keyword" title="imperative code begins">do</span> hdst = <span class="fstring">"${0}"</span>; <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line92></span>      <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"Copying headers "</span> + hsrc + <span class="fstring">" &gt; "</span> + hdst;
<span class="lineno" id=line93></span>      CopyFiles::copyfiles (srcpath, hsrc,share_rtl/hdst,<span class="library" title="truth value">true</span>, <span class="library" title="truth value">true</span>);
<span class="lineno" id=line94></span>  
<span class="lineno" id=line95></span>      <span class="big_keyword" title="Define a mutable variable">var</span> pats = db.getpkgfield ehandler (pkg,<span class="fstring">"src"</span>);
<span class="lineno" id=line96></span>      <span class="big_keyword" title="Define a mutable variable">var</span> pat = catmap <span class="fstring">'|'</span> (<span class="big_keyword" title="Define a function with no side-effects">fun</span> (x:<span class="library" title="binding of C++ string type">string</span>)=&gt;<span class="fstring">"("</span>+x+<span class="fstring">")"</span>) pats;
<span class="lineno" id=line97></span>    <span class="comment">//println$ "Finding Sources in "+srcpath;</span>
<span class="lineno" id=line98></span>    <span class="comment">//println$ "Matching pattern "+pat;</span>
<span class="lineno" id=line99></span>      <span class="big_keyword" title="Define a mutable variable">var</span> files = FileSystem::regfilesin (srcpath,pat);
<span class="lineno" id=line100></span>    <span class="comment">//println$ "Sources = " + str files;</span>
<span class="lineno" id=line101></span>      <span class="small_keyword" title="conditional">if</span> <span class="small_keyword" title="logical negation">not</span> static_only 
<span class="lineno" id=line102></span>      <span class="small_keyword" title="imperative code begins">do</span> 
<span class="lineno" id=line103></span>        <span class="small_keyword" title="end of extension">begin</span>
<span class="lineno" id=line104></span>          <span class="big_keyword" title="Define a function with no side-effects">fun</span> objname (file:<span class="library" title="binding of C++ string type">string</span>) =&gt; <span class="small_keyword" title="let binder">let</span> 
<span class="lineno" id=line105></span>              dstobj = file.Filename::strip_extension + #(toolchain.dynamic_object_extension) <span class="small_keyword" title="membership operator, function mem">in</span>
<span class="lineno" id=line106></span>              tmpdir/ dstobj
<span class="lineno" id=line107></span>          ;
<span class="lineno" id=line108></span>  
<span class="lineno" id=line109></span>          <span class="small_keyword" title="for loop">for</span> file <span class="small_keyword" title="membership operator, function mem">in</span> files <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line110></span>            <span class="big_keyword" title="Define a mutable variable">var</span> srcfile = srcpath/ file;
<span class="lineno" id=line111></span>            <span class="big_keyword" title="Define a mutable variable">var</span> dst = objname file;
<span class="lineno" id=line112></span>            Directory::mkdirs (Filename::dirname dst);
<span class="lineno" id=line113></span>            <span class="small_keyword" title="match statement or expression">match</span> Filename::get_extension srcfile <span class="small_keyword" title="type-class constraint">with</span>
<span class="lineno" id=line114></span>            | x <span class="small_keyword" title="predicative type constraint or precondition">when</span> x == <span class="fstring">".cc"</span> <span class="small_keyword" title="logical disjunction">or</span> x == <span class="fstring">".cpp"</span> =&gt;
<span class="lineno" id=line115></span>              <span class="big_keyword" title="Define a mutable variable">var</span> fresh = cxx_depcheck (toolchain, srcfile, dst);
<span class="lineno" id=line116></span>              <span class="small_keyword" title="conditional">if</span> fresh <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line117></span>                <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"C++: Up to date [dynamic] "</span> + file <span class="fstring">" -&gt; "</span> + objname file;
<span class="lineno" id=line118></span>                <span class="small_keyword" title="value of function return used in post condition">result</span> = 0;
<span class="lineno" id=line119></span>              <span class="small_keyword" title="conditional">else</span>
<span class="lineno" id=line120></span>                <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"C++: Compiling  [dynamic] "</span> + file <span class="fstring">" -&gt; "</span> + objname file;
<span class="lineno" id=line121></span>                <span class="small_keyword" title="value of function return used in post condition">result</span> = toolchain.cxx_dynamic_object_compiler (src=srcfile, dst=dst);
<span class="lineno" id=line122></span>              <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line123></span>            | <span class="fstring">".c"</span> =&gt;
<span class="lineno" id=line124></span>              fresh = c_depcheck (toolchain, srcfile, dst);
<span class="lineno" id=line125></span>              <span class="small_keyword" title="conditional">if</span> fresh <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line126></span>                <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"C:   Up to date [dynamic] "</span> + file <span class="fstring">" -&gt; "</span> + objname file;
<span class="lineno" id=line127></span>                <span class="small_keyword" title="value of function return used in post condition">result</span> = 0;
<span class="lineno" id=line128></span>              <span class="small_keyword" title="conditional">else</span>
<span class="lineno" id=line129></span>                <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"C:   Compiling  [dynamic] "</span> + file <span class="fstring">" -&gt; "</span> + objname file;
<span class="lineno" id=line130></span>                <span class="small_keyword" title="value of function return used in post condition">result</span> = toolchain.c_dynamic_object_compiler (src=srcfile, dst=dst) ;
<span class="lineno" id=line131></span>              <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line132></span>  
<span class="lineno" id=line133></span>            | x =&gt; 
<span class="lineno" id=line134></span>              <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"Unknown extension "</span> + x; 
<span class="lineno" id=line135></span>              <span class="small_keyword" title="jump to label">goto</span> bad;
<span class="lineno" id=line136></span>            <span class="small_keyword" title="end a match statement or expression">endmatch</span>
<span class="lineno" id=line137></span>            ;
<span class="lineno" id=line138></span>            <span class="small_keyword" title="conditional">if</span> <span class="small_keyword" title="value of function return used in post condition">result</span> != 0 <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line139></span>              <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"Compiler result "</span> + <span class="library" title="Convert a value to a string">str</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line140></span>              <span class="small_keyword" title="jump to label">goto</span> bad;
<span class="lineno" id=line141></span>            <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line142></span>          <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line143></span>  
<span class="lineno" id=line144></span>          <span class="big_keyword" title="Define a mutable variable">var</span> objs = unbox (<span class="library" title="return data structure with function applied to each value">map</span> objname files);
<span class="lineno" id=line145></span>          <span class="big_keyword" title="Define a mutable variable">var</span> libname = 
<span class="lineno" id=line146></span>            <span class="small_keyword" title="let binder">let</span> dlib_root = db.getpkgfield1 ehandler (pkg,<span class="fstring">"provides_dlib"</span>) <span class="small_keyword" title="membership operator, function mem">in</span>
<span class="lineno" id=line147></span>            <span class="small_keyword" title="conditional">if</span> prefix (dlib_root,<span class="fstring">"-l"</span>) <span class="small_keyword" title="conditional">then</span> <span class="fstring">"lib"</span>+dlib_root.[2 <span class="small_keyword" title="substring range separator">to</span>]
<span class="lineno" id=line148></span>            <span class="small_keyword" title="conditional">elif</span> prefix (dlib_root,<span class="fstring">"/DEFAULTLIB:"</span>) <span class="small_keyword" title="conditional">then</span> dlib_root.[12 <span class="small_keyword" title="substring range separator">to</span>]
<span class="lineno" id=line149></span>            <span class="small_keyword" title="conditional">else</span> dlib_root 
<span class="lineno" id=line150></span>            <span class="small_keyword" title="conditional">endif</span>
<span class="lineno" id=line151></span>            +#(toolchain.dynamic_library_extension)
<span class="lineno" id=line152></span>          ;
<span class="lineno" id=line153></span>          <span class="big_keyword" title="Define a mutable variable">var</span> dstlib = target_dir/libname;
<span class="lineno" id=line154></span>          <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"Dynamic Linking library "</span> + dstlib;
<span class="lineno" id=line155></span>          <span class="comment">//println$ "  Source object files = " + objs.str;</span>
<span class="lineno" id=line156></span>          <span class="small_keyword" title="value of function return used in post condition">result</span> = toolchain.dynamic_library_linker(srcs=objs, dst=dstlib);
<span class="lineno" id=line157></span>          <span class="small_keyword" title="conditional">if</span> <span class="small_keyword" title="value of function return used in post condition">result</span> != 0 <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line158></span>            <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"Linker result "</span> + <span class="library" title="Convert a value to a string">str</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line159></span>            <span class="small_keyword" title="jump to label">goto</span> bad;
<span class="lineno" id=line160></span>          <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line161></span>        <span class="small_keyword" title="end of extension">end</span> 
<span class="lineno" id=line162></span>      <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line163></span>  
<span class="lineno" id=line164></span>      <span class="small_keyword" title="end of extension">begin</span>
<span class="lineno" id=line165></span>        <span class="big_keyword" title="Define a function with no side-effects">fun</span> objname (file:<span class="library" title="binding of C++ string type">string</span>) =&gt; <span class="small_keyword" title="let binder">let</span> 
<span class="lineno" id=line166></span>            dstobj = file.Filename::strip_extension + #(toolchain.static_object_extension) <span class="small_keyword" title="membership operator, function mem">in</span>
<span class="lineno" id=line167></span>            tmpdir/ dstobj
<span class="lineno" id=line168></span>        ;
<span class="lineno" id=line169></span>  
<span class="lineno" id=line170></span>        <span class="small_keyword" title="for loop">for</span> file <span class="small_keyword" title="membership operator, function mem">in</span> files <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line171></span>          <span class="big_keyword" title="Define a mutable variable">var</span> srcfile = srcpath/ file;
<span class="lineno" id=line172></span>          <span class="big_keyword" title="Define a mutable variable">var</span> dst = objname file;
<span class="lineno" id=line173></span>          Directory::mkdirs (Filename::dirname dst);
<span class="lineno" id=line174></span>          <span class="small_keyword" title="match statement or expression">match</span> Filename::get_extension srcfile <span class="small_keyword" title="type-class constraint">with</span>
<span class="lineno" id=line175></span>          | x <span class="small_keyword" title="predicative type constraint or precondition">when</span> x == <span class="fstring">".cc"</span> <span class="small_keyword" title="logical disjunction">or</span> x == <span class="fstring">".cpp"</span> =&gt;
<span class="lineno" id=line176></span>            <span class="big_keyword" title="Define a mutable variable">var</span> fresh = cxx_depcheck (toolchain, srcfile, dst);
<span class="lineno" id=line177></span>            <span class="small_keyword" title="conditional">if</span> fresh <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line178></span>              <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"C++: Up to date [static] "</span> + file <span class="fstring">" -&gt; "</span> + objname file;
<span class="lineno" id=line179></span>              <span class="small_keyword" title="value of function return used in post condition">result</span> = 0;
<span class="lineno" id=line180></span>            <span class="small_keyword" title="conditional">else</span> 
<span class="lineno" id=line181></span>              <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"C++: Compiling [static] "</span> + file <span class="fstring">" -&gt; "</span> + objname file;
<span class="lineno" id=line182></span>              <span class="small_keyword" title="value of function return used in post condition">result</span> = toolchain.cxx_static_library_object_compiler (src=srcfile, dst=dst);
<span class="lineno" id=line183></span>            <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line184></span>          | <span class="fstring">".c"</span> =&gt;
<span class="lineno" id=line185></span>            fresh = c_depcheck (toolchain, srcfile, dst);
<span class="lineno" id=line186></span>            <span class="small_keyword" title="conditional">if</span> fresh <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line187></span>              <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"C:   Up to date [static] "</span> + file <span class="fstring">" -&gt; "</span> + objname file;
<span class="lineno" id=line188></span>              <span class="small_keyword" title="value of function return used in post condition">result</span> = 0;
<span class="lineno" id=line189></span>            <span class="small_keyword" title="conditional">else</span>
<span class="lineno" id=line190></span>              <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"C:   Compiling [static] "</span> + file <span class="fstring">" -&gt; "</span> + objname file;
<span class="lineno" id=line191></span>              <span class="small_keyword" title="value of function return used in post condition">result</span> = toolchain.c_static_object_compiler (src=srcfile, dst=dst);
<span class="lineno" id=line192></span>            <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line193></span>          | x =&gt; <span class="library" title="Print a string to standard output with newline appended">println</span>$ 
<span class="lineno" id=line194></span>            <span class="fstring">"Unknown extension "</span> + x; 
<span class="lineno" id=line195></span>            <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"Compiler result "</span> + <span class="library" title="Convert a value to a string">str</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line196></span>            <span class="small_keyword" title="jump to label">goto</span> bad;
<span class="lineno" id=line197></span>          <span class="small_keyword" title="end a match statement or expression">endmatch</span>
<span class="lineno" id=line198></span>          ;
<span class="lineno" id=line199></span>          <span class="small_keyword" title="conditional">if</span> <span class="small_keyword" title="value of function return used in post condition">result</span> != 0 <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line200></span>            <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"Compiler result "</span> + <span class="library" title="Convert a value to a string">str</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line201></span>            <span class="small_keyword" title="jump to label">goto</span> bad;
<span class="lineno" id=line202></span>          <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line203></span>        <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line204></span>  
<span class="lineno" id=line205></span>        <span class="big_keyword" title="Define a mutable variable">var</span> objs = unbox (<span class="library" title="return data structure with function applied to each value">map</span> objname files);
<span class="lineno" id=line206></span>        <span class="big_keyword" title="Define a mutable variable">var</span> libname = 
<span class="lineno" id=line207></span>          <span class="small_keyword" title="let binder">let</span> dlib_root = db.getpkgfield1 ehandler (pkg,<span class="fstring">"provides_slib"</span>) <span class="small_keyword" title="membership operator, function mem">in</span>
<span class="lineno" id=line208></span>          <span class="small_keyword" title="conditional">if</span> prefix (dlib_root,<span class="fstring">"-l"</span>) <span class="small_keyword" title="conditional">then</span>  <span class="fstring">"lib"</span>+dlib_root.[2 <span class="small_keyword" title="substring range separator">to</span>]
<span class="lineno" id=line209></span>          <span class="small_keyword" title="conditional">elif</span> prefix (dlib_root,<span class="fstring">"/DEFAULTLIB:"</span>) <span class="small_keyword" title="conditional">then</span> dlib_root.[12 <span class="small_keyword" title="substring range separator">to</span>]
<span class="lineno" id=line210></span>          <span class="small_keyword" title="conditional">else</span> dlib_root 
<span class="lineno" id=line211></span>          <span class="small_keyword" title="conditional">endif</span>
<span class="lineno" id=line212></span>          +#(toolchain.static_library_extension);
<span class="lineno" id=line213></span>        ;
<span class="lineno" id=line214></span>        <span class="big_keyword" title="Define a mutable variable">var</span> dstlib = target_dir/libname;
<span class="lineno" id=line215></span>        <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"Static Linking Library "</span> + dstlib;
<span class="lineno" id=line216></span>        <span class="comment">//println$ "  Source object files = " + objs.str;</span>
<span class="lineno" id=line217></span>        <span class="small_keyword" title="value of function return used in post condition">result</span> = toolchain.static_library_linker(srcs=objs, dst=dstlib);
<span class="lineno" id=line218></span>        <span class="small_keyword" title="conditional">if</span> <span class="small_keyword" title="value of function return used in post condition">result</span> != 0 <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line219></span>          <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"Linker result "</span> + <span class="library" title="Convert a value to a string">str</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line220></span>          <span class="small_keyword" title="jump to label">goto</span> bad;
<span class="lineno" id=line221></span>        <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line222></span>      <span class="small_keyword" title="end of extension">end</span> 
<span class="lineno" id=line223></span>      <span class="small_keyword" title="return">return</span> <span class="library" title="truth value">true</span>;
<span class="lineno" id=line224></span>  bad:&gt;
<span class="lineno" id=line225></span>      <span class="small_keyword" title="return">return</span> <span class="library" title="false value">false</span>;
<span class="lineno" id=line226></span>    }
<span class="lineno" id=line227></span>  }
<span class="lineno" id=line228></span>  
</pre></p></div><h1 id='Toolchains_h'><img src='/share/src/web/images/minus.gif' id='Toolchains' onclick='toggle(this,"Toolchains_d")' alt='+'/> 6 Toolchains</h1><div id='Toolchains_d' style='display:block'>
<p>Toolchains for specific vendor compilers and operating
system combinations.
</p><p>Each specific toolchain is an object which implements
the toolchain interface.
</p><h2 id='Object_for_gcc_on_Linux_h'><img src='/share/src/web/images/minus.gif' id='Object for gcc on Linux' onclick='toggle(this,"Object_for_gcc_on_Linux_d")' alt='+'/> 6.1 Object for gcc on Linux</h2><div id='Object_for_gcc_on_Linux_d' style='display:block'>
<pre class='inclusion'>
share/lib/std/felix/toolchain/gcc_linux.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/toolchain_interface"</span>;
<span class="lineno" id=line2></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/toolchain_config"</span>;
<span class="lineno" id=line3></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/flx_cxx"</span>;
<span class="lineno" id=line4></span>  
<span class="lineno" id=line5></span>  <span class="big_keyword" title="define an object factory">object</span> toolchain_gcc_linux (config:toolchain_config_t) <span class="small_keyword" title="specify what interfaces an object implements">implements</span> toolchain_t = 
<span class="lineno" id=line6></span>  {
<span class="lineno" id=line7></span>  
<span class="lineno" id=line8></span>    <span class="big_keyword" title="Define a mutable variable">var</span> cxx_compile_warning_flags = <span class="library" title="functional, singly linked list">list</span>$ <span class="fstring">"-w"</span>,
<span class="lineno" id=line9></span>      <span class="fstring">"-Wfatal-errors"</span>,
<span class="lineno" id=line10></span>      <span class="fstring">"-Wno-invalid-offsetof"</span>,
<span class="lineno" id=line11></span>      <span class="fstring">"-Wno-parentheses"</span>,
<span class="lineno" id=line12></span>      <span class="fstring">"-Wno-unused-variable"</span>,
<span class="lineno" id=line13></span>      <span class="fstring">"-Wno-unused-label"</span>,
<span class="lineno" id=line14></span>      <span class="fstring">"-Wno-unused-function"</span>,
<span class="lineno" id=line15></span>      <span class="fstring">"-Wno-sign-compare"</span>,
<span class="lineno" id=line16></span>      <span class="fstring">"-Wno-missing-braces"</span>
<span class="lineno" id=line17></span>    ;
<span class="lineno" id=line18></span>    <span class="big_keyword" title="Define a mutable variable">var</span> c_compile_warning_flags = <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>]$ <span class="fstring">"-w"</span>, <span class="fstring">"-Wfatal-errors"</span>;
<span class="lineno" id=line19></span>  
<span class="lineno" id=line20></span>    <span class="big_keyword" title="Define a mutable variable">var</span> c_compiler = <span class="small_keyword" title="let binder">let</span> x = config.c_compiler_executable <span class="small_keyword" title="membership operator, function mem">in</span> <span class="small_keyword" title="conditional">if</span> x == <span class="fstring">""</span> <span class="small_keyword" title="conditional">then</span> <span class="fstring">"gcc"</span> <span class="small_keyword" title="conditional">else</span> x;
<span class="lineno" id=line21></span>    <span class="big_keyword" title="Define a mutable variable">var</span> cxx_compiler = <span class="small_keyword" title="let binder">let</span> x = config.cxx_compiler_executable <span class="small_keyword" title="membership operator, function mem">in</span> <span class="small_keyword" title="conditional">if</span> x == <span class="fstring">""</span> <span class="small_keyword" title="conditional">then</span> <span class="fstring">"g++"</span> <span class="small_keyword" title="conditional">else</span> x;
<span class="lineno" id=line22></span>    <span class="big_keyword" title="Define a mutable variable">var</span> linker = cxx_compiler;
<span class="lineno" id=line23></span>  
<span class="lineno" id=line24></span>    <span class="big_keyword" title="Define a mutable variable">var</span> ccflags_for_dynamic_link = <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>] (<span class="fstring">"-shared"</span>);
<span class="lineno" id=line25></span>    <span class="big_keyword" title="Define a mutable variable">var</span> base_c_compile_flags =
<span class="lineno" id=line26></span>      <span class="fstring">"-D_POSIX"</span> ! <span class="fstring">"-g"</span> ! <span class="fstring">"-c"</span> ! <span class="fstring">"-O1"</span> ! <span class="fstring">"-fno-common"</span>
<span class="lineno" id=line27></span>      ! <span class="fstring">"-fno-strict-aliasing"</span> ! (c_compile_warning_flags+config.ccflags)
<span class="lineno" id=line28></span>    ;
<span class="lineno" id=line29></span>    <span class="big_keyword" title="Define a mutable variable">var</span> base_cxx_compile_flags = 
<span class="lineno" id=line30></span>      <span class="fstring">"-D_POSIX"</span> ! <span class="fstring">"-g"</span>! <span class="fstring">"-c"</span> ! <span class="fstring">"-O1"</span> ! <span class="fstring">"-fno-common"</span>
<span class="lineno" id=line31></span>      ! <span class="fstring">"-fno-strict-aliasing"</span> ! <span class="fstring">"-std=gnu++14"</span> ! (cxx_compile_warning_flags+config.ccflags)
<span class="lineno" id=line32></span>    ;
<span class="lineno" id=line33></span>  
<span class="lineno" id=line34></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> whatami () =&gt; <span class="fstring">"toolchain_gcc_linux (version 2)"</span>;
<span class="lineno" id=line35></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> host_os () =&gt; <span class="fstring">"LINUX"</span>;
<span class="lineno" id=line36></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> target_os () =&gt; <span class="fstring">"LINUX"</span>;
<span class="lineno" id=line37></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> cxx_compiler_vendor () =&gt; <span class="fstring">"GNU"</span>;
<span class="lineno" id=line38></span>  
<span class="lineno" id=line39></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> dependency_extension () =&gt; <span class="fstring">".d"</span>;
<span class="lineno" id=line40></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> executable_extension () =&gt; <span class="fstring">""</span>;
<span class="lineno" id=line41></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> static_object_extension () =&gt; <span class="fstring">"_static.o"</span>;
<span class="lineno" id=line42></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> dynamic_object_extension () =&gt; <span class="fstring">"_dynamic.o"</span>;
<span class="lineno" id=line43></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> static_library_extension () =&gt; <span class="fstring">".a"</span>;
<span class="lineno" id=line44></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> dynamic_library_extension () =&gt; <span class="fstring">".so"</span>;
<span class="lineno" id=line45></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> pathname_separator () =&gt; <span class="fstring">"/"</span>;
<span class="lineno" id=line46></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> debug_flags () =&gt;<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>] <span class="fstring">"-g"</span>;
<span class="lineno" id=line47></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> get_base_c_compile_flags () =&gt; base_c_compile_flags;
<span class="lineno" id=line48></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> get_base_cxx_compile_flags () =&gt; base_cxx_compile_flags;
<span class="lineno" id=line49></span>  
<span class="lineno" id=line50></span>  <span class="comment">// Boilerplate </span>
<span class="lineno" id=line51></span>  
<span class="lineno" id=line52></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> c_dependency_generator (spec:(src:<span class="library" title="binding of C++ string type">string</span>)) =
<span class="lineno" id=line53></span>    {
<span class="lineno" id=line54></span>       <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>, data = 
<span class="lineno" id=line55></span>         CxxCompiler::generic_cxx_gen_deps 
<span class="lineno" id=line56></span>         (
<span class="lineno" id=line57></span>            CCDEP=c_compiler,
<span class="lineno" id=line58></span>            CCFLAGS = <span class="fstring">"-MM"</span> ! <span class="fstring">"-D_POSIX"</span> ! config.ccflags,
<span class="lineno" id=line59></span>            INCLUDE_DIRS=config.header_search_dirs,
<span class="lineno" id=line60></span>            MACROS=config.macros,
<span class="lineno" id=line61></span>            debugln = config.debugln
<span class="lineno" id=line62></span>         )
<span class="lineno" id=line63></span>         (spec.src)
<span class="lineno" id=line64></span>       ;
<span class="lineno" id=line65></span>       <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>, data;
<span class="lineno" id=line66></span>    }
<span class="lineno" id=line67></span>  
<span class="lineno" id=line68></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_dependency_generator (spec:(src:<span class="library" title="binding of C++ string type">string</span>)) =
<span class="lineno" id=line69></span>    {
<span class="lineno" id=line70></span>       <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>, data = 
<span class="lineno" id=line71></span>         CxxCompiler::generic_cxx_gen_deps 
<span class="lineno" id=line72></span>         (
<span class="lineno" id=line73></span>            CCDEP=cxx_compiler,
<span class="lineno" id=line74></span>            CCFLAGS = <span class="fstring">"-MM"</span> ! <span class="fstring">"-D_POSIX"</span> ! <span class="fstring">"-std=gnu++14"</span> ! config.ccflags,
<span class="lineno" id=line75></span>            INCLUDE_DIRS=config.header_search_dirs,
<span class="lineno" id=line76></span>            MACROS=config.macros,
<span class="lineno" id=line77></span>            debugln = config.debugln
<span class="lineno" id=line78></span>         )
<span class="lineno" id=line79></span>         (spec.src)
<span class="lineno" id=line80></span>       ;
<span class="lineno" id=line81></span>       <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>, data;
<span class="lineno" id=line82></span>    }
<span class="lineno" id=line83></span>  
<span class="lineno" id=line84></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> dependency_parser (data:<span class="library" title="binding of C++ string type">string</span>) : <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>] =&gt;
<span class="lineno" id=line85></span>       CxxCompiler::generic_dependency_parser data
<span class="lineno" id=line86></span>    ;
<span class="lineno" id=line87></span>   
<span class="lineno" id=line88></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> c_static_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line89></span>    {
<span class="lineno" id=line90></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line91></span>        CxxCompiler::generic_cxx_compile_for_static
<span class="lineno" id=line92></span>    <span class="comment">// case 2 of dflt</span>
<span class="lineno" id=line93></span>        (
<span class="lineno" id=line94></span>          CCOBJ_STATIC_LIB = c_compiler, 
<span class="lineno" id=line95></span>          CCFLAGS = <span class="fstring">"-fvisibility=hidden"</span> ! base_c_compile_flags,
<span class="lineno" id=line96></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line97></span>          MACROS = config.macros,
<span class="lineno" id=line98></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line99></span>          debugln = config.debugln
<span class="lineno" id=line100></span>        ) 
<span class="lineno" id=line101></span>        (spec.src, spec.dst)
<span class="lineno" id=line102></span>      ;
<span class="lineno" id=line103></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line104></span>    }
<span class="lineno" id=line105></span>  
<span class="lineno" id=line106></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> c_dynamic_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line107></span>    {
<span class="lineno" id=line108></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line109></span>        CxxCompiler::generic_cxx_compile_for_dynamic 
<span class="lineno" id=line110></span>        (
<span class="lineno" id=line111></span>          CCOBJ_DLLIB = c_compiler, 
<span class="lineno" id=line112></span>          CCFLAGS = <span class="fstring">"-fPIC"</span> ! <span class="fstring">"-fvisibility=hidden"</span> ! base_c_compile_flags,
<span class="lineno" id=line113></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line114></span>          MACROS = config.macros,
<span class="lineno" id=line115></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line116></span>          debugln = config.debugln
<span class="lineno" id=line117></span>        ) 
<span class="lineno" id=line118></span>        (spec.src, spec.dst)
<span class="lineno" id=line119></span>      ;
<span class="lineno" id=line120></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line121></span>    }
<span class="lineno" id=line122></span>  
<span class="lineno" id=line123></span>  
<span class="lineno" id=line124></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_static_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line125></span>    {
<span class="lineno" id=line126></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line127></span>        CxxCompiler::generic_cxx_compile_for_static
<span class="lineno" id=line128></span>        (
<span class="lineno" id=line129></span>          CCOBJ_STATIC_LIB = cxx_compiler, 
<span class="lineno" id=line130></span>          CCFLAGS = <span class="fstring">"-fvisibility=hidden"</span> !<span class="fstring">"-g"</span>! <span class="fstring">"-c"</span> ! <span class="fstring">"-O1"</span> ! <span class="fstring">"-fno-common"</span>! <span class="fstring">"-fno-strict-aliasing"</span> 
<span class="lineno" id=line131></span>            ! <span class="fstring">"-D_POSIX"</span> ! <span class="fstring">"-std=gnu++14"</span> ! <span class="fstring">"-D_GLIBCXX_USE_CXX11_ABI=1"</span>
<span class="lineno" id=line132></span>            ! (cxx_compile_warning_flags+config.ccflags),
<span class="lineno" id=line133></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line134></span>          MACROS = config.macros,
<span class="lineno" id=line135></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line136></span>          debugln = config.debugln
<span class="lineno" id=line137></span>        ) 
<span class="lineno" id=line138></span>        (spec.src, spec.dst)
<span class="lineno" id=line139></span>      ;
<span class="lineno" id=line140></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line141></span>    }
<span class="lineno" id=line142></span>  
<span class="lineno" id=line143></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_static_library_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line144></span>    {
<span class="lineno" id=line145></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line146></span>        CxxCompiler::generic_cxx_compile_for_static
<span class="lineno" id=line147></span>        (
<span class="lineno" id=line148></span>          CCOBJ_STATIC_LIB = cxx_compiler, 
<span class="lineno" id=line149></span>          CCFLAGS = <span class="fstring">"-fvisibility=hidden"</span> ! <span class="fstring">"-D_GLIBCXX_USE_CXX11_ABI=1"</span>!base_cxx_compile_flags,
<span class="lineno" id=line150></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line151></span>          MACROS = <span class="fstring">"FLX_STATIC_LINK"</span>+config.macros,
<span class="lineno" id=line152></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line153></span>          debugln = config.debugln
<span class="lineno" id=line154></span>        ) 
<span class="lineno" id=line155></span>        (spec.src, spec.dst)
<span class="lineno" id=line156></span>      ;
<span class="lineno" id=line157></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line158></span>    }
<span class="lineno" id=line159></span>  
<span class="lineno" id=line160></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_dynamic_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line161></span>    {
<span class="lineno" id=line162></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line163></span>        CxxCompiler::generic_cxx_compile_for_dynamic 
<span class="lineno" id=line164></span>        (
<span class="lineno" id=line165></span>          CCOBJ_DLLIB = linker, 
<span class="lineno" id=line166></span>          CCFLAGS = <span class="fstring">"-fPIC"</span> ! <span class="fstring">"-fvisibility=hidden"</span> ! <span class="fstring">"-D_GLIBCXX_USE_CXX11_ABI=1"</span>! base_cxx_compile_flags,
<span class="lineno" id=line167></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line168></span>          MACROS = config.macros,
<span class="lineno" id=line169></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line170></span>          debugln = config.debugln
<span class="lineno" id=line171></span>        ) 
<span class="lineno" id=line172></span>        (spec.src, spec.dst)
<span class="lineno" id=line173></span>      ;
<span class="lineno" id=line174></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line175></span>    }
<span class="lineno" id=line176></span>  
<span class="lineno" id=line177></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> static_library_linker (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])): <span class="library" title="binding of C int type">int</span> =
<span class="lineno" id=line178></span>    {
<span class="lineno" id=line179></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> =
<span class="lineno" id=line180></span>        CxxCompiler::generic_static_library
<span class="lineno" id=line181></span>        (
<span class="lineno" id=line182></span>          CCLINK_STATIC_LIB = <span class="fstring">"ar"</span>, 
<span class="lineno" id=line183></span>          CCFLAGS = <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>](<span class="fstring">"-rcs"</span>),
<span class="lineno" id=line184></span>          SPEC_LIB_FILENAME = <span class="fstring">""</span>,
<span class="lineno" id=line185></span>          debugln = config.debugln
<span class="lineno" id=line186></span>        )  
<span class="lineno" id=line187></span>        (spec.srcs, spec.dst)
<span class="lineno" id=line188></span>      ;
<span class="lineno" id=line189></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line190></span>    } 
<span class="lineno" id=line191></span>  
<span class="lineno" id=line192></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> static_executable_linker  (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line193></span>    {
<span class="lineno" id=line194></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> =
<span class="lineno" id=line195></span>        CxxCompiler::generic_link_exe_static
<span class="lineno" id=line196></span>        (
<span class="lineno" id=line197></span>          CCLINK_STATIC = linker,
<span class="lineno" id=line198></span>          CCFLAGS = Empty[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line199></span>          SPEC_EXE_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line200></span>          LINK_STRINGS = config.library_search_dirs + config.static_libraries,
<span class="lineno" id=line201></span>          debugln = config.debugln
<span class="lineno" id=line202></span>        )  
<span class="lineno" id=line203></span>        (spec.srcs, spec.dst)
<span class="lineno" id=line204></span>      ;
<span class="lineno" id=line205></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line206></span>    }
<span class="lineno" id=line207></span>  
<span class="lineno" id=line208></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> dynamic_executable_linker  (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line209></span>    {
<span class="lineno" id=line210></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> =
<span class="lineno" id=line211></span>        CxxCompiler::generic_link_exe_dynamic
<span class="lineno" id=line212></span>        (
<span class="lineno" id=line213></span>          CCLINK_STATIC = linker,
<span class="lineno" id=line214></span>          CCFLAGS = Empty[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line215></span>          SPEC_EXE_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line216></span>          LINK_STRINGS = config.library_search_dirs + config.dynamic_libraries,
<span class="lineno" id=line217></span>          debugln = config.debugln
<span class="lineno" id=line218></span>        )  
<span class="lineno" id=line219></span>        (spec.srcs, spec.dst)
<span class="lineno" id=line220></span>      ;
<span class="lineno" id=line221></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line222></span>    }
<span class="lineno" id=line223></span>  
<span class="lineno" id=line224></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> dynamic_library_linker (spec:(dst:<span class="library" title="binding of C++ string type">string</span>,srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line225></span>    {
<span class="lineno" id=line226></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line227></span>        CxxCompiler::generic_link_lib_dynamic 
<span class="lineno" id=line228></span>        (
<span class="lineno" id=line229></span>          CCLINK_DLLIB = linker,
<span class="lineno" id=line230></span>          CCFLAGS = ccflags_for_dynamic_link,
<span class="lineno" id=line231></span>          EXT_SHARED_OBJ = #dynamic_library_extension,
<span class="lineno" id=line232></span>          SPEC_EXE_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line233></span>          LINK_STRINGS = config.library_search_dirs + config.dynamic_libraries, 
<span class="lineno" id=line234></span>          debugln = config.debugln
<span class="lineno" id=line235></span>        )
<span class="lineno" id=line236></span>        (spec.srcs, spec.dst)
<span class="lineno" id=line237></span>      ;
<span class="lineno" id=line238></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line239></span>    }
<span class="lineno" id=line240></span>  }
<span class="lineno" id=line241></span>  
</pre></p></div><h2 id='Object_for_gcc_on_OSX_h'><img src='/share/src/web/images/minus.gif' id='Object for gcc on OSX' onclick='toggle(this,"Object_for_gcc_on_OSX_d")' alt='+'/> 6.2 Object for gcc on OSX</h2><div id='Object_for_gcc_on_OSX_d' style='display:block'>
<pre class='inclusion'>
share/lib/std/felix/toolchain/gcc_macosx.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/toolchain_interface"</span>;
<span class="lineno" id=line2></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/toolchain_config"</span>;
<span class="lineno" id=line3></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/flx_cxx"</span>;
<span class="lineno" id=line4></span>  
<span class="lineno" id=line5></span>  <span class="big_keyword" title="define an object factory">object</span> toolchain_gcc_macosx (config:toolchain_config_t) <span class="small_keyword" title="specify what interfaces an object implements">implements</span> toolchain_t = 
<span class="lineno" id=line6></span>  {
<span class="lineno" id=line7></span>  
<span class="lineno" id=line8></span>    <span class="big_keyword" title="Define a mutable variable">var</span> cxx_compile_warning_flags = <span class="library" title="functional, singly linked list">list</span>$ <span class="fstring">"-w"</span>,
<span class="lineno" id=line9></span>      <span class="fstring">"-Wfatal-errors"</span>,
<span class="lineno" id=line10></span>      <span class="fstring">"-Wno-invalid-offsetof"</span>
<span class="lineno" id=line11></span>    ;
<span class="lineno" id=line12></span>    <span class="big_keyword" title="Define a mutable variable">var</span> c_compile_warning_flags = <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>]$ <span class="fstring">"-w"</span>,<span class="fstring">"-Wfatal-errors"</span>;
<span class="lineno" id=line13></span>  
<span class="lineno" id=line14></span>    <span class="big_keyword" title="Define a mutable variable">var</span> c_compiler = <span class="small_keyword" title="let binder">let</span> x = config.c_compiler_executable <span class="small_keyword" title="membership operator, function mem">in</span> <span class="small_keyword" title="conditional">if</span> x == <span class="fstring">""</span> <span class="small_keyword" title="conditional">then</span> <span class="fstring">"gcc"</span> <span class="small_keyword" title="conditional">else</span> x;
<span class="lineno" id=line15></span>    <span class="big_keyword" title="Define a mutable variable">var</span> cxx_compiler = <span class="small_keyword" title="let binder">let</span> x = config.cxx_compiler_executable <span class="small_keyword" title="membership operator, function mem">in</span> <span class="small_keyword" title="conditional">if</span> x == <span class="fstring">""</span> <span class="small_keyword" title="conditional">then</span> <span class="fstring">"g++"</span> <span class="small_keyword" title="conditional">else</span> x;
<span class="lineno" id=line16></span>    <span class="big_keyword" title="Define a mutable variable">var</span> linker = cxx_compiler;
<span class="lineno" id=line17></span>  
<span class="lineno" id=line18></span>    <span class="big_keyword" title="Define a mutable variable">var</span> ccflags_for_dynamic_link = <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>] (<span class="fstring">"-dynamiclib"</span>);
<span class="lineno" id=line19></span>  
<span class="lineno" id=line20></span>    <span class="big_keyword" title="Define a mutable variable">var</span> base_c_compile_flags =
<span class="lineno" id=line21></span>      <span class="fstring">"-g"</span>! <span class="fstring">"-c"</span> ! <span class="fstring">"-O1"</span> ! <span class="fstring">"-fno-common"</span>! <span class="fstring">"-fno-strict-aliasing"</span> ! (c_compile_warning_flags+config.ccflags)
<span class="lineno" id=line22></span>    ;
<span class="lineno" id=line23></span>    <span class="big_keyword" title="Define a mutable variable">var</span> base_cxx_compile_flags =
<span class="lineno" id=line24></span>      <span class="fstring">"-g"</span>! <span class="fstring">"-c"</span> ! <span class="fstring">"-O1"</span> ! <span class="fstring">"-std=c++14"</span> ! <span class="fstring">"-fno-common"</span>! <span class="fstring">"-fno-strict-aliasing"</span> !(cxx_compile_warning_flags+config.ccflags)
<span class="lineno" id=line25></span>    ;
<span class="lineno" id=line26></span>  
<span class="lineno" id=line27></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> whatami () =&gt; <span class="fstring">"toolchain_gcc_macosx (version 2)"</span>;
<span class="lineno" id=line28></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> host_os () =&gt; <span class="fstring">"OSX"</span>;
<span class="lineno" id=line29></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> target_os () =&gt; <span class="fstring">"OSX"</span>;
<span class="lineno" id=line30></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> cxx_compiler_vendor () =&gt; <span class="fstring">"GNU"</span>;
<span class="lineno" id=line31></span>  
<span class="lineno" id=line32></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> dependency_extension () =&gt; <span class="fstring">".d"</span>;
<span class="lineno" id=line33></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> executable_extension () =&gt; <span class="fstring">""</span>;
<span class="lineno" id=line34></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> static_object_extension () =&gt; <span class="fstring">"_static.o"</span>;
<span class="lineno" id=line35></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> dynamic_object_extension () =&gt; <span class="fstring">"_dynamic.o"</span>;
<span class="lineno" id=line36></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> static_library_extension () =&gt; <span class="fstring">".a"</span>;
<span class="lineno" id=line37></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> dynamic_library_extension () =&gt; <span class="fstring">".dylib"</span>;
<span class="lineno" id=line38></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> pathname_separator () =&gt; <span class="fstring">"/"</span>;
<span class="lineno" id=line39></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> debug_flags () =&gt; <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>] <span class="fstring">"-g"</span>;
<span class="lineno" id=line40></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> get_base_c_compile_flags () =&gt; base_c_compile_flags;
<span class="lineno" id=line41></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> get_base_cxx_compile_flags () =&gt; base_cxx_compile_flags;
<span class="lineno" id=line42></span>  
<span class="lineno" id=line43></span>  <span class="comment">// Boilerplate </span>
<span class="lineno" id=line44></span>  
<span class="lineno" id=line45></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> c_dependency_generator (spec:(src:<span class="library" title="binding of C++ string type">string</span>)) =
<span class="lineno" id=line46></span>    {
<span class="lineno" id=line47></span>       <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>, data = 
<span class="lineno" id=line48></span>         CxxCompiler::generic_cxx_gen_deps 
<span class="lineno" id=line49></span>         (
<span class="lineno" id=line50></span>            CCDEP=c_compiler,
<span class="lineno" id=line51></span>            CCFLAGS = <span class="fstring">"-MM"</span> ! config.ccflags,
<span class="lineno" id=line52></span>            INCLUDE_DIRS=config.header_search_dirs,
<span class="lineno" id=line53></span>            MACROS=config.macros,
<span class="lineno" id=line54></span>            debugln = config.debugln
<span class="lineno" id=line55></span>         )
<span class="lineno" id=line56></span>         (spec.src)
<span class="lineno" id=line57></span>       ;
<span class="lineno" id=line58></span>       <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span> , data;
<span class="lineno" id=line59></span>    }
<span class="lineno" id=line60></span>  
<span class="lineno" id=line61></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_dependency_generator (spec:(src:<span class="library" title="binding of C++ string type">string</span>)) =
<span class="lineno" id=line62></span>    {
<span class="lineno" id=line63></span>       <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>, data = 
<span class="lineno" id=line64></span>         CxxCompiler::generic_cxx_gen_deps 
<span class="lineno" id=line65></span>         (
<span class="lineno" id=line66></span>            CCDEP=cxx_compiler,
<span class="lineno" id=line67></span>            CCFLAGS = <span class="fstring">"-MM"</span> ! <span class="fstring">'-std=c++14'</span> ! config.ccflags,
<span class="lineno" id=line68></span>            INCLUDE_DIRS=config.header_search_dirs,
<span class="lineno" id=line69></span>            MACROS=config.macros,
<span class="lineno" id=line70></span>            debugln = config.debugln
<span class="lineno" id=line71></span>         )
<span class="lineno" id=line72></span>         (spec.src)
<span class="lineno" id=line73></span>       ;
<span class="lineno" id=line74></span>       <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>, data;
<span class="lineno" id=line75></span>    }
<span class="lineno" id=line76></span>  
<span class="lineno" id=line77></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> dependency_parser (data:<span class="library" title="binding of C++ string type">string</span>) : <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>] =&gt;
<span class="lineno" id=line78></span>       CxxCompiler::generic_dependency_parser data
<span class="lineno" id=line79></span>    ;
<span class="lineno" id=line80></span>   
<span class="lineno" id=line81></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> c_static_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line82></span>    {
<span class="lineno" id=line83></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line84></span>        CxxCompiler::generic_cxx_compile_for_static
<span class="lineno" id=line85></span>        (
<span class="lineno" id=line86></span>          CCOBJ_STATIC_LIB = c_compiler, 
<span class="lineno" id=line87></span>          CCFLAGS = base_c_compile_flags,
<span class="lineno" id=line88></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line89></span>          MACROS = config.macros,
<span class="lineno" id=line90></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line91></span>          debugln = config.debugln
<span class="lineno" id=line92></span>        ) 
<span class="lineno" id=line93></span>        (spec.src, spec.dst)
<span class="lineno" id=line94></span>      ;
<span class="lineno" id=line95></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line96></span>    }
<span class="lineno" id=line97></span>  
<span class="lineno" id=line98></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> c_dynamic_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line99></span>    {
<span class="lineno" id=line100></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line101></span>        CxxCompiler::generic_cxx_compile_for_dynamic 
<span class="lineno" id=line102></span>        (
<span class="lineno" id=line103></span>          CCOBJ_DLLIB = c_compiler, 
<span class="lineno" id=line104></span>          CCFLAGS = <span class="fstring">"-fPIC"</span> ! <span class="fstring">"-fvisibility=hidden"</span> ! base_c_compile_flags,
<span class="lineno" id=line105></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line106></span>          MACROS = config.macros,
<span class="lineno" id=line107></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line108></span>          debugln = config.debugln
<span class="lineno" id=line109></span>        ) 
<span class="lineno" id=line110></span>        (spec.src, spec.dst)
<span class="lineno" id=line111></span>      ;
<span class="lineno" id=line112></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line113></span>    }
<span class="lineno" id=line114></span>  
<span class="lineno" id=line115></span>  
<span class="lineno" id=line116></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_static_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line117></span>    {
<span class="lineno" id=line118></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line119></span>        CxxCompiler::generic_cxx_compile_for_static
<span class="lineno" id=line120></span>        (
<span class="lineno" id=line121></span>          CCOBJ_STATIC_LIB = cxx_compiler, 
<span class="lineno" id=line122></span>          CCFLAGS = base_cxx_compile_flags,
<span class="lineno" id=line123></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line124></span>          MACROS = config.macros,
<span class="lineno" id=line125></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line126></span>          debugln = config.debugln
<span class="lineno" id=line127></span>        ) 
<span class="lineno" id=line128></span>        (spec.src, spec.dst)
<span class="lineno" id=line129></span>      ;
<span class="lineno" id=line130></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line131></span>    }
<span class="lineno" id=line132></span>  
<span class="lineno" id=line133></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_static_library_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line134></span>    {
<span class="lineno" id=line135></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line136></span>        CxxCompiler::generic_cxx_compile_for_static
<span class="lineno" id=line137></span>        (
<span class="lineno" id=line138></span>          CCOBJ_STATIC_LIB = cxx_compiler, 
<span class="lineno" id=line139></span>          CCFLAGS = base_cxx_compile_flags,
<span class="lineno" id=line140></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line141></span>          MACROS = <span class="fstring">"FLX_STATIC_LINK"</span> + config.macros,
<span class="lineno" id=line142></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line143></span>          debugln = config.debugln
<span class="lineno" id=line144></span>        ) 
<span class="lineno" id=line145></span>        (spec.src, spec.dst)
<span class="lineno" id=line146></span>      ;
<span class="lineno" id=line147></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line148></span>    }
<span class="lineno" id=line149></span>  
<span class="lineno" id=line150></span>  
<span class="lineno" id=line151></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_dynamic_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line152></span>    {
<span class="lineno" id=line153></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line154></span>        CxxCompiler::generic_cxx_compile_for_dynamic 
<span class="lineno" id=line155></span>        (
<span class="lineno" id=line156></span>          CCOBJ_DLLIB = linker, 
<span class="lineno" id=line157></span>          CCFLAGS = <span class="fstring">"-fPIC"</span> ! <span class="fstring">"-fvisibility=hidden"</span> ! base_cxx_compile_flags,
<span class="lineno" id=line158></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line159></span>          MACROS = config.macros,
<span class="lineno" id=line160></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line161></span>          debugln = config.debugln
<span class="lineno" id=line162></span>        ) 
<span class="lineno" id=line163></span>        (spec.src, spec.dst)
<span class="lineno" id=line164></span>      ;
<span class="lineno" id=line165></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line166></span>    }
<span class="lineno" id=line167></span>  
<span class="lineno" id=line168></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> static_library_linker (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])): <span class="library" title="binding of C int type">int</span> =
<span class="lineno" id=line169></span>    {
<span class="lineno" id=line170></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> =
<span class="lineno" id=line171></span>        CxxCompiler::generic_static_library
<span class="lineno" id=line172></span>        (
<span class="lineno" id=line173></span>          CCLINK_STATIC_LIB = <span class="fstring">"ar"</span>, 
<span class="lineno" id=line174></span>          CCFLAGS = <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>](<span class="fstring">"-rcs"</span>),
<span class="lineno" id=line175></span>          SPEC_LIB_FILENAME = <span class="fstring">""</span>,
<span class="lineno" id=line176></span>          debugln = config.debugln
<span class="lineno" id=line177></span>        )  
<span class="lineno" id=line178></span>        (spec.srcs, spec.dst)
<span class="lineno" id=line179></span>      ;
<span class="lineno" id=line180></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line181></span>    } 
<span class="lineno" id=line182></span>  
<span class="lineno" id=line183></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> static_executable_linker  (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line184></span>    {
<span class="lineno" id=line185></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> =
<span class="lineno" id=line186></span>        CxxCompiler::generic_link_exe_static
<span class="lineno" id=line187></span>        (
<span class="lineno" id=line188></span>          CCLINK_STATIC = linker,
<span class="lineno" id=line189></span>          CCFLAGS = Empty[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line190></span>          SPEC_EXE_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line191></span>          LINK_STRINGS = config.library_search_dirs + config.static_libraries,
<span class="lineno" id=line192></span>          debugln = config.debugln
<span class="lineno" id=line193></span>        )  
<span class="lineno" id=line194></span>        (spec.srcs, spec.dst)
<span class="lineno" id=line195></span>      ;
<span class="lineno" id=line196></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line197></span>    }
<span class="lineno" id=line198></span>  
<span class="lineno" id=line199></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> dynamic_executable_linker  (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line200></span>    {
<span class="lineno" id=line201></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> =
<span class="lineno" id=line202></span>        CxxCompiler::generic_link_exe_dynamic
<span class="lineno" id=line203></span>        (
<span class="lineno" id=line204></span>          CCLINK_STATIC = linker,
<span class="lineno" id=line205></span>          CCFLAGS = Empty[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line206></span>          SPEC_EXE_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line207></span>          LINK_STRINGS = config.library_search_dirs + config.dynamic_libraries,
<span class="lineno" id=line208></span>          debugln = config.debugln
<span class="lineno" id=line209></span>        )  
<span class="lineno" id=line210></span>        (spec.srcs, spec.dst)
<span class="lineno" id=line211></span>      ;
<span class="lineno" id=line212></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line213></span>    }
<span class="lineno" id=line214></span>  
<span class="lineno" id=line215></span>  
<span class="lineno" id=line216></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> dynamic_library_linker (spec:(dst:<span class="library" title="binding of C++ string type">string</span>,srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line217></span>    {
<span class="lineno" id=line218></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line219></span>        CxxCompiler::generic_link_lib_dynamic 
<span class="lineno" id=line220></span>        (
<span class="lineno" id=line221></span>          CCLINK_DLLIB = linker,
<span class="lineno" id=line222></span>          CCFLAGS = ccflags_for_dynamic_link,
<span class="lineno" id=line223></span>          EXT_SHARED_OBJ = #dynamic_library_extension,
<span class="lineno" id=line224></span>          SPEC_EXE_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line225></span>          LINK_STRINGS = config.library_search_dirs + config.dynamic_libraries, 
<span class="lineno" id=line226></span>          debugln = config.debugln
<span class="lineno" id=line227></span>        )
<span class="lineno" id=line228></span>        (spec.srcs, spec.dst)
<span class="lineno" id=line229></span>      ;
<span class="lineno" id=line230></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line231></span>    }
<span class="lineno" id=line232></span>  }
<span class="lineno" id=line233></span>  
</pre></p></div><h2 id='Object_for_clang_on_Linux_h'><img src='/share/src/web/images/minus.gif' id='Object for clang on Linux' onclick='toggle(this,"Object_for_clang_on_Linux_d")' alt='+'/> 6.3 Object for clang on Linux</h2><div id='Object_for_clang_on_Linux_d' style='display:block'>
<pre class='inclusion'>
share/lib/std/felix/toolchain/clang_linux.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/toolchain_interface"</span>;
<span class="lineno" id=line2></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/toolchain_config"</span>;
<span class="lineno" id=line3></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/flx_cxx"</span>;
<span class="lineno" id=line4></span>  
<span class="lineno" id=line5></span>  <span class="big_keyword" title="define an object factory">object</span> toolchain_clang_linux (config:toolchain_config_t) <span class="small_keyword" title="specify what interfaces an object implements">implements</span> toolchain_t = 
<span class="lineno" id=line6></span>  {
<span class="lineno" id=line7></span>  
<span class="lineno" id=line8></span>    <span class="big_keyword" title="Define a mutable variable">var</span> cxx_compile_warning_flags = <span class="library" title="functional, singly linked list">list</span>$  <span class="fstring">"-w"</span>,
<span class="lineno" id=line9></span>      <span class="fstring">"-Wfatal-errors"</span>,
<span class="lineno" id=line10></span>      <span class="fstring">"-Wno-invalid-offsetof"</span>,
<span class="lineno" id=line11></span>      <span class="fstring">"-Wno-logical-op-parentheses"</span>,
<span class="lineno" id=line12></span>      <span class="fstring">"-Wno-bitwise-op-parentheses"</span>,
<span class="lineno" id=line13></span>      <span class="fstring">"-Wno-parentheses-equality"</span>,
<span class="lineno" id=line14></span>      <span class="fstring">"-Wno-parentheses"</span>,
<span class="lineno" id=line15></span>      <span class="fstring">"-Wno-return-stack-address"</span>,
<span class="lineno" id=line16></span>      <span class="fstring">"-Wno-tautological-compare"</span>,
<span class="lineno" id=line17></span>      <span class="fstring">"-Wno-return-type-c-linkage"</span>,
<span class="lineno" id=line18></span>      <span class="fstring">"-Wno-unused-variable"</span>,
<span class="lineno" id=line19></span>      <span class="fstring">"-Wno-unused-function"</span>,
<span class="lineno" id=line20></span>      <span class="fstring">"-Wno-c++11-narrowing"</span>,
<span class="lineno" id=line21></span>      <span class="fstring">"-Wno-missing-braces"</span>
<span class="lineno" id=line22></span>    ;
<span class="lineno" id=line23></span>    <span class="big_keyword" title="Define a mutable variable">var</span> c_compile_warning_flags = <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>]$ <span class="fstring">"-w"</span>,<span class="fstring">"-Wfatal-errors"</span>;
<span class="lineno" id=line24></span>  
<span class="lineno" id=line25></span>    <span class="big_keyword" title="Define a mutable variable">var</span> c_compiler = <span class="small_keyword" title="let binder">let</span> x = config.c_compiler_executable <span class="small_keyword" title="membership operator, function mem">in</span> <span class="small_keyword" title="conditional">if</span> x == <span class="fstring">""</span> <span class="small_keyword" title="conditional">then</span> <span class="fstring">"clang"</span> <span class="small_keyword" title="conditional">else</span> x;
<span class="lineno" id=line26></span>    <span class="big_keyword" title="Define a mutable variable">var</span> cxx_compiler = <span class="small_keyword" title="let binder">let</span> x = config.cxx_compiler_executable <span class="small_keyword" title="membership operator, function mem">in</span> <span class="small_keyword" title="conditional">if</span> x == <span class="fstring">""</span> <span class="small_keyword" title="conditional">then</span> <span class="fstring">"clang++"</span> <span class="small_keyword" title="conditional">else</span> x;
<span class="lineno" id=line27></span>    <span class="big_keyword" title="Define a mutable variable">var</span> linker = cxx_compiler;
<span class="lineno" id=line28></span>  
<span class="lineno" id=line29></span>    <span class="big_keyword" title="Define a mutable variable">var</span> ccflags_for_dynamic_link = <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>] (<span class="fstring">"-shared"</span>);
<span class="lineno" id=line30></span>  
<span class="lineno" id=line31></span>    <span class="big_keyword" title="Define a mutable variable">var</span> base_cxx_compile_flags =  
<span class="lineno" id=line32></span>       <span class="fstring">"-std=c++14"</span>! <span class="fstring">"-g"</span>! <span class="fstring">"-c"</span> ! <span class="fstring">"-O1"</span> ! <span class="fstring">"-fno-common"</span>! <span class="fstring">"-fno-strict-aliasing"</span> ! <span class="fstring">"-fblocks"</span> ! (cxx_compile_warning_flags+config.ccflags)
<span class="lineno" id=line33></span>    ;
<span class="lineno" id=line34></span>  
<span class="lineno" id=line35></span>    <span class="big_keyword" title="Define a mutable variable">var</span> base_c_compile_flags =  
<span class="lineno" id=line36></span>       <span class="fstring">"-g"</span>! <span class="fstring">"-c"</span> ! <span class="fstring">"-O1"</span> ! <span class="fstring">"-fno-common"</span>! <span class="fstring">"-fno-strict-aliasing"</span> ! (c_compile_warning_flags+config.ccflags)
<span class="lineno" id=line37></span>    ;
<span class="lineno" id=line38></span>  
<span class="lineno" id=line39></span>  
<span class="lineno" id=line40></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> whatami () =&gt; <span class="fstring">"toolchain_clang_linux (version 2)"</span>;
<span class="lineno" id=line41></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> host_os () =&gt; <span class="fstring">"LINUX"</span>;
<span class="lineno" id=line42></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> target_os () =&gt; <span class="fstring">"LINUX"</span>;
<span class="lineno" id=line43></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> cxx_compiler_vendor () =&gt; <span class="fstring">"clang"</span>;
<span class="lineno" id=line44></span>  
<span class="lineno" id=line45></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> dependency_extension () =&gt; <span class="fstring">".d"</span>;
<span class="lineno" id=line46></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> executable_extension () =&gt; <span class="fstring">""</span>;
<span class="lineno" id=line47></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> static_object_extension () =&gt; <span class="fstring">"_static.o"</span>;
<span class="lineno" id=line48></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> dynamic_object_extension () =&gt; <span class="fstring">"_dynamic.o"</span>;
<span class="lineno" id=line49></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> static_library_extension () =&gt; <span class="fstring">".a"</span>;
<span class="lineno" id=line50></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> dynamic_library_extension () =&gt; <span class="fstring">".so"</span>;
<span class="lineno" id=line51></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> pathname_separator () =&gt; <span class="fstring">"/"</span>;
<span class="lineno" id=line52></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> debug_flags () =&gt; <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>] <span class="fstring">"-g"</span>;
<span class="lineno" id=line53></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> get_base_c_compile_flags () =&gt; base_c_compile_flags;
<span class="lineno" id=line54></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> get_base_cxx_compile_flags () =&gt; base_cxx_compile_flags;
<span class="lineno" id=line55></span>  
<span class="lineno" id=line56></span>  <span class="comment">// Boilerplate </span>
<span class="lineno" id=line57></span>  
<span class="lineno" id=line58></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> c_dependency_generator (spec:(src:<span class="library" title="binding of C++ string type">string</span>)) =
<span class="lineno" id=line59></span>    {
<span class="lineno" id=line60></span>       <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>, data = 
<span class="lineno" id=line61></span>         CxxCompiler::generic_cxx_gen_deps 
<span class="lineno" id=line62></span>         (
<span class="lineno" id=line63></span>            CCDEP=c_compiler,
<span class="lineno" id=line64></span>            CCFLAGS = <span class="fstring">"-MM"</span> ! config.ccflags,
<span class="lineno" id=line65></span>            INCLUDE_DIRS=config.header_search_dirs,
<span class="lineno" id=line66></span>            MACROS=config.macros,
<span class="lineno" id=line67></span>            debugln = config.debugln
<span class="lineno" id=line68></span>         )
<span class="lineno" id=line69></span>         (spec.src)
<span class="lineno" id=line70></span>       ;
<span class="lineno" id=line71></span>       <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>, data;
<span class="lineno" id=line72></span>    }
<span class="lineno" id=line73></span>  
<span class="lineno" id=line74></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_dependency_generator (spec:(src:<span class="library" title="binding of C++ string type">string</span>)) =
<span class="lineno" id=line75></span>    {
<span class="lineno" id=line76></span>       <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>, data = 
<span class="lineno" id=line77></span>         CxxCompiler::generic_cxx_gen_deps 
<span class="lineno" id=line78></span>         (
<span class="lineno" id=line79></span>            CCDEP=cxx_compiler,
<span class="lineno" id=line80></span>            CCFLAGS = <span class="fstring">"-MM"</span> ! <span class="fstring">"-std=c++14"</span> ! config.ccflags,
<span class="lineno" id=line81></span>            INCLUDE_DIRS=config.header_search_dirs,
<span class="lineno" id=line82></span>            MACROS=config.macros,
<span class="lineno" id=line83></span>            debugln = config.debugln
<span class="lineno" id=line84></span>         )
<span class="lineno" id=line85></span>         (spec.src)
<span class="lineno" id=line86></span>       ;
<span class="lineno" id=line87></span>       <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>, data;
<span class="lineno" id=line88></span>    }
<span class="lineno" id=line89></span>  
<span class="lineno" id=line90></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> dependency_parser (data:<span class="library" title="binding of C++ string type">string</span>) : <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>] =&gt;
<span class="lineno" id=line91></span>       CxxCompiler::generic_dependency_parser data
<span class="lineno" id=line92></span>    ;
<span class="lineno" id=line93></span>   
<span class="lineno" id=line94></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> c_static_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line95></span>    {
<span class="lineno" id=line96></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line97></span>        CxxCompiler::generic_cxx_compile_for_static
<span class="lineno" id=line98></span>        (
<span class="lineno" id=line99></span>          CCOBJ_STATIC_LIB = c_compiler, 
<span class="lineno" id=line100></span>          CCFLAGS = base_c_compile_flags,
<span class="lineno" id=line101></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line102></span>          MACROS = config.macros,
<span class="lineno" id=line103></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line104></span>          debugln = config.debugln
<span class="lineno" id=line105></span>        ) 
<span class="lineno" id=line106></span>        (spec.src, spec.dst)
<span class="lineno" id=line107></span>      ;
<span class="lineno" id=line108></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line109></span>    }
<span class="lineno" id=line110></span>  
<span class="lineno" id=line111></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> c_dynamic_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line112></span>    {
<span class="lineno" id=line113></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line114></span>        CxxCompiler::generic_cxx_compile_for_dynamic 
<span class="lineno" id=line115></span>        (
<span class="lineno" id=line116></span>          CCOBJ_DLLIB = c_compiler, 
<span class="lineno" id=line117></span>          CCFLAGS = <span class="fstring">"-fPIC"</span> ! <span class="fstring">"-fvisibility=hidden"</span> ! base_c_compile_flags,
<span class="lineno" id=line118></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line119></span>          MACROS = config.macros,
<span class="lineno" id=line120></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line121></span>          debugln = config.debugln
<span class="lineno" id=line122></span>        ) 
<span class="lineno" id=line123></span>        (spec.src, spec.dst)
<span class="lineno" id=line124></span>      ;
<span class="lineno" id=line125></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line126></span>    }
<span class="lineno" id=line127></span>  
<span class="lineno" id=line128></span>  
<span class="lineno" id=line129></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_static_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line130></span>    {
<span class="lineno" id=line131></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line132></span>        CxxCompiler::generic_cxx_compile_for_static
<span class="lineno" id=line133></span>        (
<span class="lineno" id=line134></span>          CCOBJ_STATIC_LIB = cxx_compiler, 
<span class="lineno" id=line135></span>          CCFLAGS = base_cxx_compile_flags,
<span class="lineno" id=line136></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line137></span>          MACROS = config.macros,
<span class="lineno" id=line138></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line139></span>          debugln = config.debugln
<span class="lineno" id=line140></span>        ) 
<span class="lineno" id=line141></span>        (spec.src, spec.dst)
<span class="lineno" id=line142></span>      ;
<span class="lineno" id=line143></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line144></span>    }
<span class="lineno" id=line145></span>  
<span class="lineno" id=line146></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_static_library_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line147></span>    {
<span class="lineno" id=line148></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line149></span>        CxxCompiler::generic_cxx_compile_for_static
<span class="lineno" id=line150></span>        (
<span class="lineno" id=line151></span>          CCOBJ_STATIC_LIB = cxx_compiler, 
<span class="lineno" id=line152></span>          CCFLAGS = base_cxx_compile_flags,
<span class="lineno" id=line153></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line154></span>          MACROS = <span class="fstring">"FLX_STATIC_LINK"</span> + config.macros,
<span class="lineno" id=line155></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line156></span>          debugln = config.debugln
<span class="lineno" id=line157></span>        ) 
<span class="lineno" id=line158></span>        (spec.src, spec.dst)
<span class="lineno" id=line159></span>      ;
<span class="lineno" id=line160></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line161></span>    }
<span class="lineno" id=line162></span>  
<span class="lineno" id=line163></span>  
<span class="lineno" id=line164></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_dynamic_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line165></span>    {
<span class="lineno" id=line166></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line167></span>        CxxCompiler::generic_cxx_compile_for_dynamic 
<span class="lineno" id=line168></span>        (
<span class="lineno" id=line169></span>          CCOBJ_DLLIB = linker, 
<span class="lineno" id=line170></span>          CCFLAGS = <span class="fstring">"-fPIC"</span> ! <span class="fstring">"-fvisibility=hidden"</span> ! base_cxx_compile_flags,
<span class="lineno" id=line171></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line172></span>          MACROS = config.macros,
<span class="lineno" id=line173></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line174></span>          debugln = config.debugln
<span class="lineno" id=line175></span>        ) 
<span class="lineno" id=line176></span>        (spec.src, spec.dst)
<span class="lineno" id=line177></span>      ;
<span class="lineno" id=line178></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line179></span>    }
<span class="lineno" id=line180></span>  
<span class="lineno" id=line181></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> static_library_linker (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])): <span class="library" title="binding of C int type">int</span> =
<span class="lineno" id=line182></span>    {
<span class="lineno" id=line183></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> =
<span class="lineno" id=line184></span>        CxxCompiler::generic_static_library
<span class="lineno" id=line185></span>        (
<span class="lineno" id=line186></span>          CCLINK_STATIC_LIB = <span class="fstring">"ar"</span>, 
<span class="lineno" id=line187></span>          CCFLAGS = <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>](<span class="fstring">"-rcs"</span>),
<span class="lineno" id=line188></span>          SPEC_LIB_FILENAME = <span class="fstring">""</span>,
<span class="lineno" id=line189></span>          debugln = config.debugln
<span class="lineno" id=line190></span>        )  
<span class="lineno" id=line191></span>        (spec.srcs, spec.dst)
<span class="lineno" id=line192></span>      ;
<span class="lineno" id=line193></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line194></span>    } 
<span class="lineno" id=line195></span>  
<span class="lineno" id=line196></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> static_executable_linker  (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line197></span>    {
<span class="lineno" id=line198></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> =
<span class="lineno" id=line199></span>        CxxCompiler::generic_link_exe_static
<span class="lineno" id=line200></span>        (
<span class="lineno" id=line201></span>          CCLINK_STATIC = linker,
<span class="lineno" id=line202></span>          CCFLAGS = Empty[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line203></span>          SPEC_EXE_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line204></span>          LINK_STRINGS = config.library_search_dirs + config.static_libraries,
<span class="lineno" id=line205></span>          debugln = config.debugln
<span class="lineno" id=line206></span>        )  
<span class="lineno" id=line207></span>        (spec.srcs, spec.dst)
<span class="lineno" id=line208></span>      ;
<span class="lineno" id=line209></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line210></span>    }
<span class="lineno" id=line211></span>  
<span class="lineno" id=line212></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> dynamic_executable_linker  (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line213></span>    {
<span class="lineno" id=line214></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> =
<span class="lineno" id=line215></span>        CxxCompiler::generic_link_exe_dynamic
<span class="lineno" id=line216></span>        (
<span class="lineno" id=line217></span>          CCLINK_STATIC = linker,
<span class="lineno" id=line218></span>          CCFLAGS = Empty[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line219></span>          SPEC_EXE_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line220></span>          LINK_STRINGS = config.library_search_dirs + config.dynamic_libraries,
<span class="lineno" id=line221></span>          debugln = config.debugln
<span class="lineno" id=line222></span>        )  
<span class="lineno" id=line223></span>        (spec.srcs, spec.dst)
<span class="lineno" id=line224></span>      ;
<span class="lineno" id=line225></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line226></span>    }
<span class="lineno" id=line227></span>  
<span class="lineno" id=line228></span>  
<span class="lineno" id=line229></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> dynamic_library_linker (spec:(dst:<span class="library" title="binding of C++ string type">string</span>,srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line230></span>    {
<span class="lineno" id=line231></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line232></span>        CxxCompiler::generic_link_lib_dynamic 
<span class="lineno" id=line233></span>        (
<span class="lineno" id=line234></span>          CCLINK_DLLIB = linker,
<span class="lineno" id=line235></span>          CCFLAGS = ccflags_for_dynamic_link,
<span class="lineno" id=line236></span>          EXT_SHARED_OBJ = #dynamic_library_extension,
<span class="lineno" id=line237></span>          SPEC_EXE_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line238></span>          LINK_STRINGS = config.library_search_dirs + config.dynamic_libraries, 
<span class="lineno" id=line239></span>          debugln = config.debugln
<span class="lineno" id=line240></span>        )
<span class="lineno" id=line241></span>        (spec.srcs, spec.dst)
<span class="lineno" id=line242></span>      ;
<span class="lineno" id=line243></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line244></span>    }
<span class="lineno" id=line245></span>  }
<span class="lineno" id=line246></span>  
</pre></p></div><h2 id='Object_for_clang_on_OSX_h'><img src='/share/src/web/images/minus.gif' id='Object for clang on OSX' onclick='toggle(this,"Object_for_clang_on_OSX_d")' alt='+'/> 6.4 Object for clang on OSX</h2><div id='Object_for_clang_on_OSX_d' style='display:block'>
<pre class='inclusion'>
share/lib/std/felix/toolchain/clang_macosx.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/toolchain_interface"</span>;
<span class="lineno" id=line2></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/toolchain_config"</span>;
<span class="lineno" id=line3></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/flx_cxx"</span>;
<span class="lineno" id=line4></span>  
<span class="lineno" id=line5></span>  <span class="big_keyword" title="define an object factory">object</span> toolchain_clang_macosx (config:toolchain_config_t) <span class="small_keyword" title="specify what interfaces an object implements">implements</span> toolchain_t = 
<span class="lineno" id=line6></span>  {
<span class="lineno" id=line7></span>  
<span class="lineno" id=line8></span>    <span class="big_keyword" title="Define a mutable variable">var</span> cxx_compile_warning_flags = <span class="library" title="functional, singly linked list">list</span>$ 
<span class="lineno" id=line9></span>      <span class="fstring">"-w"</span>, <span class="comment">// turn off all the warnings (but not hard errors)</span>
<span class="lineno" id=line10></span>      <span class="fstring">"-Wfatal-errors"</span>, <span class="comment">// stop compiling on the first hard error</span>
<span class="lineno" id=line11></span>      <span class="fstring">"-Wno-return-type-c-linkage"</span>,
<span class="lineno" id=line12></span>      <span class="fstring">"-Wno-invalid-offsetof"</span>
<span class="lineno" id=line13></span>    ;
<span class="lineno" id=line14></span>    <span class="big_keyword" title="Define a mutable variable">var</span> c_compile_warning_flags = <span class="library" title="functional, singly linked list">list</span>$ <span class="fstring">"-w"</span>,
<span class="lineno" id=line15></span>      <span class="fstring">"-Wfatal-errors"</span>, 
<span class="lineno" id=line16></span>      <span class="fstring">"-Wno-array-bounds"</span>
<span class="lineno" id=line17></span>    ;
<span class="lineno" id=line18></span>    <span class="big_keyword" title="Define a mutable variable">var</span> c_compiler = <span class="small_keyword" title="let binder">let</span> x = config.c_compiler_executable <span class="small_keyword" title="membership operator, function mem">in</span> <span class="small_keyword" title="conditional">if</span> x == <span class="fstring">""</span> <span class="small_keyword" title="conditional">then</span> <span class="fstring">"clang"</span> <span class="small_keyword" title="conditional">else</span> x;
<span class="lineno" id=line19></span>    <span class="big_keyword" title="Define a mutable variable">var</span> cxx_compiler = <span class="small_keyword" title="let binder">let</span> x = config.cxx_compiler_executable <span class="small_keyword" title="membership operator, function mem">in</span> <span class="small_keyword" title="conditional">if</span> x == <span class="fstring">""</span> <span class="small_keyword" title="conditional">then</span> <span class="fstring">"clang++"</span> <span class="small_keyword" title="conditional">else</span> x;
<span class="lineno" id=line20></span>    <span class="big_keyword" title="Define a mutable variable">var</span> linker = cxx_compiler;
<span class="lineno" id=line21></span>  
<span class="lineno" id=line22></span>    <span class="big_keyword" title="Define a mutable variable">var</span> ccflags_for_dynamic_link = <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>] (<span class="fstring">"-dynamiclib"</span>);
<span class="lineno" id=line23></span>    <span class="big_keyword" title="Define a mutable variable">var</span> base_c_compile_flags = 
<span class="lineno" id=line24></span>      <span class="fstring">"-g"</span>! <span class="fstring">"-c"</span> ! <span class="fstring">"-O1"</span> ! <span class="fstring">"-fno-common"</span>! <span class="fstring">"-fno-strict-aliasing"</span> ! (c_compile_warning_flags+config.ccflags)
<span class="lineno" id=line25></span>    ;
<span class="lineno" id=line26></span>  
<span class="lineno" id=line27></span>    <span class="big_keyword" title="Define a mutable variable">var</span> base_cxx_compile_flags = 
<span class="lineno" id=line28></span>       <span class="fstring">"-g"</span>! <span class="fstring">"-c"</span> ! <span class="fstring">"-O1"</span> ! <span class="fstring">"-fno-common"</span>! <span class="fstring">"-fno-strict-aliasing"</span> ! <span class="fstring">"-std=c++14"</span> ! (cxx_compile_warning_flags+config.ccflags)
<span class="lineno" id=line29></span>    ;
<span class="lineno" id=line30></span>  
<span class="lineno" id=line31></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> whatami () =&gt; <span class="fstring">"toolchain_clang_macosx (version 2)"</span>;
<span class="lineno" id=line32></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> host_os () =&gt; <span class="fstring">"OSX"</span>;
<span class="lineno" id=line33></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> target_os () =&gt; <span class="fstring">"OSX"</span>;
<span class="lineno" id=line34></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> cxx_compiler_vendor () =&gt; <span class="fstring">"clang"</span>;
<span class="lineno" id=line35></span>  
<span class="lineno" id=line36></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> dependency_extension () =&gt; <span class="fstring">".d"</span>;
<span class="lineno" id=line37></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> executable_extension () =&gt; <span class="fstring">""</span>;
<span class="lineno" id=line38></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> static_object_extension () =&gt; <span class="fstring">"_static.o"</span>;
<span class="lineno" id=line39></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> dynamic_object_extension () =&gt; <span class="fstring">"_dynamic.o"</span>;
<span class="lineno" id=line40></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> static_library_extension () =&gt; <span class="fstring">".a"</span>;
<span class="lineno" id=line41></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> dynamic_library_extension () =&gt; <span class="fstring">".dylib"</span>;
<span class="lineno" id=line42></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> pathname_separator () =&gt; <span class="fstring">"/"</span>;
<span class="lineno" id=line43></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> debug_flags () =&gt; <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>] <span class="fstring">"-g"</span>;
<span class="lineno" id=line44></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> get_base_c_compile_flags () =&gt; base_c_compile_flags;
<span class="lineno" id=line45></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> get_base_cxx_compile_flags () =&gt; base_cxx_compile_flags;
<span class="lineno" id=line46></span>  
<span class="lineno" id=line47></span>  <span class="comment">// Boilerplate </span>
<span class="lineno" id=line48></span>  
<span class="lineno" id=line49></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> c_dependency_generator (spec:(src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> * <span class="library" title="binding of C++ string type">string</span> =
<span class="lineno" id=line50></span>    {
<span class="lineno" id=line51></span>       <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>, data = 
<span class="lineno" id=line52></span>         CxxCompiler::generic_cxx_gen_deps 
<span class="lineno" id=line53></span>         (
<span class="lineno" id=line54></span>            CCDEP=c_compiler,
<span class="lineno" id=line55></span>            CCFLAGS = <span class="fstring">"-MM"</span> ! config.ccflags,
<span class="lineno" id=line56></span>            INCLUDE_DIRS=config.header_search_dirs,
<span class="lineno" id=line57></span>            MACROS=config.macros,
<span class="lineno" id=line58></span>            debugln = config.debugln
<span class="lineno" id=line59></span>         )
<span class="lineno" id=line60></span>         (spec.src)
<span class="lineno" id=line61></span>       ;
<span class="lineno" id=line62></span>       <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>,  data;
<span class="lineno" id=line63></span>    }
<span class="lineno" id=line64></span>  
<span class="lineno" id=line65></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_dependency_generator (spec:(src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> * <span class="library" title="binding of C++ string type">string</span> =
<span class="lineno" id=line66></span>    {
<span class="lineno" id=line67></span>       <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>, data = 
<span class="lineno" id=line68></span>         CxxCompiler::generic_cxx_gen_deps 
<span class="lineno" id=line69></span>         (
<span class="lineno" id=line70></span>            CCDEP=cxx_compiler,
<span class="lineno" id=line71></span>            CCFLAGS = <span class="fstring">"-MM"</span> ! <span class="fstring">"-std=c++14"</span> ! config.ccflags,
<span class="lineno" id=line72></span>            INCLUDE_DIRS=config.header_search_dirs,
<span class="lineno" id=line73></span>            MACROS=config.macros,
<span class="lineno" id=line74></span>            debugln = config.debugln
<span class="lineno" id=line75></span>         )
<span class="lineno" id=line76></span>         (spec.src)
<span class="lineno" id=line77></span>       ;
<span class="lineno" id=line78></span>       <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>, data;
<span class="lineno" id=line79></span>    }
<span class="lineno" id=line80></span>  
<span class="lineno" id=line81></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> dependency_parser (data:<span class="library" title="binding of C++ string type">string</span>) : <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>] =&gt;
<span class="lineno" id=line82></span>       CxxCompiler::generic_dependency_parser data
<span class="lineno" id=line83></span>    ;
<span class="lineno" id=line84></span>    
<span class="lineno" id=line85></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> c_static_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line86></span>    {
<span class="lineno" id=line87></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line88></span>        CxxCompiler::generic_cxx_compile_for_static
<span class="lineno" id=line89></span>        (
<span class="lineno" id=line90></span>          CCOBJ_STATIC_LIB = c_compiler, 
<span class="lineno" id=line91></span>          CCFLAGS = base_c_compile_flags,
<span class="lineno" id=line92></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line93></span>          MACROS = config.macros,
<span class="lineno" id=line94></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line95></span>          debugln = config.debugln
<span class="lineno" id=line96></span>        ) 
<span class="lineno" id=line97></span>        (spec.src, spec.dst)
<span class="lineno" id=line98></span>      ;
<span class="lineno" id=line99></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line100></span>    }
<span class="lineno" id=line101></span>  
<span class="lineno" id=line102></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> c_dynamic_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line103></span>    {
<span class="lineno" id=line104></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line105></span>        CxxCompiler::generic_cxx_compile_for_dynamic 
<span class="lineno" id=line106></span>        (
<span class="lineno" id=line107></span>          CCOBJ_DLLIB = c_compiler, 
<span class="lineno" id=line108></span>          CCFLAGS = <span class="fstring">"-fPIC"</span> ! <span class="fstring">"-fvisibility=hidden"</span> ! base_c_compile_flags,
<span class="lineno" id=line109></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line110></span>          MACROS = config.macros,
<span class="lineno" id=line111></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line112></span>          debugln = config.debugln
<span class="lineno" id=line113></span>        ) 
<span class="lineno" id=line114></span>        (spec.src, spec.dst)
<span class="lineno" id=line115></span>      ;
<span class="lineno" id=line116></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line117></span>    }
<span class="lineno" id=line118></span>  
<span class="lineno" id=line119></span>  
<span class="lineno" id=line120></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_static_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line121></span>    {
<span class="lineno" id=line122></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line123></span>        CxxCompiler::generic_cxx_compile_for_static
<span class="lineno" id=line124></span>        (
<span class="lineno" id=line125></span>          CCOBJ_STATIC_LIB = cxx_compiler, 
<span class="lineno" id=line126></span>          CCFLAGS = base_cxx_compile_flags,
<span class="lineno" id=line127></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line128></span>          MACROS = config.macros,
<span class="lineno" id=line129></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line130></span>          debugln = config.debugln
<span class="lineno" id=line131></span>        ) 
<span class="lineno" id=line132></span>        (spec.src, spec.dst)
<span class="lineno" id=line133></span>      ;
<span class="lineno" id=line134></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line135></span>    }
<span class="lineno" id=line136></span>  
<span class="lineno" id=line137></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_static_library_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line138></span>    {
<span class="lineno" id=line139></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line140></span>        CxxCompiler::generic_cxx_compile_for_static
<span class="lineno" id=line141></span>        (
<span class="lineno" id=line142></span>          CCOBJ_STATIC_LIB = cxx_compiler, 
<span class="lineno" id=line143></span>          CCFLAGS = base_cxx_compile_flags,
<span class="lineno" id=line144></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line145></span>          MACROS = <span class="fstring">"FLX_STATIC_LINK"</span>+config.macros,
<span class="lineno" id=line146></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line147></span>          debugln = config.debugln
<span class="lineno" id=line148></span>        ) 
<span class="lineno" id=line149></span>        (spec.src, spec.dst)
<span class="lineno" id=line150></span>      ;
<span class="lineno" id=line151></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line152></span>    }
<span class="lineno" id=line153></span>  
<span class="lineno" id=line154></span>  
<span class="lineno" id=line155></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_dynamic_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line156></span>    {
<span class="lineno" id=line157></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line158></span>        CxxCompiler::generic_cxx_compile_for_dynamic 
<span class="lineno" id=line159></span>        (
<span class="lineno" id=line160></span>          CCOBJ_DLLIB = linker, 
<span class="lineno" id=line161></span>          CCFLAGS = <span class="fstring">"-fPIC"</span> ! <span class="fstring">"-fvisibility=hidden"</span> ! base_cxx_compile_flags,
<span class="lineno" id=line162></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line163></span>          MACROS = config.macros,
<span class="lineno" id=line164></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line165></span>          debugln = config.debugln
<span class="lineno" id=line166></span>        ) 
<span class="lineno" id=line167></span>        (spec.src, spec.dst)
<span class="lineno" id=line168></span>      ;
<span class="lineno" id=line169></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line170></span>    }
<span class="lineno" id=line171></span>  
<span class="lineno" id=line172></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> static_library_linker (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])): <span class="library" title="binding of C int type">int</span> =
<span class="lineno" id=line173></span>    {
<span class="lineno" id=line174></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> =
<span class="lineno" id=line175></span>        CxxCompiler::generic_static_library
<span class="lineno" id=line176></span>        (
<span class="lineno" id=line177></span>          CCLINK_STATIC_LIB = <span class="fstring">"ar"</span>, 
<span class="lineno" id=line178></span>          CCFLAGS = <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>](<span class="fstring">"-rcs"</span>),
<span class="lineno" id=line179></span>          SPEC_LIB_FILENAME = <span class="fstring">""</span>,
<span class="lineno" id=line180></span>          debugln = config.debugln
<span class="lineno" id=line181></span>        )  
<span class="lineno" id=line182></span>        (spec.srcs, spec.dst)
<span class="lineno" id=line183></span>      ;
<span class="lineno" id=line184></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line185></span>    } 
<span class="lineno" id=line186></span>  
<span class="lineno" id=line187></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> static_executable_linker  (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line188></span>    {
<span class="lineno" id=line189></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> =
<span class="lineno" id=line190></span>        CxxCompiler::generic_link_exe_static
<span class="lineno" id=line191></span>        (
<span class="lineno" id=line192></span>          CCLINK_STATIC = linker,
<span class="lineno" id=line193></span>          CCFLAGS = Empty[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line194></span>          SPEC_EXE_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line195></span>          LINK_STRINGS = config.library_search_dirs + config.static_libraries,
<span class="lineno" id=line196></span>          debugln = config.debugln
<span class="lineno" id=line197></span>        )  
<span class="lineno" id=line198></span>        (spec.srcs, spec.dst)
<span class="lineno" id=line199></span>      ;
<span class="lineno" id=line200></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line201></span>    }
<span class="lineno" id=line202></span>  
<span class="lineno" id=line203></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> dynamic_executable_linker  (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line204></span>    {
<span class="lineno" id=line205></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> =
<span class="lineno" id=line206></span>        CxxCompiler::generic_link_exe_dynamic
<span class="lineno" id=line207></span>        (
<span class="lineno" id=line208></span>          CCLINK_STATIC = linker,
<span class="lineno" id=line209></span>          CCFLAGS = Empty[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line210></span>          SPEC_EXE_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line211></span>          LINK_STRINGS = config.library_search_dirs + config.dynamic_libraries,
<span class="lineno" id=line212></span>          debugln = config.debugln
<span class="lineno" id=line213></span>        )  
<span class="lineno" id=line214></span>        (spec.srcs, spec.dst)
<span class="lineno" id=line215></span>      ;
<span class="lineno" id=line216></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line217></span>    }
<span class="lineno" id=line218></span>  
<span class="lineno" id=line219></span>  
<span class="lineno" id=line220></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> dynamic_library_linker (spec:(dst:<span class="library" title="binding of C++ string type">string</span>,srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line221></span>    {
<span class="lineno" id=line222></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line223></span>        CxxCompiler::generic_link_lib_dynamic
<span class="lineno" id=line224></span>        (
<span class="lineno" id=line225></span>          CCLINK_DLLIB = linker,
<span class="lineno" id=line226></span>          CCFLAGS = ccflags_for_dynamic_link,
<span class="lineno" id=line227></span>          EXT_SHARED_OBJ = #dynamic_library_extension,
<span class="lineno" id=line228></span>          SPEC_EXE_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line229></span>          LINK_STRINGS = config.library_search_dirs + config.dynamic_libraries, 
<span class="lineno" id=line230></span>          debugln = config.debugln
<span class="lineno" id=line231></span>        )
<span class="lineno" id=line232></span>        (spec.srcs, spec.dst)
<span class="lineno" id=line233></span>      ;
<span class="lineno" id=line234></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line235></span>    }
<span class="lineno" id=line236></span>  }
<span class="lineno" id=line237></span>  
</pre></p></div><h2 id='Cygwin_interface._h'><img src='/share/src/web/images/minus.gif' id='Cygwin interface.' onclick='toggle(this,"Cygwin_interface._d")' alt='+'/> 6.5 Cygwin interface.</h2><div id='Cygwin_interface._d' style='display:block'>
<pre class='inclusion'>
share/lib/std/cygwin/cygwin.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Define a type class">class</span> Cygwin
<span class="lineno" id=line2></span>  {
<span class="lineno" id=line3></span>    <span class="big_keyword" title="specify requirements">requires</span> <span class="small_keyword" title="specifies an abstract package name">package</span> <span class="fstring">"cygwin"</span>;
<span class="lineno" id=line4></span>  
<span class="lineno" id=line5></span>    <span class="comment">// outputs absolute filenames: src,dst</span>
<span class="lineno" id=line6></span>    <span class="qualifier" title="Symbol visible only in enclosing module or typeclass namespace">private</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> p_cygwin_to_win: +<span class="library" title="binding of C char type">char</span> * +<span class="library" title="binding of C char type">char</span> * <span class="library" title="binding of C size_t type">size</span> -&gt; <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line7></span>       <span class="fstring">"cygwin_conv_path(CCP_POSIX_TO_WIN_A || CCP_ABSOLUTE,$1,$2,$3)"</span>
<span class="lineno" id=line8></span>    ;
<span class="lineno" id=line9></span>    <span class="qualifier" title="Symbol visible only in enclosing module or typeclass namespace">private</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> p_win_to_cygwin: +<span class="library" title="binding of C char type">char</span> * +<span class="library" title="binding of C char type">char</span> * <span class="library" title="binding of C size_t type">size</span> -&gt; <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line10></span>      <span class="fstring">"cygwin_conv_path(CCP_WIN_TO_POSIX)A || CCP_ABSOLUTE,$1,$2,$3)"</span>
<span class="lineno" id=line11></span>    ;
<span class="lineno" id=line12></span>  
<span class="lineno" id=line13></span>    <span class="comment">// This function should ALWAYS work</span>
<span class="lineno" id=line14></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> cygwin_to_win (<span class="big_keyword" title="Define a mutable variable">var</span> s:<span class="library" title="binding of C++ string type">string</span>) = 
<span class="lineno" id=line15></span>    {
<span class="lineno" id=line16></span>       <span class="big_keyword" title="Define a mutable variable">var</span> outbuf : +<span class="library" title="binding of C char type">char</span>;
<span class="lineno" id=line17></span>       <span class="big_keyword" title="Define a mutable variable">var</span> psiz = p_cygwin_to_win (s.cstr,outbuf,0uz);
<span class="lineno" id=line18></span>       outbuf = array_alloc[<span class="library" title="binding of C char type">char</span>] psiz; 
<span class="lineno" id=line19></span>       <span class="big_keyword" title="Define a mutable variable">var</span> err = p_cygwin_to_win (s.cstr,outbuf,psiz.<span class="library" title="binding of C size_t type">size</span>);
<span class="lineno" id=line20></span>       <span class="big_keyword" title="Run time assertion">assert</span> err == 0; <span class="comment">// hackery!</span>
<span class="lineno" id=line21></span>       <span class="big_keyword" title="Define a mutable variable">var</span> t = <span class="library" title="binding of C++ string type">string</span> outbuf;
<span class="lineno" id=line22></span>       free outbuf;
<span class="lineno" id=line23></span>       <span class="small_keyword" title="return">return</span> t;
<span class="lineno" id=line24></span>    }
<span class="lineno" id=line25></span>  
<span class="lineno" id=line26></span>    <span class="comment">// This function has two kinds of output:</span>
<span class="lineno" id=line27></span>    <span class="comment">// if the win filename is inside C:/cygwin we get name relative to /</span>
<span class="lineno" id=line28></span>    <span class="comment">// if the filename is outside, we get /cygdrive/driveletter/rest-of-path</span>
<span class="lineno" id=line29></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> win_to_cygwin(<span class="big_keyword" title="Define a mutable variable">var</span> s:<span class="library" title="binding of C++ string type">string</span>) = 
<span class="lineno" id=line30></span>    {
<span class="lineno" id=line31></span>       <span class="big_keyword" title="Define a mutable variable">var</span> outbuf : +<span class="library" title="binding of C char type">char</span>;
<span class="lineno" id=line32></span>       <span class="big_keyword" title="Define a mutable variable">var</span> psiz = p_win_to_cygwin(s.cstr,outbuf,0uz);
<span class="lineno" id=line33></span>       outbuf = array_alloc[<span class="library" title="binding of C char type">char</span>] psiz; 
<span class="lineno" id=line34></span>       <span class="big_keyword" title="Define a mutable variable">var</span> err = p_win_to_cygwin(s.cstr,outbuf,psiz.<span class="library" title="binding of C size_t type">size</span>);
<span class="lineno" id=line35></span>       <span class="big_keyword" title="Run time assertion">assert</span> err == 0; <span class="comment">// hackery!</span>
<span class="lineno" id=line36></span>       <span class="big_keyword" title="Define a mutable variable">var</span> t = <span class="library" title="binding of C++ string type">string</span> outbuf;
<span class="lineno" id=line37></span>       free outbuf;
<span class="lineno" id=line38></span>       <span class="small_keyword" title="return">return</span> t;
<span class="lineno" id=line39></span>    }
<span class="lineno" id=line40></span>  }
</pre></p></div><h2 id='Cygwin_config_h'><img src='/share/src/web/images/minus.gif' id='Cygwin config' onclick='toggle(this,"Cygwin_config_d")' alt='+'/> 6.6 Cygwin config</h2><div id='Cygwin_config_d' style='display:block'>
<pre class='inclusion'>
$PWD/src/config/cygwin.fpc</pre>
<p><pre class="prefmtbg">Descriptrion: Cygwin Dll
provides_dlib: -L/usr/bin -lcygwin
includes: '"sys/cygwin.h"' 
</pre></p></div><h2 id='Object_for_MSVC++_on_Windows_h'><img src='/share/src/web/images/minus.gif' id='Object for MSVC++ on Windows' onclick='toggle(this,"Object_for_MSVC++_on_Windows_d")' alt='+'/> 6.7 Object for MSVC++ on Windows</h2><div id='Object_for_MSVC++_on_Windows_d' style='display:block'>
<pre class='inclusion'>
share/lib/std/felix/toolchain/msvc_win.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/toolchain_interface"</span>;
<span class="lineno" id=line2></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/toolchain_config"</span>;
<span class="lineno" id=line3></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/flx_cxx"</span>;
<span class="lineno" id=line4></span>  
<span class="lineno" id=line5></span>  <span class="big_keyword" title="define an object factory">object</span> toolchain_msvc_win (config:toolchain_config_t) <span class="small_keyword" title="specify what interfaces an object implements">implements</span> toolchain_t = 
<span class="lineno" id=line6></span>  {
<span class="lineno" id=line7></span>  
<span class="lineno" id=line8></span>    <span class="big_keyword" title="Define a mutable variable">var</span> c_compiler = <span class="small_keyword" title="let binder">let</span> x = config.c_compiler_executable <span class="small_keyword" title="membership operator, function mem">in</span> <span class="small_keyword" title="conditional">if</span> x == <span class="fstring">""</span> <span class="small_keyword" title="conditional">then</span> <span class="fstring">"cl"</span> <span class="small_keyword" title="conditional">else</span> x;
<span class="lineno" id=line9></span>    <span class="big_keyword" title="Define a mutable variable">var</span> cxx_compiler = <span class="small_keyword" title="let binder">let</span> x = config.cxx_compiler_executable <span class="small_keyword" title="membership operator, function mem">in</span> <span class="small_keyword" title="conditional">if</span> x == <span class="fstring">""</span> <span class="small_keyword" title="conditional">then</span> <span class="fstring">"cl"</span> <span class="small_keyword" title="conditional">else</span> x;
<span class="lineno" id=line10></span>    <span class="big_keyword" title="Define a mutable variable">var</span> linker = cxx_compiler;
<span class="lineno" id=line11></span>  
<span class="lineno" id=line12></span>    <span class="big_keyword" title="Define a mutable variable">var</span> base_c_compile_flags = Empty[<span class="library" title="binding of C++ string type">string</span>];
<span class="lineno" id=line13></span>    <span class="big_keyword" title="Define a mutable variable">var</span> base_cxx_compile_flags = Empty[<span class="library" title="binding of C++ string type">string</span>];
<span class="lineno" id=line14></span>  
<span class="lineno" id=line15></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> whatami () =&gt; <span class="fstring">"toolchain_msvc_win (version 2)"</span>;
<span class="lineno" id=line16></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> host_os () =&gt; <span class="fstring">"Win32"</span>;
<span class="lineno" id=line17></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> target_os () =&gt; <span class="fstring">"Win32"</span>;
<span class="lineno" id=line18></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> cxx_compiler_vendor () =&gt; <span class="fstring">"microsoft"</span>;
<span class="lineno" id=line19></span>  
<span class="lineno" id=line20></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> dependency_extension () =&gt; <span class="fstring">".d"</span>;
<span class="lineno" id=line21></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> executable_extension () =&gt; <span class="fstring">".exe"</span>;
<span class="lineno" id=line22></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> static_object_extension () =&gt; <span class="fstring">"_static.obj"</span>;
<span class="lineno" id=line23></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> dynamic_object_extension () =&gt; <span class="fstring">"_dynamic.obj"</span>;
<span class="lineno" id=line24></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> static_library_extension () =&gt; <span class="fstring">".lib"</span>;
<span class="lineno" id=line25></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> dynamic_library_extension () =&gt; <span class="fstring">".dll"</span>;
<span class="lineno" id=line26></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> pathname_separator () =&gt; <span class="fstring">"\\"</span>;
<span class="lineno" id=line27></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> debug_flags () =&gt; <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>] <span class="fstring">"-g"</span>;
<span class="lineno" id=line28></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> get_base_c_compile_flags () =&gt; base_c_compile_flags;
<span class="lineno" id=line29></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> get_base_cxx_compile_flags () =&gt; base_cxx_compile_flags;
<span class="lineno" id=line30></span>  
<span class="lineno" id=line31></span>    <span class="big_keyword" title="Define a mutable variable">var</span> include_switches = unbox (<span class="library" title="return data structure with function applied to each value">map</span> (<span class="big_keyword" title="Define a function with no side-effects">fun</span> (s:<span class="library" title="binding of C++ string type">string</span>) =&gt; <span class="fstring">"/I"</span>+s) config.header_search_dirs);
<span class="lineno" id=line32></span>    include_switches = include_switches + filter 
<span class="lineno" id=line33></span>      (<span class="big_keyword" title="Define a function with no side-effects">fun</span> (s:<span class="library" title="binding of C++ string type">string</span>)=&gt; prefix (s,<span class="fstring">"/I"</span>) <span class="small_keyword" title="logical disjunction">or</span> prefix (s,<span class="fstring">"-I"</span>)) 
<span class="lineno" id=line34></span>      config.ccflags
<span class="lineno" id=line35></span>    ;
<span class="lineno" id=line36></span>  
<span class="lineno" id=line37></span>    <span class="big_keyword" title="Define a mutable variable">var</span> macros = unbox (<span class="library" title="return data structure with function applied to each value">map</span> (<span class="big_keyword" title="Define a function with no side-effects">fun</span> (s:<span class="library" title="binding of C++ string type">string</span>) =&gt; <span class="fstring">"/D"</span>+s) config.macros);
<span class="lineno" id=line38></span>    <span class="comment">// for executable</span>
<span class="lineno" id=line39></span>    <span class="big_keyword" title="Define a mutable variable">var</span> static_link_strings = 
<span class="lineno" id=line40></span>      <span class="small_keyword" title="let binder">let</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> fixup (s:<span class="library" title="binding of C++ string type">string</span>) =&gt; <span class="small_keyword" title="conditional">if</span> prefix (s,<span class="fstring">"-L"</span>) <span class="small_keyword" title="conditional">then</span> <span class="fstring">"/LIBPATH:"</span>+s.[2 <span class="small_keyword" title="substring range separator">to</span>] <span class="small_keyword" title="conditional">else</span> s <span class="small_keyword" title="membership operator, function mem">in</span>
<span class="lineno" id=line41></span>      unbox (<span class="library" title="return data structure with function applied to each value">map</span> fixup (config.library_search_dirs + config.static_libraries))
<span class="lineno" id=line42></span>    ;
<span class="lineno" id=line43></span>    <span class="comment">// for DLL</span>
<span class="lineno" id=line44></span>    <span class="big_keyword" title="Define a mutable variable">var</span> dynamic_link_strings = 
<span class="lineno" id=line45></span>      <span class="small_keyword" title="let binder">let</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> fixup (s:<span class="library" title="binding of C++ string type">string</span>) =&gt; <span class="small_keyword" title="conditional">if</span> prefix (s,<span class="fstring">"-L"</span>) <span class="small_keyword" title="conditional">then</span> <span class="fstring">"/LIBPATH:"</span>+s.[2 <span class="small_keyword" title="substring range separator">to</span>] <span class="small_keyword" title="conditional">else</span> s <span class="small_keyword" title="membership operator, function mem">in</span>
<span class="lineno" id=line46></span>      unbox (<span class="library" title="return data structure with function applied to each value">map</span> fixup (config.library_search_dirs + config.dynamic_libraries))
<span class="lineno" id=line47></span>    ;
<span class="lineno" id=line48></span>  
<span class="lineno" id=line49></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> xpopen(cmd:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>]) = {
<span class="lineno" id=line50></span>      <span class="comment">//var CMD = catmap ' ' Shell::quote_arg cmd;</span>
<span class="lineno" id=line51></span>      <span class="big_keyword" title="Define a mutable variable">var</span> CMD = strcat <span class="fstring">' '</span> cmd;
<span class="lineno" id=line52></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>, data = System::get_stdout(CMD);
<span class="lineno" id=line53></span>      <span class="small_keyword" title="conditional">if</span> <span class="small_keyword" title="value of function return used in post condition">result</span> != 0 <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line54></span>        eprintln $ <span class="fstring">"Shell command="</span>+CMD + <span class="fstring">" FAILED"</span>;
<span class="lineno" id=line55></span>      <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line56></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>, data;
<span class="lineno" id=line57></span>    }
<span class="lineno" id=line58></span>  
<span class="lineno" id=line59></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> shell(cmd:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>]) = {
<span class="lineno" id=line60></span>      <span class="big_keyword" title="Define a mutable variable">var</span> CMD = catmap <span class="fstring">' '</span> Shell::quote_arg cmd;
<span class="lineno" id=line61></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = System::system(CMD);
<span class="lineno" id=line62></span>      <span class="small_keyword" title="conditional">if</span> <span class="small_keyword" title="value of function return used in post condition">result</span> != 0 <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line63></span>        eprintln $ <span class="fstring">"Shell command="</span>+CMD + <span class="fstring">" FAILED"</span>;
<span class="lineno" id=line64></span>      <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line65></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line66></span>    }
<span class="lineno" id=line67></span>  
<span class="lineno" id=line68></span>    <span class="big_keyword" title="Define a procedure, a function with side-effects not returning a value">proc</span> checkwarn (<span class="small_keyword" title="value of function return used in post condition">result</span>:<span class="library" title="binding of C int type">int</span>, text:<span class="library" title="binding of C++ string type">string</span>)
<span class="lineno" id=line69></span>    {
<span class="lineno" id=line70></span>      <span class="small_keyword" title="conditional">if</span> <span class="small_keyword" title="value of function return used in post condition">result</span> != 0 <span class="small_keyword" title="imperative code begins">do</span> 
<span class="lineno" id=line71></span>         <span class="library" title="Print a string to standard output">print</span> text;
<span class="lineno" id=line72></span>      <span class="small_keyword" title="conditional">else</span>
<span class="lineno" id=line73></span>        <span class="small_keyword" title="for loop">for</span> line <span class="small_keyword" title="membership operator, function mem">in</span> split(text,<span class="library" title="binding of C char type">char</span> <span class="fstring">"\n"</span>) <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line74></span>          <span class="small_keyword" title="conditional">if</span> 
<span class="lineno" id=line75></span>            stl_find (line,<span class="fstring">"warning"</span>) != stl_npos <span class="small_keyword" title="logical disjunction">or</span> 
<span class="lineno" id=line76></span>            stl_find (line, <span class="fstring">"note:"</span>) != stl_npos 
<span class="lineno" id=line77></span>          <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line78></span>            eprintln$ line;
<span class="lineno" id=line79></span>          <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line80></span>        <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line81></span>      <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line82></span>    }
<span class="lineno" id=line83></span>  
<span class="lineno" id=line84></span>  <span class="comment">// Boilerplate </span>
<span class="lineno" id=line85></span>  
<span class="lineno" id=line86></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> c_dependency_generator (spec:(src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> * <span class="library" title="binding of C++ string type">string</span> =
<span class="lineno" id=line87></span>    {
<span class="lineno" id=line88></span>      <span class="big_keyword" title="Define a mutable variable">var</span> cmd :<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>] = (<span class="fstring">"cl.exe"</span> ! <span class="fstring">"/nologo"</span> ! <span class="fstring">"/std:c17"</span> ! <span class="fstring">"/MDd"</span> ! <span class="fstring">"/Zs"</span> ! <span class="fstring">"/showIncludes"</span> ! <span class="fstring">"/c"</span> ! <span class="fstring">"/Tc"</span>+spec.src ! macros) + 
<span class="lineno" id=line89></span>         include_switches; 
<span class="lineno" id=line90></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>,text =xpopen cmd;
<span class="lineno" id=line91></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>,text;
<span class="lineno" id=line92></span>    }
<span class="lineno" id=line93></span>  
<span class="lineno" id=line94></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_dependency_generator (spec:(src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> * <span class="library" title="binding of C++ string type">string</span> =
<span class="lineno" id=line95></span>    {
<span class="lineno" id=line96></span>      <span class="big_keyword" title="Define a mutable variable">var</span> cmd : <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>] = (<span class="fstring">"cl.exe"</span> ! <span class="fstring">"/nologo"</span> ! <span class="fstring">"/std:c++latest"</span> ! <span class="fstring">"/wd4190"</span> ! <span class="fstring">"/MDd"</span> ! <span class="fstring">"/Zs"</span> ! <span class="fstring">"/showIncludes"</span> ! <span class="fstring">"/c"</span> ! <span class="fstring">"/EHs"</span> ! macros) + 
<span class="lineno" id=line97></span>        include_switches + (spec.src ! Empty[<span class="library" title="binding of C++ string type">string</span>]); 
<span class="lineno" id=line98></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>,text =xpopen cmd;
<span class="lineno" id=line99></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>,text;
<span class="lineno" id=line100></span>    }
<span class="lineno" id=line101></span>  
<span class="lineno" id=line102></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> dependency_parser (data:<span class="library" title="binding of C++ string type">string</span>) : <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>] = {
<span class="lineno" id=line103></span>     <span class="big_keyword" title="Define a mutable variable">var</span> lines = split (data, <span class="fstring">"\n"</span>);
<span class="lineno" id=line104></span>     <span class="big_keyword" title="Define a mutable variable">var</span> files = Empty[<span class="library" title="binding of C++ string type">string</span>];
<span class="lineno" id=line105></span>     <span class="small_keyword" title="for loop">for</span> line <span class="small_keyword" title="membership operator, function mem">in</span> lines <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line106></span>       <span class="small_keyword" title="conditional">if</span> prefix (line, <span class="fstring">"Note: including file: "</span>) <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line107></span>         <span class="big_keyword" title="Define a mutable variable">var</span> name = strip (line.[22 <span class="small_keyword" title="substring range separator">to</span>]);
<span class="lineno" id=line108></span>         <span class="small_keyword" title="conditional">if</span> <span class="small_keyword" title="logical negation">not</span> prefix (name,<span class="fstring">"C:\\Program Files"</span>) 
<span class="lineno" id=line109></span>         <span class="small_keyword" title="logical conjunction">and</span> <span class="small_keyword" title="logical negation">not</span> prefix (name,<span class="fstring">"c:\\program files"</span>) 
<span class="lineno" id=line110></span>         <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line111></span>           <span class="small_keyword" title="conditional">if</span> name <span class="small_keyword" title="logical negation">not</span> <span class="small_keyword" title="membership operator, function mem">in</span> files <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line112></span>             files = name ! files;
<span class="lineno" id=line113></span>           <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line114></span>         <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line115></span>       <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line116></span>     <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line117></span>     <span class="small_keyword" title="return">return</span> <span class="library" title="return data structure with elements reversed">rev</span> files;
<span class="lineno" id=line118></span>    }
<span class="lineno" id=line119></span>    
<span class="lineno" id=line120></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> c_static_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line121></span>    {
<span class="lineno" id=line122></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>,text = xpopen$ (<span class="fstring">"cl.exe"</span> ! <span class="fstring">"/nologo"</span> ! <span class="fstring">"/std:c++latest"</span> ! <span class="fstring">"/DFLX_STATIC_LINK"</span> ! <span class="fstring">"/MDd"</span> ! <span class="fstring">"/Zi"</span> ! <span class="fstring">"/c"</span> ! <span class="fstring">"/Tc"</span>+spec.src ! macros) + 
<span class="lineno" id=line123></span>        include_switches + (<span class="fstring">"/Fo"</span>+spec.dst);
<span class="lineno" id=line124></span>      checkwarn(<span class="small_keyword" title="value of function return used in post condition">result</span>,text);
<span class="lineno" id=line125></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line126></span>    }
<span class="lineno" id=line127></span>  
<span class="lineno" id=line128></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> c_dynamic_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line129></span>    {
<span class="lineno" id=line130></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>,text =xpopen$ (<span class="fstring">"cl.exe"</span> ! <span class="fstring">"/nologo"</span> ! <span class="fstring">"/std:c17"</span> ! <span class="fstring">"/MDd"</span> ! <span class="fstring">"/Zi"</span> ! <span class="fstring">"/c"</span> ! <span class="fstring">"/Tc"</span>+spec.src ! macros) + 
<span class="lineno" id=line131></span>         include_switches + (<span class="fstring">"/Fo"</span>+spec.dst); 
<span class="lineno" id=line132></span>      checkwarn(<span class="small_keyword" title="value of function return used in post condition">result</span>,text);
<span class="lineno" id=line133></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line134></span>    }
<span class="lineno" id=line135></span>  
<span class="lineno" id=line136></span>  
<span class="lineno" id=line137></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_static_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line138></span>    {
<span class="lineno" id=line139></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>,text =xpopen$ (<span class="fstring">"cl.exe"</span> ! <span class="fstring">"/nologo"</span> ! <span class="fstring">"/std:c++latest"</span> ! <span class="fstring">"/wd4190"</span> ! <span class="fstring">"/DFLX_STATIC_LINK"</span> ! <span class="fstring">"/MDd"</span> ! <span class="fstring">"/Zi"</span> ! <span class="fstring">"/c"</span> ! <span class="fstring">"/EHs"</span> ! macros) + 
<span class="lineno" id=line140></span>        include_switches + spec.src + (<span class="fstring">"/Fo"</span>+spec.dst); 
<span class="lineno" id=line141></span>      checkwarn(<span class="small_keyword" title="value of function return used in post condition">result</span>,text);
<span class="lineno" id=line142></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line143></span>    }
<span class="lineno" id=line144></span>  
<span class="lineno" id=line145></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_static_library_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line146></span>    {
<span class="lineno" id=line147></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>,text =xpopen$ (<span class="fstring">"cl.exe"</span> ! <span class="fstring">"/nologo"</span> ! <span class="fstring">"/std:c++latest"</span> ! <span class="fstring">"/wd4190"</span> ! <span class="fstring">"/DFLX_STATIC_LINK"</span> ! <span class="fstring">"/MDd"</span> ! <span class="fstring">"/Zi"</span> ! <span class="fstring">"/c"</span> ! <span class="fstring">"/EHs"</span> ! macros) + 
<span class="lineno" id=line148></span>         include_switches + (spec.src ! (<span class="fstring">"/Fo"</span>+spec.dst) ! Empty[<span class="library" title="binding of C++ string type">string</span>]); 
<span class="lineno" id=line149></span>      checkwarn(<span class="small_keyword" title="value of function return used in post condition">result</span>,text);
<span class="lineno" id=line150></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line151></span>    }
<span class="lineno" id=line152></span>  
<span class="lineno" id=line153></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_dynamic_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line154></span>    {
<span class="lineno" id=line155></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>,text =xpopen$ (<span class="fstring">"cl.exe"</span> ! <span class="fstring">"/nologo"</span> ! <span class="fstring">"/std:c++latest"</span> ! <span class="fstring">"/wd4190"</span> ! <span class="fstring">"/MDd"</span> ! <span class="fstring">"/Zi"</span> ! <span class="fstring">"/c"</span> ! <span class="fstring">"/EHs"</span> ! macros) + 
<span class="lineno" id=line156></span>        include_switches + (spec.src ! (<span class="fstring">"/Fo"</span>+spec.dst) ! Empty[<span class="library" title="binding of C++ string type">string</span>]); 
<span class="lineno" id=line157></span>      checkwarn(<span class="small_keyword" title="value of function return used in post condition">result</span>,text);
<span class="lineno" id=line158></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line159></span>    }
<span class="lineno" id=line160></span>  
<span class="lineno" id=line161></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> static_library_linker (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])): <span class="library" title="binding of C int type">int</span> =
<span class="lineno" id=line162></span>    {
<span class="lineno" id=line163></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>,text =xpopen$ <span class="fstring">"lib.exe"</span> ! <span class="fstring">"/OUT:"</span>+spec.dst ! spec.srcs; 
<span class="lineno" id=line164></span>      checkwarn(<span class="small_keyword" title="value of function return used in post condition">result</span>,text);
<span class="lineno" id=line165></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line166></span>    } 
<span class="lineno" id=line167></span>  
<span class="lineno" id=line168></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> static_executable_linker  (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line169></span>    {
<span class="lineno" id=line170></span>      <span class="comment">// Windows requires the object files before the /link and the libraries after</span>
<span class="lineno" id=line171></span>      <span class="comment">// our generic interface can't deal with that so we have to parse ..</span>
<span class="lineno" id=line172></span>      <span class="big_keyword" title="Define a mutable variable">var</span> link_specs = Empty[<span class="library" title="binding of C++ string type">string</span>];
<span class="lineno" id=line173></span>      <span class="big_keyword" title="Define a mutable variable">var</span> obj_specs = Empty[<span class="library" title="binding of C++ string type">string</span>];
<span class="lineno" id=line174></span>      <span class="small_keyword" title="for loop">for</span> term <span class="small_keyword" title="membership operator, function mem">in</span> spec.srcs + static_link_strings <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line175></span>        <span class="small_keyword" title="conditional">if</span> prefix (term, <span class="fstring">"/DEFAULTLIB:"</span>) <span class="small_keyword" title="imperative code begins">do</span> link_specs += term;
<span class="lineno" id=line176></span>        <span class="small_keyword" title="conditional">elif</span> prefix (term, <span class="fstring">"/LIBPATH:"</span>) <span class="small_keyword" title="imperative code begins">do</span> link_specs += term;
<span class="lineno" id=line177></span>        <span class="small_keyword" title="conditional">elif</span> suffix (term, <span class="fstring">".obj"</span>) <span class="small_keyword" title="logical disjunction">or</span> suffix (term, <span class="fstring">".obj"</span>) <span class="small_keyword" title="imperative code begins">do</span> obj_specs += term;
<span class="lineno" id=line178></span>        <span class="small_keyword" title="conditional">else</span>
<span class="lineno" id=line179></span>          obj_specs += term; <span class="comment">// dunno what to do with it!</span>
<span class="lineno" id=line180></span>        <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line181></span>      <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line182></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>,text =xpopen$  <span class="fstring">"cl.exe"</span> ! <span class="fstring">"/nologo"</span> ! <span class="fstring">"/DFLX_STATIC_LINK"</span> ! <span class="fstring">"/MDd"</span> ! obj_specs + (<span class="fstring">"/Fe"</span>+spec.dst) + <span class="fstring">"/link"</span> + link_specs;
<span class="lineno" id=line183></span>      checkwarn(<span class="small_keyword" title="value of function return used in post condition">result</span>,text);
<span class="lineno" id=line184></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line185></span>    }
<span class="lineno" id=line186></span>  
<span class="lineno" id=line187></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> dynamic_executable_linker  (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line188></span>    {
<span class="lineno" id=line189></span>      <span class="comment">// Windows requires the object files before the /link and the libraries after</span>
<span class="lineno" id=line190></span>      <span class="comment">// our generic interface can't deal with that so we have to parse ..</span>
<span class="lineno" id=line191></span>      <span class="big_keyword" title="Define a mutable variable">var</span> link_specs = Empty[<span class="library" title="binding of C++ string type">string</span>];
<span class="lineno" id=line192></span>      <span class="big_keyword" title="Define a mutable variable">var</span> obj_specs = Empty[<span class="library" title="binding of C++ string type">string</span>];
<span class="lineno" id=line193></span>      <span class="small_keyword" title="for loop">for</span> term <span class="small_keyword" title="membership operator, function mem">in</span> spec.srcs + static_link_strings <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line194></span>        <span class="small_keyword" title="conditional">if</span> prefix (term, <span class="fstring">"/DEFAULTLIB:"</span>) <span class="small_keyword" title="imperative code begins">do</span> link_specs += term;
<span class="lineno" id=line195></span>        <span class="small_keyword" title="conditional">elif</span> prefix (term, <span class="fstring">"/LIBPATH:"</span>) <span class="small_keyword" title="imperative code begins">do</span> link_specs += term;
<span class="lineno" id=line196></span>        <span class="small_keyword" title="conditional">elif</span> suffix (term, <span class="fstring">".obj"</span>) <span class="small_keyword" title="logical disjunction">or</span> suffix (term, <span class="fstring">".obj"</span>) <span class="small_keyword" title="imperative code begins">do</span> obj_specs += term;
<span class="lineno" id=line197></span>        <span class="small_keyword" title="conditional">else</span>
<span class="lineno" id=line198></span>          obj_specs += term; <span class="comment">// dunno what to do with it!</span>
<span class="lineno" id=line199></span>        <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line200></span>      <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line201></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>,text = xpopen$ <span class="fstring">"cl.exe"</span> ! <span class="fstring">"/nologo"</span> ! <span class="fstring">"/MDd"</span> ! obj_specs + (<span class="fstring">"/Fe"</span>+spec.dst) + <span class="fstring">"/link"</span> + link_specs;
<span class="lineno" id=line202></span>      checkwarn(<span class="small_keyword" title="value of function return used in post condition">result</span>,text);
<span class="lineno" id=line203></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line204></span>    }
<span class="lineno" id=line205></span>  
<span class="lineno" id=line206></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> dynamic_library_linker (spec:(dst:<span class="library" title="binding of C++ string type">string</span>,srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line207></span>    {
<span class="lineno" id=line208></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>,text =xpopen$  <span class="fstring">"cl.exe"</span> ! <span class="fstring">"/nologo"</span> ! <span class="fstring">"/MDd"</span> ! spec.srcs + (<span class="fstring">"/Fe"</span>+spec.dst) +  <span class="fstring">"/link"</span> + <span class="fstring">"/DLL"</span> + dynamic_link_strings;
<span class="lineno" id=line209></span>      checkwarn(<span class="small_keyword" title="value of function return used in post condition">result</span>,text);
<span class="lineno" id=line210></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line211></span>    }
<span class="lineno" id=line212></span>  }
<span class="lineno" id=line213></span>  
</pre></p></div><h2 id='Object_for_clang_on_iOS_h'><img src='/share/src/web/images/minus.gif' id='Object for clang on iOS' onclick='toggle(this,"Object_for_clang_on_iOS_d")' alt='+'/> 6.8 Object for clang on iOS</h2><div id='Object_for_clang_on_iOS_d' style='display:block'>
<pre class='inclusion'>
share/lib/std/felix/toolchain/clang_iOS_generic.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/toolchain_interface"</span>;
<span class="lineno" id=line2></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/toolchain_config"</span>;
<span class="lineno" id=line3></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/flx_cxx"</span>;
<span class="lineno" id=line4></span>  
<span class="lineno" id=line5></span>  <span class="big_keyword" title="define an object factory">object</span> toolchain_clang_apple_iOS_maker (sdk_tag:<span class="library" title="binding of C++ string type">string</span>, archs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])
<span class="lineno" id=line6></span>    (config:toolchain_config_t) <span class="small_keyword" title="specify what interfaces an object implements">implements</span> toolchain_t = 
<span class="lineno" id=line7></span>  {
<span class="lineno" id=line8></span>    <span class="comment">//eprintln$ "toolchain_clang_apple_iOS_maker sdk=" + sdk_tag + ", arches=" + archs.str;</span>
<span class="lineno" id=line9></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> get (s:<span class="library" title="binding of C++ string type">string</span>):<span class="library" title="binding of C++ string type">string</span> = {
<span class="lineno" id=line10></span>      <span class="big_keyword" title="Define a mutable variable">var</span> err, res = System::get_stdout s;
<span class="lineno" id=line11></span>      <span class="small_keyword" title="conditional">if</span> err != 0 <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line12></span>        <span class="big_keyword" title="Define a mutable variable">var</span> msg = <span class="fstring">"Abort: Error executing shell command "</span> + s;
<span class="lineno" id=line13></span>        eprintln$ msg; 
<span class="lineno" id=line14></span>        System::abort;
<span class="lineno" id=line15></span>      <span class="small_keyword" title="end of body">done</span>
<span class="lineno" id=line16></span>      <span class="small_keyword" title="return">return</span> res;
<span class="lineno" id=line17></span>    }
<span class="lineno" id=line18></span>  
<span class="lineno" id=line19></span>    <span class="big_keyword" title="Define a mutable variable">var</span> clang = strip(get(<span class="fstring">"xcrun --sdk "</span> + sdk_tag + <span class="fstring">" --find clang"</span>));
<span class="lineno" id=line20></span>    <span class="big_keyword" title="Define a mutable variable">var</span> clangxx = strip(get(<span class="fstring">"xcrun --sdk "</span> + sdk_tag + <span class="fstring">" --find clang++"</span>));
<span class="lineno" id=line21></span>    <span class="big_keyword" title="Define a mutable variable">var</span> sdk = strip(get(<span class="fstring">"xcrun --sdk "</span> + sdk_tag + <span class="fstring">" --show-sdk-path"</span>));
<span class="lineno" id=line22></span>  
<span class="lineno" id=line23></span>    <span class="comment">//eprintln$ "C compiler " + clang;</span>
<span class="lineno" id=line24></span>    <span class="comment">//eprintln$ "C++ compiler " + clangxx;</span>
<span class="lineno" id=line25></span>    <span class="comment">//eprintln$ "sdk path " + sdk;</span>
<span class="lineno" id=line26></span>  
<span class="lineno" id=line27></span>    <span class="big_keyword" title="Define a mutable variable">var</span> cxx_compile_warning_flags = <span class="library" title="functional, singly linked list">list</span>$ 
<span class="lineno" id=line28></span>      <span class="fstring">"-w"</span>, <span class="comment">// turn off all the warnings (but not hard errors)</span>
<span class="lineno" id=line29></span>      <span class="fstring">"-Wfatal-errors"</span>, <span class="comment">// stop compiling on the first hard error</span>
<span class="lineno" id=line30></span>      <span class="fstring">"-Wno-return-type-c-linkage"</span>,
<span class="lineno" id=line31></span>      <span class="fstring">"-Wno-invalid-offsetof"</span>
<span class="lineno" id=line32></span>    ;
<span class="lineno" id=line33></span>    <span class="big_keyword" title="Define a mutable variable">var</span> c_compile_warning_flags = <span class="library" title="functional, singly linked list">list</span>$ <span class="fstring">"-w"</span>,
<span class="lineno" id=line34></span>      <span class="fstring">"-Wfatal-errors"</span>, 
<span class="lineno" id=line35></span>      <span class="fstring">"-Wno-array-bounds"</span>
<span class="lineno" id=line36></span>    ;
<span class="lineno" id=line37></span>  
<span class="lineno" id=line38></span>    <span class="big_keyword" title="Define a mutable variable">var</span> c_compiler = clang;
<span class="lineno" id=line39></span>    <span class="big_keyword" title="Define a mutable variable">var</span> cxx_compiler = clangxx;
<span class="lineno" id=line40></span>    <span class="big_keyword" title="Define a mutable variable">var</span> linker = clangxx;
<span class="lineno" id=line41></span>    <span class="big_keyword" title="Define a mutable variable">var</span> archlist = unbox (<span class="library" title="return data structure with elements reversed">rev</span> (<span class="library" title="accumulated values of data structure from left into initial value using function">fold_left</span> (<span class="big_keyword" title="Define a function with no side-effects">fun</span> (acc:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>]) (arch:<span class="library" title="binding of C++ string type">string</span>) =&gt; arch ! <span class="fstring">"-arch"</span> ! acc) Empty[<span class="library" title="binding of C++ string type">string</span>] archs));
<span class="lineno" id=line42></span>  
<span class="lineno" id=line43></span>    <span class="big_keyword" title="Define a mutable variable">var</span> ccflags_for_dynamic_link = <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>](<span class="fstring">"-dynamiclib"</span>, <span class="fstring">"-isysroot"</span>, sdk) + archlist;
<span class="lineno" id=line44></span>    <span class="big_keyword" title="Define a mutable variable">var</span> base_c_compile_flags = 
<span class="lineno" id=line45></span>      <span class="fstring">"-g"</span>! <span class="fstring">"-c"</span> ! <span class="fstring">"-isysroot"</span> ! sdk ! <span class="fstring">"-O1"</span> ! 
<span class="lineno" id=line46></span>      <span class="fstring">"-fno-common"</span>! <span class="fstring">"-fno-strict-aliasing"</span> ! <span class="fstring">"-fembed-bitcode"</span> ! 
<span class="lineno" id=line47></span>      (archlist + c_compile_warning_flags+config.ccflags)
<span class="lineno" id=line48></span>    ;
<span class="lineno" id=line49></span>    <span class="big_keyword" title="Define a mutable variable">var</span> base_cxx_compile_flags = 
<span class="lineno" id=line50></span>      <span class="fstring">"-g"</span>! <span class="fstring">"-c"</span> ! <span class="fstring">"-isysroot"</span> ! sdk ! <span class="fstring">"-O1"</span> ! 
<span class="lineno" id=line51></span>      <span class="fstring">"-fno-common"</span>! <span class="fstring">"-fno-strict-aliasing"</span> ! <span class="fstring">"-fembed-bitcode"</span> ! <span class="fstring">"-std=c++14"</span> !  
<span class="lineno" id=line52></span>      (archlist + cxx_compile_warning_flags+config.ccflags)
<span class="lineno" id=line53></span>    ;
<span class="lineno" id=line54></span>  
<span class="lineno" id=line55></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> whatami () =&gt; <span class="fstring">"toolchain_clang_apple_iOS sdk="</span>+sdk_tag+<span class="fstring">", archs="</span>+cat <span class="fstring">","</span> archs;
<span class="lineno" id=line56></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> host_os () =&gt; <span class="fstring">"OSX"</span>;
<span class="lineno" id=line57></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> target_os () =&gt; <span class="fstring">"iOS"</span>;
<span class="lineno" id=line58></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> cxx_compiler_vendor () =&gt; <span class="fstring">"clang"</span>;
<span class="lineno" id=line59></span>  
<span class="lineno" id=line60></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> dependency_extension () =&gt; <span class="fstring">".d"</span>;
<span class="lineno" id=line61></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> executable_extension () =&gt; <span class="fstring">""</span>;
<span class="lineno" id=line62></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> static_object_extension () =&gt; <span class="fstring">"_static.o"</span>;
<span class="lineno" id=line63></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> dynamic_object_extension () =&gt; <span class="fstring">"_dynamic.o"</span>;
<span class="lineno" id=line64></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> static_library_extension () =&gt; <span class="fstring">".a"</span>;
<span class="lineno" id=line65></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> dynamic_library_extension () =&gt; <span class="fstring">".dylib"</span>;
<span class="lineno" id=line66></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> pathname_separator () =&gt; <span class="fstring">"/"</span>;
<span class="lineno" id=line67></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> debug_flags () =&gt; <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>] <span class="fstring">"-g"</span>;
<span class="lineno" id=line68></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> get_base_c_compile_flags () =&gt; base_c_compile_flags;
<span class="lineno" id=line69></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> get_base_cxx_compile_flags () =&gt; base_cxx_compile_flags;
<span class="lineno" id=line70></span>  
<span class="lineno" id=line71></span>  <span class="comment">// Boilerplate </span>
<span class="lineno" id=line72></span>  
<span class="lineno" id=line73></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> c_dependency_generator (spec:(src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> * <span class="library" title="binding of C++ string type">string</span> =
<span class="lineno" id=line74></span>    {
<span class="lineno" id=line75></span>       <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>, data = 
<span class="lineno" id=line76></span>         CxxCompiler::generic_cxx_gen_deps 
<span class="lineno" id=line77></span>         (
<span class="lineno" id=line78></span>            CCDEP=c_compiler,
<span class="lineno" id=line79></span>            CCFLAGS = <span class="fstring">"-isysroot"</span> ! sdk ! <span class="fstring">"-MM"</span> ! config.ccflags,
<span class="lineno" id=line80></span>            INCLUDE_DIRS=config.header_search_dirs,
<span class="lineno" id=line81></span>            MACROS=config.macros,
<span class="lineno" id=line82></span>            debugln = config.debugln
<span class="lineno" id=line83></span>         )
<span class="lineno" id=line84></span>         (spec.src)
<span class="lineno" id=line85></span>       ;
<span class="lineno" id=line86></span>       <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>,  data;
<span class="lineno" id=line87></span>    }
<span class="lineno" id=line88></span>  
<span class="lineno" id=line89></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_dependency_generator (spec:(src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> * <span class="library" title="binding of C++ string type">string</span> =
<span class="lineno" id=line90></span>    {
<span class="lineno" id=line91></span>       <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span>, data = 
<span class="lineno" id=line92></span>         CxxCompiler::generic_cxx_gen_deps 
<span class="lineno" id=line93></span>         (
<span class="lineno" id=line94></span>            CCDEP=cxx_compiler,
<span class="lineno" id=line95></span>            CCFLAGS = <span class="fstring">"-std=c++14"</span> ! <span class="fstring">"-isysroot"</span> ! sdk ! <span class="fstring">"-MM"</span> ! config.ccflags,
<span class="lineno" id=line96></span>            INCLUDE_DIRS=config.header_search_dirs,
<span class="lineno" id=line97></span>            MACROS=config.macros,
<span class="lineno" id=line98></span>            debugln = config.debugln
<span class="lineno" id=line99></span>         )
<span class="lineno" id=line100></span>         (spec.src)
<span class="lineno" id=line101></span>       ;
<span class="lineno" id=line102></span>       <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>, data;
<span class="lineno" id=line103></span>    }
<span class="lineno" id=line104></span>  
<span class="lineno" id=line105></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> dependency_parser (data:<span class="library" title="binding of C++ string type">string</span>) : <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>] =&gt;
<span class="lineno" id=line106></span>       CxxCompiler::generic_dependency_parser data
<span class="lineno" id=line107></span>    ;
<span class="lineno" id=line108></span>    
<span class="lineno" id=line109></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> c_static_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line110></span>    {
<span class="lineno" id=line111></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line112></span>        CxxCompiler::generic_cxx_compile_for_static
<span class="lineno" id=line113></span>        (
<span class="lineno" id=line114></span>          CCOBJ_STATIC_LIB = c_compiler, 
<span class="lineno" id=line115></span>          CCFLAGS = base_c_compile_flags,
<span class="lineno" id=line116></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line117></span>          MACROS = config.macros,
<span class="lineno" id=line118></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line119></span>          debugln = config.debugln
<span class="lineno" id=line120></span>        ) 
<span class="lineno" id=line121></span>        (spec.src, spec.dst)
<span class="lineno" id=line122></span>      ;
<span class="lineno" id=line123></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line124></span>    }
<span class="lineno" id=line125></span>  
<span class="lineno" id=line126></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> c_dynamic_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line127></span>    {
<span class="lineno" id=line128></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line129></span>        CxxCompiler::generic_cxx_compile_for_dynamic 
<span class="lineno" id=line130></span>        (
<span class="lineno" id=line131></span>          CCOBJ_DLLIB = c_compiler, 
<span class="lineno" id=line132></span>          CCFLAGS = <span class="fstring">"-fPIC"</span> ! <span class="fstring">"-fvisibility=hidden"</span> ! base_c_compile_flags,
<span class="lineno" id=line133></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line134></span>          MACROS = config.macros,
<span class="lineno" id=line135></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line136></span>          debugln = config.debugln
<span class="lineno" id=line137></span>        ) 
<span class="lineno" id=line138></span>        (spec.src, spec.dst)
<span class="lineno" id=line139></span>      ;
<span class="lineno" id=line140></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line141></span>    }
<span class="lineno" id=line142></span>  
<span class="lineno" id=line143></span>  
<span class="lineno" id=line144></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_static_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line145></span>    {
<span class="lineno" id=line146></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line147></span>        CxxCompiler::generic_cxx_compile_for_static
<span class="lineno" id=line148></span>        (
<span class="lineno" id=line149></span>          CCOBJ_STATIC_LIB = cxx_compiler, 
<span class="lineno" id=line150></span>          CCFLAGS = base_cxx_compile_flags,
<span class="lineno" id=line151></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line152></span>          MACROS = config.macros,
<span class="lineno" id=line153></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line154></span>          debugln = config.debugln
<span class="lineno" id=line155></span>        ) 
<span class="lineno" id=line156></span>        (spec.src, spec.dst)
<span class="lineno" id=line157></span>      ;
<span class="lineno" id=line158></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line159></span>    }
<span class="lineno" id=line160></span>  
<span class="lineno" id=line161></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_static_library_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line162></span>    {
<span class="lineno" id=line163></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line164></span>        CxxCompiler::generic_cxx_compile_for_static
<span class="lineno" id=line165></span>        (
<span class="lineno" id=line166></span>          CCOBJ_STATIC_LIB = cxx_compiler, 
<span class="lineno" id=line167></span>          CCFLAGS = base_cxx_compile_flags,
<span class="lineno" id=line168></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line169></span>          MACROS = <span class="fstring">"FLX_STATIC_LINK"</span>+config.macros,
<span class="lineno" id=line170></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line171></span>          debugln = config.debugln
<span class="lineno" id=line172></span>        ) 
<span class="lineno" id=line173></span>        (spec.src, spec.dst)
<span class="lineno" id=line174></span>      ;
<span class="lineno" id=line175></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line176></span>    }
<span class="lineno" id=line177></span>  
<span class="lineno" id=line178></span>  
<span class="lineno" id=line179></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> cxx_dynamic_object_compiler (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, src:<span class="library" title="binding of C++ string type">string</span>)) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line180></span>    {
<span class="lineno" id=line181></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line182></span>        CxxCompiler::generic_cxx_compile_for_dynamic 
<span class="lineno" id=line183></span>        (
<span class="lineno" id=line184></span>          CCOBJ_DLLIB = linker, 
<span class="lineno" id=line185></span>          CCFLAGS = <span class="fstring">"-fPIC"</span> ! <span class="fstring">"-fvisibility=hidden"</span> ! base_cxx_compile_flags,
<span class="lineno" id=line186></span>          INCLUDE_DIRS = config.header_search_dirs,
<span class="lineno" id=line187></span>          MACROS = config.macros,
<span class="lineno" id=line188></span>          SPEC_OBJ_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line189></span>          debugln = config.debugln
<span class="lineno" id=line190></span>        ) 
<span class="lineno" id=line191></span>        (spec.src, spec.dst)
<span class="lineno" id=line192></span>      ;
<span class="lineno" id=line193></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line194></span>    }
<span class="lineno" id=line195></span>  
<span class="lineno" id=line196></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> static_library_linker (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])): <span class="library" title="binding of C int type">int</span> =
<span class="lineno" id=line197></span>    {
<span class="lineno" id=line198></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> =
<span class="lineno" id=line199></span>        CxxCompiler::generic_static_library
<span class="lineno" id=line200></span>        (
<span class="lineno" id=line201></span>          CCLINK_STATIC_LIB = <span class="fstring">"libtool"</span>, 
<span class="lineno" id=line202></span>          CCFLAGS = <span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>](<span class="fstring">"-static"</span>),
<span class="lineno" id=line203></span>          SPEC_LIB_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line204></span>          debugln = config.debugln
<span class="lineno" id=line205></span>        )  
<span class="lineno" id=line206></span>        (spec.srcs, spec.dst)
<span class="lineno" id=line207></span>      ;
<span class="lineno" id=line208></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line209></span>    } 
<span class="lineno" id=line210></span>  
<span class="lineno" id=line211></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> static_executable_linker  (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line212></span>    {
<span class="lineno" id=line213></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> =
<span class="lineno" id=line214></span>        CxxCompiler::generic_link_exe_static
<span class="lineno" id=line215></span>        (
<span class="lineno" id=line216></span>          CCLINK_STATIC = linker,
<span class="lineno" id=line217></span>          CCFLAGS = Empty[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line218></span>          SPEC_EXE_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line219></span>          LINK_STRINGS = config.library_search_dirs + config.static_libraries,
<span class="lineno" id=line220></span>          debugln = config.debugln
<span class="lineno" id=line221></span>        )  
<span class="lineno" id=line222></span>        (spec.srcs, spec.dst)
<span class="lineno" id=line223></span>      ;
<span class="lineno" id=line224></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line225></span>    }
<span class="lineno" id=line226></span>  
<span class="lineno" id=line227></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> dynamic_executable_linker  (spec:(dst:<span class="library" title="binding of C++ string type">string</span>, srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line228></span>    {
<span class="lineno" id=line229></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> =
<span class="lineno" id=line230></span>        CxxCompiler::generic_link_exe_dynamic
<span class="lineno" id=line231></span>        (
<span class="lineno" id=line232></span>          CCLINK_STATIC = linker,
<span class="lineno" id=line233></span>          CCFLAGS = Empty[<span class="library" title="binding of C++ string type">string</span>],
<span class="lineno" id=line234></span>          SPEC_EXE_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line235></span>          LINK_STRINGS = config.library_search_dirs + config.dynamic_libraries,
<span class="lineno" id=line236></span>          debugln = config.debugln
<span class="lineno" id=line237></span>        )  
<span class="lineno" id=line238></span>        (spec.srcs, spec.dst)
<span class="lineno" id=line239></span>      ;
<span class="lineno" id=line240></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line241></span>    }
<span class="lineno" id=line242></span>  
<span class="lineno" id=line243></span>  
<span class="lineno" id=line244></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> dynamic_library_linker (spec:(dst:<span class="library" title="binding of C++ string type">string</span>,srcs:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>])) : <span class="library" title="binding of C int type">int</span> = 
<span class="lineno" id=line245></span>    {
<span class="lineno" id=line246></span>      <span class="big_keyword" title="Define a mutable variable">var</span> <span class="small_keyword" title="value of function return used in post condition">result</span> = 
<span class="lineno" id=line247></span>        CxxCompiler::generic_link_lib_dynamic 
<span class="lineno" id=line248></span>        (
<span class="lineno" id=line249></span>          CCLINK_DLLIB = linker,
<span class="lineno" id=line250></span>          CCFLAGS = ccflags_for_dynamic_link,
<span class="lineno" id=line251></span>          EXT_SHARED_OBJ = #dynamic_library_extension,
<span class="lineno" id=line252></span>          SPEC_EXE_FILENAME = <span class="fstring">"-o "</span>,
<span class="lineno" id=line253></span>          LINK_STRINGS = config.library_search_dirs + config.dynamic_libraries, 
<span class="lineno" id=line254></span>          debugln = config.debugln
<span class="lineno" id=line255></span>        )
<span class="lineno" id=line256></span>        (spec.srcs, spec.dst)
<span class="lineno" id=line257></span>      ;
<span class="lineno" id=line258></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="value of function return used in post condition">result</span>;
<span class="lineno" id=line259></span>    }
<span class="lineno" id=line260></span>  }
<span class="lineno" id=line261></span>  
<span class="lineno" id=line262></span>  <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> toolchain_clang_apple_iPhoneOS_armv7_arm64 (config:toolchain_config_t) : toolchain_t =&gt;
<span class="lineno" id=line263></span>    toolchain_clang_apple_iOS_maker (<span class="fstring">"iphoneos"</span>,([<span class="fstring">"armv7"</span>,<span class="fstring">"arm64"</span>])) config
<span class="lineno" id=line264></span>  ;
<span class="lineno" id=line265></span>  
<span class="lineno" id=line266></span>  <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> toolchain_clang_apple_iPhoneSimulator (config:toolchain_config_t) : toolchain_t = {
<span class="lineno" id=line267></span>    <span class="small_keyword" title="return">return</span> toolchain_clang_apple_iOS_maker (<span class="fstring">"iphonesimulator"</span>,([<span class="fstring">"x86_64"</span>,<span class="fstring">"i386"</span>])) config;
<span class="lineno" id=line268></span>  }
<span class="lineno" id=line269></span>  
</pre></p></div></div><h1 id='Toolchain_Plugins_h'><img src='/share/src/web/images/minus.gif' id='Toolchain Plugins' onclick='toggle(this,"Toolchain_Plugins_d")' alt='+'/> 7 Toolchain Plugins</h1><div id='Toolchain_Plugins_d' style='display:block'>
<p>These are wrappers around the toolchain objects previously
defined which convert them from objects into plugins, that is,
which provide the architectural support for separate compilation
and loading of binary shared libraries (DLLs).
</p><p>The MSVC++ plugin for Windows is missing because the object
implementing it is only a stub.
</p><h2 id='iPhone_Plugin_h'><img src='/share/src/web/images/minus.gif' id='iPhone Plugin' onclick='toggle(this,"iPhone_Plugin_d")' alt='+'/> 7.1 iPhone Plugin</h2><div id='iPhone_Plugin_d' style='display:block'>
<pre class='inclusion'>
share/lib/plugins/toolchain_iphoneos.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/toolchain/clang_iOS_generic"</span>;
<span class="lineno" id=line2></span>  
<span class="lineno" id=line3></span>  <span class="comment">// varies macosx vs linus,  gcc vs clang</span>
<span class="lineno" id=line4></span>  
<span class="lineno" id=line5></span>  <span class="big_keyword" title="generate extern "C" wrapper">export</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> toolchain_clang_apple_iPhoneOS_armv7_arm64 of (toolchain_config_t) as <span class="fstring">"toolchain_iphoneos"</span>;
<span class="lineno" id=line6></span>  
<span class="lineno" id=line7></span>  <span class="big_keyword" title="Define a function with no side-effects">fun</span> setup(config_data:<span class="library" title="binding of C++ string type">string</span>) = {
<span class="lineno" id=line8></span>     <span class="hack">C_hack</span>::ignore (config_data); <span class="comment">// due to bug in Felix</span>
<span class="lineno" id=line9></span>    eprintln$ <span class="fstring">"Setup toolchain iphoneos "</span> + config_data;
<span class="lineno" id=line10></span>    <span class="small_keyword" title="return">return</span> 0;
<span class="lineno" id=line11></span>  }
<span class="lineno" id=line12></span>  
<span class="lineno" id=line13></span>  <span class="big_keyword" title="generate extern "C" wrapper">export</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> setup of (<span class="library" title="binding of C++ string type">string</span>) as <span class="fstring">"toolchain_iphoneos_setup"</span>;
</pre></p><pre class='inclusion'>
share/lib/plugins/toolchain_iphonesimulator.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/toolchain/clang_iOS_generic"</span>;
<span class="lineno" id=line2></span>  
<span class="lineno" id=line3></span>  <span class="comment">// varies macosx vs linus,  gcc vs clang</span>
<span class="lineno" id=line4></span>  
<span class="lineno" id=line5></span>  <span class="big_keyword" title="generate extern "C" wrapper">export</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> toolchain_clang_apple_iPhoneSimulator of (toolchain_config_t) as <span class="fstring">"toolchain_iphonesimulator"</span>;
<span class="lineno" id=line6></span>  
<span class="lineno" id=line7></span>  <span class="big_keyword" title="Define a function with no side-effects">fun</span> setup(config_data:<span class="library" title="binding of C++ string type">string</span>) = {
<span class="lineno" id=line8></span>     <span class="hack">C_hack</span>::ignore (config_data); <span class="comment">// due to bug in Felix</span>
<span class="lineno" id=line9></span>    eprintln$ <span class="fstring">"Setup toolchain iphonesimulator "</span> + config_data;
<span class="lineno" id=line10></span>    <span class="small_keyword" title="return">return</span> 0;
<span class="lineno" id=line11></span>  }
<span class="lineno" id=line12></span>  
<span class="lineno" id=line13></span>  <span class="big_keyword" title="generate extern "C" wrapper">export</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> setup of (<span class="library" title="binding of C++ string type">string</span>) as <span class="fstring">"toolchain_iphonesimulator_setup"</span>;
</pre></p></div><h2 id='Plugin_for_gcc_on_Linux_h'><img src='/share/src/web/images/minus.gif' id='Plugin for gcc on Linux' onclick='toggle(this,"Plugin_for_gcc_on_Linux_d")' alt='+'/> 7.2 Plugin for gcc on Linux</h2><div id='Plugin_for_gcc_on_Linux_d' style='display:block'>
<pre class='inclusion'>
share/lib/plugins/toolchain_gcc_linux.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/toolchain/gcc_linux"</span>;
<span class="lineno" id=line2></span>  
<span class="lineno" id=line3></span>  <span class="big_keyword" title="generate extern "C" wrapper">export</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> toolchain_gcc_linux of (toolchain_config_t) as <span class="fstring">"toolchain_gcc_linux"</span>;
<span class="lineno" id=line4></span>  
<span class="lineno" id=line5></span>  <span class="big_keyword" title="Define a function with no side-effects">fun</span> setup(config_data:<span class="library" title="binding of C++ string type">string</span>) = {
<span class="lineno" id=line6></span>     <span class="hack">C_hack</span>::ignore (config_data); <span class="comment">// due to bug in Felix</span>
<span class="lineno" id=line7></span>    <span class="comment">//eprintln$ "Setup toolchain gcc_linux " + config_data;</span>
<span class="lineno" id=line8></span>    <span class="small_keyword" title="return">return</span> 0;
<span class="lineno" id=line9></span>  }
<span class="lineno" id=line10></span>  
<span class="lineno" id=line11></span>  <span class="big_keyword" title="generate extern "C" wrapper">export</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> setup of (<span class="library" title="binding of C++ string type">string</span>) as <span class="fstring">"toolchain_gcc_linux_setup"</span>;
<span class="lineno" id=line12></span>  
</pre></p></div><h2 id='Plugin_for_gcc_on_OSX_h'><img src='/share/src/web/images/minus.gif' id='Plugin for gcc on OSX' onclick='toggle(this,"Plugin_for_gcc_on_OSX_d")' alt='+'/> 7.3 Plugin for gcc on OSX</h2><div id='Plugin_for_gcc_on_OSX_d' style='display:block'>
<pre class='inclusion'>
share/lib/plugins/toolchain_gcc_macosx.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/toolchain/gcc_macosx"</span>;
<span class="lineno" id=line2></span>  
<span class="lineno" id=line3></span>  <span class="big_keyword" title="generate extern "C" wrapper">export</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> toolchain_gcc_macosx of (toolchain_config_t) as <span class="fstring">"toolchain_gcc_macosx"</span>;
<span class="lineno" id=line4></span>  
<span class="lineno" id=line5></span>  <span class="big_keyword" title="Define a function with no side-effects">fun</span> setup(config_data:<span class="library" title="binding of C++ string type">string</span>) = {
<span class="lineno" id=line6></span>     <span class="hack">C_hack</span>::ignore (config_data); <span class="comment">// due to bug in Felix</span>
<span class="lineno" id=line7></span>    <span class="comment">//eprintln$ "Setup toolchain gcc+macosx " + config_data;</span>
<span class="lineno" id=line8></span>    <span class="small_keyword" title="return">return</span> 0;
<span class="lineno" id=line9></span>  }
<span class="lineno" id=line10></span>  
<span class="lineno" id=line11></span>  <span class="big_keyword" title="generate extern "C" wrapper">export</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> setup of (<span class="library" title="binding of C++ string type">string</span>) as <span class="fstring">"toolchain_gcc_macosx_setup"</span>;
<span class="lineno" id=line12></span>  
</pre></p></div><h2 id='Plugin_for_clang_on_Linux_h'><img src='/share/src/web/images/minus.gif' id='Plugin for clang on Linux' onclick='toggle(this,"Plugin_for_clang_on_Linux_d")' alt='+'/> 7.4 Plugin for clang on Linux</h2><div id='Plugin_for_clang_on_Linux_d' style='display:block'>
<pre class='inclusion'>
share/lib/plugins/toolchain_clang_linux.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/toolchain/clang_linux"</span>;
<span class="lineno" id=line2></span>  
<span class="lineno" id=line3></span>  <span class="comment">// varies macosx vs linus,  gcc vs clang</span>
<span class="lineno" id=line4></span>  
<span class="lineno" id=line5></span>  <span class="big_keyword" title="generate extern "C" wrapper">export</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> toolchain_clang_linux of (toolchain_config_t) as <span class="fstring">"toolchain_clang_linux"</span>;
<span class="lineno" id=line6></span>  
<span class="lineno" id=line7></span>  
<span class="lineno" id=line8></span>  <span class="big_keyword" title="Define a function with no side-effects">fun</span> setup(config_data:<span class="library" title="binding of C++ string type">string</span>) = {
<span class="lineno" id=line9></span>     <span class="hack">C_hack</span>::ignore (config_data); <span class="comment">// due to bug in Felix</span>
<span class="lineno" id=line10></span>    <span class="comment">//eprintln$ "Setup toolchain clang_linux " + config_data;</span>
<span class="lineno" id=line11></span>    <span class="small_keyword" title="return">return</span> 0;
<span class="lineno" id=line12></span>  }
<span class="lineno" id=line13></span>  
<span class="lineno" id=line14></span>  <span class="big_keyword" title="generate extern "C" wrapper">export</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> setup of (<span class="library" title="binding of C++ string type">string</span>) as <span class="fstring">"toolchain_clang_linux_setup"</span>;
<span class="lineno" id=line15></span>  
</pre></p></div><h2 id='Plugin_for_clang_on_OSX_h'><img src='/share/src/web/images/minus.gif' id='Plugin for clang on OSX' onclick='toggle(this,"Plugin_for_clang_on_OSX_d")' alt='+'/> 7.5 Plugin for clang on OSX</h2><div id='Plugin_for_clang_on_OSX_d' style='display:block'>
<pre class='inclusion'>
share/lib/plugins/toolchain_clang_macosx.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/toolchain/clang_macosx"</span>;
<span class="lineno" id=line2></span>  
<span class="lineno" id=line3></span>  <span class="comment">// varies macosx vs linus,  gcc vs clang</span>
<span class="lineno" id=line4></span>  
<span class="lineno" id=line5></span>  <span class="big_keyword" title="generate extern "C" wrapper">export</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> toolchain_clang_macosx of (toolchain_config_t) as <span class="fstring">"toolchain_clang_macosx"</span>;
<span class="lineno" id=line6></span>  
<span class="lineno" id=line7></span>  <span class="big_keyword" title="Define a function with no side-effects">fun</span> setup(config_data:<span class="library" title="binding of C++ string type">string</span>) = {
<span class="lineno" id=line8></span>     <span class="hack">C_hack</span>::ignore (config_data); <span class="comment">// due to bug in Felix</span>
<span class="lineno" id=line9></span>    <span class="comment">//eprintln$ "Setup toolchain clang_macosx " + config_data;</span>
<span class="lineno" id=line10></span>    <span class="small_keyword" title="return">return</span> 0;
<span class="lineno" id=line11></span>  }
<span class="lineno" id=line12></span>  
<span class="lineno" id=line13></span>  <span class="big_keyword" title="generate extern "C" wrapper">export</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> setup of (<span class="library" title="binding of C++ string type">string</span>) as <span class="fstring">"toolchain_clang_macosx_setup"</span>;
</pre></p></div><h2 id='MSVC++_Plugin_for_Win32_h'><img src='/share/src/web/images/minus.gif' id='MSVC++ Plugin for Win32' onclick='toggle(this,"MSVC++_Plugin_for_Win32_d")' alt='+'/> 7.6 MSVC++ Plugin for Win32</h2><div id='MSVC++_Plugin_for_Win32_d' style='display:block'>
<pre class='inclusion'>
share/lib/plugins/toolchain_msvc_win.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/toolchain/msvc_win"</span>;
<span class="lineno" id=line2></span>  
<span class="lineno" id=line3></span>  <span class="comment">// varies macosx vs linus,  gcc vs clang</span>
<span class="lineno" id=line4></span>  
<span class="lineno" id=line5></span>  <span class="big_keyword" title="generate extern "C" wrapper">export</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> toolchain_msvc_win of (toolchain_config_t) as <span class="fstring">"toolchain_msvc_win"</span>;
<span class="lineno" id=line6></span>  
<span class="lineno" id=line7></span>  <span class="big_keyword" title="Define a function with no side-effects">fun</span> setup(config_data:<span class="library" title="binding of C++ string type">string</span>) = {
<span class="lineno" id=line8></span>     <span class="hack">C_hack</span>::ignore (config_data); <span class="comment">// due to bug in Felix</span>
<span class="lineno" id=line9></span>    <span class="comment">//eprintln$ "Setup toolchain msvc_win " + config_data;</span>
<span class="lineno" id=line10></span>    <span class="small_keyword" title="return">return</span> 0;
<span class="lineno" id=line11></span>  }
<span class="lineno" id=line12></span>  
<span class="lineno" id=line13></span>  <span class="big_keyword" title="generate extern "C" wrapper">export</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> setup of (<span class="library" title="binding of C++ string type">string</span>) as <span class="fstring">"toolchain_msvc_win_setup"</span>;
</pre></p></div></div><h1 id='Flx_Plugin_h'><img src='/share/src/web/images/minus.gif' id='Flx Plugin' onclick='toggle(this,"Flx_Plugin_d")' alt='+'/> 8 Flx Plugin</h1><div id='Flx_Plugin_d' style='display:block'>
<p>A wrapper around "flx" command.
</p><pre class='inclusion'>
share/lib/plugins/flx_plugin.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/felix/flx/flx"</span>;
<span class="lineno" id=line2></span>  <span class="big_keyword" title="generate extern "C" wrapper">export</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> flx_plugin_setup(x:<span class="library" title="binding of C++ string type">string</span>)=&gt;0;
<span class="lineno" id=line3></span>  <span class="big_keyword" title="generate extern "C" wrapper">export</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> flx_plugin (args:<span class="library" title="functional, singly linked list">list</span>[<span class="library" title="binding of C++ string type">string</span>]) = { <span class="small_keyword" title="return">return</span> Flx::runflx (args); }
</pre></p></div><!--Main Content Body End-->

          </div> <!-- rightpanel contents end -->
          <hr>
        </span> <!-- rightpanel end -->

        <span id="panemover" style="cursor:col-resize;"
         onmousedown="dragStart(event, 'left', 'right'); return false;"
         onmousemove="drag(event, 'left', 'right');"
         onmouseout="dragRelease();"
         onmouseup="dragRelease();"
        >
        </span> <!-- panemover end -->
      </div> <!-- bottom panel end -->
    </div> <!-- container end -->
</body></html>

