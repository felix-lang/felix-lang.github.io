<html><head>
<style type="text/css">
body {margin:3%; }
h1 {color:gray; font-size:120%;}
h2 {color:gray; font-size:105%;}
h3 {font-size:100%;}
h4 {font-size:95%;}
h5 {font-size:95%;}
span.fstring {color:darkblue; font-style:italic; }
span.comment {font-family:arial; color:blue; font-style:italic; }
span.doccomment {font-family:arial; color:green; font-style:italic; }
span.big_keyword {color:#FF1010; }
span.small_keyword {color:#802040; }
span.qualifier {color:#A02020; }
span.library {color:#A02000; }
span.ctor {color:#406020; }
span.hack {color:#66DD00; }
span.preproc {color:#005500; }
span.embedded_c{background-color:#DDDDDD; }
span.fpc_fieldname {color:#DD0000; }
span.lineno {color:#101010; background-color:#E0E0E0; font-size:80%; font-family:"courier",monospace; font-style:normal; }
pre.flxbg {background-color:#A0FFA0; color:black; padding:2px; box-shadow:5px 5px 2px #807080; }
pre.uncheckedflxbg {background-color:#D0D0D0; color:black; padding:2px; box-shadow:5px 5px 2px #807080; }
pre.cppbg {background-color:#80FF80; color:black; }
pre.prefmtbg {background-color:#D0D0D0; color:black; }
pre.expected {background-color:#E0FF80; color:black; }
pre.input {background-color:#E08080; color:black; }
pre.inclusion {background-color:#D070D0; color:black; }
code.inclusion {background-color:#D070D0; color:black; }
.obsolete { background-color:#FFEFEF; font-size: small; color:black; }
.future { background-color:#FF8080; font-size: small; color:black; }
.implementation_detail { background-color:#E0E0E0; font-size: small; color:black;  }
.bug { background-color:#FFE0E0; font-size: small; color:black; }
.fixed{ background-color:#FFE0E0; font-size: small; color:black; }
.done { background-color:#FFE0E0; font-size: small; color:black; }
.caveat { background-color:#FF8080; color:black; }
</style>
<title>Database</title></head><body>
<style>
body {margin:3%; font-family: sans-serif; }
h1 {color:black; font-size:120%; border-bottom: 2px solid #ddd; padding: 0 0 3px 0;}
h2 {color:#202020; font-size:105%;}
h3 {font-size:100%;}
h4 {font-size:95%;}
h5 {font-size:95%;}
span.fstring {color:darkblue; font-style:italic; }
span.comment {font-family:arial; color:blue; font-style:italic; }
span.doccomment {font-family:arial; color:green; font-style:italic; }
span.big_keyword {color:#FF1010; }
span.small_keyword {color:#802040; }
span.qualifier {color:#A02020; }
span.library {color:#A02000; }
span.ctor {color:#406020; }
span.hack {color:#66DD00; }
span.preproc {color:#005500; }
span.embedded_c{background-color:#DDDDDD; }
span.fpc_fieldname {color:#DD0000; }
span.lineno {color:#101010; background-color:#E0E0E0; font-size:80%; font-family:"courier",monospace; font-style:normal; }
pre { border: 1px solid #ccc; color: black; box-shadow:3px 3px 2px rgba(0,0,0,0.1); padding:2px; }
pre.flxbg {background-color:#C2FDC2; box-shadow:3px 3px 2px rgba(0,0,0,0.1) }
pre.uncheckedflxbg {background-color:#eee; box-shadow:3px 3px 2px rgba(0,0,0,0.1); }
pre.cppbg {background-color:#C2FDC2; }
pre.prefmtbg {background-color:#F1F1F1; }
pre.expected {background-color:hsla(74,94%,88%,1); }
pre.input {background-color:hsla(20,94%,88%,1); }
pre.inclusion {
    font-family: Arial;
    font-weight: normal;
    font-size: 0.9em;
    color: #555;
    border: none;
    box-shadow: none;
    text-align: right;
    margin: -7px 11px -12px 0;
    padding: 0;
    background-color:#fafafa;
}
code.inclusion {background-color:#D070D0; color:black; }
.obsolete { background-color:#FFEFEF; font-size: small; color:black; }
.future { background-color:#FF8080; font-size: small; color:black; }
.implementation_detail { background-color:#E0E0E0; font-size: small; color:black;  }
.bug { background-color:#FFE0E0; font-size: small; color:black; }
.fixed{ background-color:#FFE0E0; font-size: small; color:black; }
.done { background-color:#FFE0E0; font-size: small; color:black; }
.caveat { background-color:hsla(0,100%,91%,1); color:black; padding: 0.6em; }
.container {
  position: fixed;
  top:0px;
  left:0px;
  height : 100%;
  width: 100%;
  background-color: grey;
  margin: 0px;
  padding: 0px;
  border-width: 0px;
  color: #404040;
}
.maincontent {
  padding:4px;
  padding-left:8px;
  line-height:1.3em;
  color:#404040; background-color:#fafafa;
}
.maincontent h1 { margin-left:-8px; position: relative; font-family: georgia, serif; font-size: 1.8em; font-weight: normal; }
.maincontent h2 { margin-left:-8px; position: relative; margin-bottom:-5px; }
.maincontent h3 { margin-left:-8px; position: relative; margin-bottom:-5px; }
.maincontent h4 { margin-left:-8px; position: relative; margin-bottom:-5px; }
.maincontent code { color:#902030; }
.toppanel {
  position:absolute; left:0px; top:0px; height:20px; right:0px;
  background-color: #e0e0e0;
}
.bottompanel {
  position:absolute; left:0px; top:22px; bottom:0px; right:0px;
  background-color: #fafafa;
  font-size:14px;
}
.leftpanel {
  position:absolute; left:0px; top:0px; bottom:0px; width: 150px;
  background-color: #eaeaea; overflow: auto;
}
.rightpanel {
  position:absolute; right: 0px; left:160px; top:0px; bottom: 0px;
  background-color: #fafafa; overflow: auto;
}
.divider {
  position:absolute; left: 150px; top:0px; bottom:0px;
  background-color: black; width:2px;
  box-shadow: 0 0 8px #000;
}

#panemover {
    position:absolute;
    left: 150px;
    width : 10px;
    top: 0px;
    bottom: 0px;
    opacity: 0.3;
    cursor:col-resize;
}

div.m {
    margin: 0px;
    padding:0px;
    border-width:2px;
    border-color: green;
}

div.m1 {
    background-color: #86E870;
    border-style:outset;
    border-color:#ccc;
    border-width:2px 0;
    font-size:90%;
    padding: 1px 0 2px 10px;
}

div.m2 {
    background-color: #70C070;
    padding-left:15px;
    padding-top:2px;
    border-style:outset;
    border-color:green;
    border-width:0 0 1px 0;
    font-size:80%;
}

div.m1:hover, div.m2:hover {
    background-color: white;
}

#leftmargintoc a {
    text-decoration: none;
    color: #404040;
}
</style>

<style>
div.m {
    margin: 0px;
    padding:0px;
    border-width:2px;
    border-color: green;
}

div.m1 {
    background-color: #86E870;
    border-style:outset;
    border-color:#ccc;
    border-width:2px 0;
    font-size:90%;
    padding: 1px 0 2px 10px;
}

div.m2 {
    background-color: #70C070;
    padding-left:15px;
    padding-top:2px;
    border-style:outset;
    border-color:green;
    border-width:0 0 1px 0;
    font-size:80%;
}

div.m1:hover, div.m2:hover {
    background-color: white;
}

#leftmargintoc a {
    text-decoration: none;
    color: #404040;
}


</style>

    <script async="true">
      function dragStart(e, left, right){
        document.getElementById("panemover").style.width="70%";
        document.getElementById("panemover").style.left="50px";
        mousedown = true;
        x = e.clientX
        dragOffsetLeft =
          document.getElementById(left).getBoundingClientRect().right -
          document.getElementById(left).getBoundingClientRect().left -
          x
        ;
        dragOffsetDivider= document.getElementById("divider").getBoundingClientRect().left - x;
        dragOffsetRight = document.getElementById(right).getBoundingClientRect().left - x;
      }
      function dragRelease(){
        document.getElementById('panemover').style.width = '10px';
        document.getElementById('panemover').style.left = document.getElementById('divider').offsetLeft + 'px';
        mousedown = false;
      }
      function drag(e, left, right){
        if(!mousedown){return}
        x = e.clientX
        tmpLeft = dragOffsetLeft + x
        tmpDivider= dragOffsetDivider + x
        tmpRight = dragOffsetRight + x
        document.getElementById(left).style.width= tmpLeft + 'px';
        document.getElementById("divider").style.left= tmpDivider + 'px';
        document.getElementById(right).style.left = tmpRight + 'px';
      };
    </script>

<script type="text/javascript">

  function mexpand(id)
  {
    var n = document.getElementById(id).style;
    n.display = "block";
  }

  function mcollapse(id)
  {
    var n = document.getElementById(id).style;
    n.display = "none";
  }

  var counter_max = 0;
  function mshow(id,loc)
  {
    var i;
    for(i=1; i<=counter_max; ++i)
      mcollapse("menu"+String(i));
    mexpand(id);
    window.location.replace(loc);
  }
</script>

<script type="text/javascript">

function expand(but,id)
{
  var n = document.getElementById(id).style;
  var button = document.getElementById(but);
  button.src = "/share/src/web/images/minus.gif";
  button.alt = "-";
  n.display = "block";
}
function collapse(but,id)
{
  var n = document.getElementById(id).style;
  var button = document.getElementById(but);
  button.src = "/share/src/web/images/plus.gif";
  button.alt = "+";
  n.display = "none";
}
function toggle(button,id)
{
  var n = document.getElementById(id).style;
  if (n.display == "none")
  {
    button.src = "/share/src/web/images/minus.gif";
    button.alt = "-";
    n.display = "block";
  }
  else
  {
    button.src = "/share/src/web/images/plus.gif";
    button.alt = "+";
    n.display = "none";
  }
}
var allbuttons = [
"Synopsis",
"Sqlite3",
"Test Example",
"Config Data"
];
function expand_all(dummy)
{
  for (i in allbuttons)
  {
    expand(allbuttons[i], allbuttons[i]+"_d");
  }
}
function collapse_all(dummy)
{
  for (i in allbuttons)
  {
    collapse(allbuttons[i], allbuttons[i]+"_d");
  }
}
</script>

<script>
function mouseover(id)
{
  var elt = document.getElementById(id);
  elt.style.display="none";
  var elt2 = document.getElementById(id+"_mo");
  elt2.style.display="inline";
}

function mouseout(id)
{
  var elt = document.getElementById(id+"_mo");
  elt.style.display="none";
  var elt2 = document.getElementById(id);
  elt2.style.display="inline";
}

</script>
<script> function nop(dummy) {} </script>
    <div class="container">
      <div class="toppanel">
    <!--Main Content top navbar-->
<span style="position:relative; bottom:6px"
  onmouseover="mouseover('expand')"
  onmouseout="mouseout('expand')"
  onclick="expand_all('expand')"
  ><span id="expand"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:blue;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Expand</text></svg></span><span id="expand_mo" style="display:none"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:red;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Expand</text></svg></span></span><span style="position:relative; bottom:6px"
  onmouseover="mouseover('collapse')"
  onmouseout="mouseout('collapse')"
  onclick="collapse_all('collapse')"
  ><span id="collapse"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:blue;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Collapse</text></svg></span><span id="collapse_mo" style="display:none"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:red;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Collapse</text></svg></span></span><a href='sqlite2.html'><span style="position:relative; bottom:6px"
  onmouseover="mouseover('prev')"
  onmouseout="mouseout('prev')"
  onclick="nop('prev')"
  ><span id="prev"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:blue;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Prev</text></svg></span><span id="prev_mo" style="display:none"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:red;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Prev</text></svg></span></span></a> <a href='sqlite4.html'><span style="position:relative; bottom:6px"
  onmouseover="mouseover('next')"
  onmouseout="mouseout('next')"
  onclick="nop('next')"
  ><span id="next"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:blue;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Next</text></svg></span><span id="next_mo" style="display:none"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:red;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Next</text></svg></span></span></a> <a href='sqliteindex.html'><span style="position:relative; bottom:6px"
  onmouseover="mouseover('index')"
  onmouseout="mouseout('index')"
  onclick="nop('index')"
  ><span id="index"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:blue;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Index</text></svg></span><span id="index_mo" style="display:none"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:red;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Index</text></svg></span></span></a>     <!--Main Content top navbar End-->

      </div> <!-- toppanel end -->
      <div class="bottompanel">
        <span id="divider" class="divider"></span>

        <span id="left" class="leftpanel" >
          <div class="menucontent">
  <!--Left Margin Toc-->
  <div id="leftmargintoc">
    <!--Left Margin Toc Main Contents-->
      <div class=m1 onclick="mshow('menu1','#Synopsis_h')"> <a href="#Synopsis_h">Synopsis</a></div>
      <div class=sm id=menu1>
      </div>
      <div class=m1 onclick="mshow('menu2','#Sqlite3_h')"> <a href="#Sqlite3_h">Sqlite3</a></div>
      <div class=sm id=menu2>
      </div>
      <div class=m1 onclick="mshow('menu3','#Test Example_h')"> <a href="#Test_Example_h">Test Example</a></div>
      <div class=sm id=menu3>
      </div>
      <div class=m1 onclick="mshow('menu4','#Config Data_h')"> <a href="#Config_Data_h">Config Data</a></div>
      <div class=sm id=menu4>
      </div>
    <script>counter_max=4;</script>
  </div>
  <!--End Left Margin Toc-->

          </div> <!-- leftpanel contents end -->
        </span> <!-- leftpanel end -->

        <span id="right" class="rightpanel">
          <div class="maincontent">
<!--Main Content Body-->
<h1 id='Synopsis_h'><img src='/share/src/web/images/minus.gif' id='Synopsis' onclick='toggle(this,"Synopsis_d")' alt='+'/> 3.1 Synopsis</h1><div id='Synopsis_d' style='display:block'>
<pre class='inclusion'>
share/lib/std/db/__init__.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  
<span class="lineno" id=line2></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/db/sqlite3"</span>;
<span class="lineno" id=line3></span>  
</pre></p></div><h1 id='Sqlite3_h'><img src='/share/src/web/images/minus.gif' id='Sqlite3' onclick='toggle(this,"Sqlite3_d")' alt='+'/> 3.2 Sqlite3</h1><div id='Sqlite3_d' style='display:block'>
<pre class='inclusion'>
share/lib/std/db/sqlite3.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  
<span class="lineno" id=line2></span>  
<span class="lineno" id=line3></span>  <span class="doccomment">Core Sqlite3 functions and extensions to provide row iterator, simple statement execution, </span>
<span class="lineno" id=line4></span>  <span class="doccomment">statement preperation and access to sqlite_step statement execution.</span>
<span class="lineno" id=line5></span>  <span class="doccomment">//$ Iterator example:</span>
<span class="lineno" id=line6></span>  <span class="doccomment"></span>
<span class="lineno" id=line7></span>  <span class="doccomment">//$@felix</span>
<span class="lineno" id=line8></span>  <span class="doccomment">var db : sqlite3_db_t;</span>
<span class="lineno" id=line9></span>  <span class="doccomment">var stmt:sqlite3_stmt_t;</span>
<span class="lineno" id=line10></span>  <span class="doccomment">var err = sqlite3_open("multiple_sa.db", &amp;db);</span>
<span class="lineno" id=line11></span>  <span class="doccomment">if err != 0 do</span>
<span class="lineno" id=line12></span>  <span class="doccomment">  print "open DB error[abort] ";</span>
<span class="lineno" id=line13></span>  <span class="doccomment">  println $ sqlite3_errmsg db;</span>
<span class="lineno" id=line14></span>  <span class="doccomment">  goto finish;</span>
<span class="lineno" id=line15></span>  <span class="doccomment">done;</span>
<span class="lineno" id=line16></span>  <span class="doccomment">err = sqlite3_prepare_v2(db, "select * from contact", 21, stmt, "");</span>
<span class="lineno" id=line17></span>  <span class="doccomment">if not err == (caseno SQLITE_OK) then</span>
<span class="lineno" id=line18></span>  <span class="doccomment">  { println ("sql error "+str(err)+":"+sqlite3_errmsg(db));goto finish; }</span>
<span class="lineno" id=line19></span>  <span class="doccomment">else {</span>
<span class="lineno" id=line20></span>  <span class="doccomment">  var it = sqlite3_row_iterator (stmt);</span>
<span class="lineno" id=line21></span>  <span class="doccomment">  var row:ret_val[darray[column_value]];</span>
<span class="lineno" id=line22></span>  <span class="doccomment">  while (fun ():bool = { row = it();</span>
<span class="lineno" id=line23></span>  <span class="doccomment">             return (match row with |end_of_results[darray[column_value]] =&gt;false |_ =&gt; true</span>
<span class="lineno" id=line24></span>  <span class="doccomment">             endmatch); }) () do</span>
<span class="lineno" id=line25></span>  <span class="doccomment">  var t = match row with </span>
<span class="lineno" id=line26></span>  <span class="doccomment">    | row a =&gt;  ((get_text_val(get(a,0))),(get_text_val(get(a,1))))</span>
<span class="lineno" id=line27></span>  <span class="doccomment">    | _ =&gt; ("","")</span>
<span class="lineno" id=line28></span>  <span class="doccomment">  endmatch;</span>
<span class="lineno" id=line29></span>  <span class="doccomment">  print t; endl;</span>
<span class="lineno" id=line30></span>  <span class="doccomment">  done</span>
<span class="lineno" id=line31></span>  <span class="doccomment">}</span>
<span class="lineno" id=line32></span>  <span class="doccomment">finish:&gt;</span>
<span class="lineno" id=line33></span>  <span class="doccomment">  err = sqlite3_finalize(stmt);</span>
<span class="lineno" id=line34></span>  <span class="doccomment">  println(str(err));</span>
<span class="lineno" id=line35></span>  <span class="doccomment">  sqlite3_close(db);</span>
<span class="lineno" id=line36></span>  <span class="doccomment"></span>
<span class="lineno" id=line37></span>  
<span class="lineno" id=line38></span>  <span class="big_keyword" title="Define a type class">class</span> Sqlite3 {
<span class="lineno" id=line39></span>    <span class="big_keyword" title="specify requirements">requires</span> <span class="small_keyword" title="specifies an abstract package name">package</span> <span class="fstring">"flx_sqlite3"</span>;
<span class="lineno" id=line40></span>  
<span class="lineno" id=line41></span>    <span class="doccomment">Type of a database handle.</span>
<span class="lineno" id=line42></span>    <span class="big_keyword" title="Define a primitive type by binding to a C type">type</span> sqlite3_db_t = <span class="fstring">"sqlite3*"</span>;
<span class="lineno" id=line43></span>  
<span class="lineno" id=line44></span>    <span class="doccomment">Database open.</span>
<span class="lineno" id=line45></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> sqlite3_open : <span class="library" title="binding of C++ string type">string</span> * &amp;sqlite3_db_t -&gt; <span class="library" title="binding of C int type">int</span> =
<span class="lineno" id=line46></span>      <span class="fstring">"sqlite3_open($1.c_str(), $2)"</span>
<span class="lineno" id=line47></span>    ;
<span class="lineno" id=line48></span>  
<span class="lineno" id=line49></span>    <span class="doccomment">Database close.</span>
<span class="lineno" id=line50></span>    <span class="big_keyword" title="Define a procedure, a function with side-effects not returning a value">proc</span> sqlite3_close : sqlite3_db_t = <span class="fstring">"sqlite3_close($1);"</span>;
<span class="lineno" id=line51></span>  
<span class="lineno" id=line52></span>    <span class="doccomment">Type of an exec callback.</span>
<span class="lineno" id=line53></span>    <span class="big_keyword" title="Define an alias for a type expression">typedef</span> sqlite3_exec_callback_t = 
<span class="lineno" id=line54></span>      <span class="library" title="special binding of C void* type">address</span>      <span class="comment">// client data pointer established by call to sqlite3_exec </span>
<span class="lineno" id=line55></span>      * <span class="library" title="binding of C int type">int</span>        <span class="comment">// number of result columns</span>
<span class="lineno" id=line56></span>      * +(+<span class="library" title="binding of C char type">char</span>)   <span class="comment">// column value as text</span>
<span class="lineno" id=line57></span>      * +(+<span class="library" title="binding of C char type">char</span>)   <span class="comment">// column name</span>
<span class="lineno" id=line58></span>      --&gt; <span class="library" title="binding of C int type">int</span>
<span class="lineno" id=line59></span>    ;
<span class="lineno" id=line60></span>  
<span class="lineno" id=line61></span>    <span class="doccomment">Quick sql execution using callback.</span>
<span class="lineno" id=line62></span>    <span class="doccomment">arg1: db_handle</span>
<span class="lineno" id=line63></span>    <span class="doccomment">arg2: sql statement.</span>
<span class="lineno" id=line64></span>    <span class="doccomment">arg3: callback function.</span>
<span class="lineno" id=line65></span>    <span class="doccomment">arg4: client data pointer.</span>
<span class="lineno" id=line66></span>    <span class="doccomment">arg5: pointer to error message array.</span>
<span class="lineno" id=line67></span>    <span class="doccomment">result: error code.</span>
<span class="lineno" id=line68></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> sqlite3_exec : sqlite3_db_t * <span class="library" title="binding of C++ string type">string</span> * sqlite3_exec_callback_t * <span class="library" title="special binding of C void* type">address</span> * &amp;(+<span class="library" title="binding of C char type">char</span>) -&gt; <span class="library" title="binding of C int type">int</span> =
<span class="lineno" id=line69></span>      <span class="fstring">"sqlite3_exec($1,$2.c_str(),$3,$4,$5)"</span>
<span class="lineno" id=line70></span>    ;
<span class="lineno" id=line71></span>  
<span class="lineno" id=line72></span>    <span class="doccomment">quick sql execution without data handler callback.</span>
<span class="lineno" id=line73></span>    <span class="doccomment">arg1: db_handle</span>
<span class="lineno" id=line74></span>    <span class="doccomment">arg2: sql statement.</span>
<span class="lineno" id=line75></span>    <span class="doccomment">arg3: pointer to error message array.</span>
<span class="lineno" id=line76></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> sqlite3_exec : sqlite3_db_t * <span class="library" title="binding of C++ string type">string</span>   * &amp;(+<span class="library" title="binding of C char type">char</span>) -&gt; <span class="library" title="binding of C int type">int</span> =
<span class="lineno" id=line77></span>      <span class="fstring">"sqlite3_exec($1,$2.c_str(),0,0,$3)"</span>
<span class="lineno" id=line78></span>    ;
<span class="lineno" id=line79></span>  
<span class="lineno" id=line80></span>  
<span class="lineno" id=line81></span>    <span class="doccomment">Error message extractor.</span>
<span class="lineno" id=line82></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> sqlite3_errmsg : sqlite3_db_t -&gt; +<span class="library" title="binding of C char type">char</span>=
<span class="lineno" id=line83></span>      <span class="fstring">"(char*)sqlite3_errmsg($1)"</span>
<span class="lineno" id=line84></span>    ;
<span class="lineno" id=line85></span>  
<span class="lineno" id=line86></span>    <span class="doccomment">Type of sql statement handle.</span>
<span class="lineno" id=line87></span>    <span class="big_keyword" title="Define a primitive type by binding to a C type">type</span> sqlite3_stmt_t = <span class="fstring">"sqlite3_stmt*"</span>;
<span class="lineno" id=line88></span>  
<span class="lineno" id=line89></span>    <span class="doccomment">Sqlite3 return codes.</span>
<span class="lineno" id=line90></span>    <span class="big_keyword" title="Elaborate an enumeration, a simple sum type">enum</span> sqlite3_result_codes {
<span class="lineno" id=line91></span>       SQLITE_OK         =   0,   <span class="comment">/* Successful result */</span>
<span class="lineno" id=line92></span>       SQLITE_ERROR      =   1,   <span class="comment">/* SQL error or missing database */</span>
<span class="lineno" id=line93></span>       SQLITE_INTERNAL   =   2,   <span class="comment">/* Internal logic error in SQLite */</span>
<span class="lineno" id=line94></span>       SQLITE_PERM       =   3,   <span class="comment">/* Access permission denied */</span>
<span class="lineno" id=line95></span>       SQLITE_ABORT      =   4,   <span class="comment">/* Callback routine requested an abort */</span>
<span class="lineno" id=line96></span>       SQLITE_BUSY       =   5,   <span class="comment">/* The database file is locked */</span>
<span class="lineno" id=line97></span>       SQLITE_LOCKED     =   6,   <span class="comment">/* A table in the database is locked */</span>
<span class="lineno" id=line98></span>       SQLITE_NOMEM      =   7,   <span class="comment">/* A malloc() failed */</span>
<span class="lineno" id=line99></span>       SQLITE_READONLY   =   8,   <span class="comment">/* Attempt to write a readonly database */</span>
<span class="lineno" id=line100></span>       SQLITE_INTERRUPT  =   9,   <span class="comment">/* Operation terminated by sqlite3_interrupt()*/</span>
<span class="lineno" id=line101></span>       SQLITE_IOERR      =  10,   <span class="comment">/* Some kind of disk I/O error occurred */</span>
<span class="lineno" id=line102></span>       SQLITE_CORRUPT    =  11,   <span class="comment">/* The database disk image is malformed */</span>
<span class="lineno" id=line103></span>       SQLITE_NOTFOUND   =  12,   <span class="comment">/* Unknown opcode in sqlite3_file_control() */</span>
<span class="lineno" id=line104></span>       SQLITE_FULL       =  13,   <span class="comment">/* Insertion failed because database is full */</span>
<span class="lineno" id=line105></span>       SQLITE_CANTOPEN   =  14,   <span class="comment">/* Unable to open the database file */</span>
<span class="lineno" id=line106></span>       SQLITE_PROTOCOL   =  15,   <span class="comment">/* Database lock protocol error */</span>
<span class="lineno" id=line107></span>       SQLITE_EMPTY      =  16,   <span class="comment">/* Database is empty */</span>
<span class="lineno" id=line108></span>       SQLITE_SCHEMA     =  17,   <span class="comment">/* The database schema changed */</span>
<span class="lineno" id=line109></span>       SQLITE_TOOBIG     =  18,   <span class="comment">/* String or BLOB exceeds size limit */</span>
<span class="lineno" id=line110></span>       SQLITE_CONSTRAINT =  19,   <span class="comment">/* Abort due to constraint violation */</span>
<span class="lineno" id=line111></span>       SQLITE_MISMATCH   =  20,   <span class="comment">/* Data type mismatch */</span>
<span class="lineno" id=line112></span>       SQLITE_MISUSE     =  21,   <span class="comment">/* Library used incorrectly */</span>
<span class="lineno" id=line113></span>       SQLITE_NOLFS      =  22,   <span class="comment">/* Uses OS features not supported on host */</span>
<span class="lineno" id=line114></span>       SQLITE_AUTH       =  23,   <span class="comment">/* Authorization denied */</span>
<span class="lineno" id=line115></span>       SQLITE_FORMAT     =  24,   <span class="comment">/* Auxiliary database format error */</span>
<span class="lineno" id=line116></span>       SQLITE_RANGE      =  25,   <span class="comment">/* 2nd parameter to sqlite3_bind out of range */</span>
<span class="lineno" id=line117></span>       SQLITE_NOTADB     =  26,   <span class="comment">/* File opened that is not a database file */</span>
<span class="lineno" id=line118></span>       SQLITE_ROW        =  100,  <span class="comment">/* sqlite3_step() has another row ready */</span>
<span class="lineno" id=line119></span>       SQLITE_DONE       =  101,  <span class="comment">/* sqlite3_step() has finished executing */</span>
<span class="lineno" id=line120></span>       SQLITE_UNK_RESULT = 999
<span class="lineno" id=line121></span>    }
<span class="lineno" id=line122></span>  
<span class="lineno" id=line123></span>    <span class="doccomment">Conversion from int result to named return codes.</span>
<span class="lineno" id=line124></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> to_sqlite3_result_code: <span class="library" title="binding of C int type">int</span> -&gt; sqlite3_result_codes =
<span class="lineno" id=line125></span>       |0 =&gt; SQLITE_OK        
<span class="lineno" id=line126></span>       |1 =&gt; SQLITE_ERROR     
<span class="lineno" id=line127></span>       |2 =&gt; SQLITE_INTERNAL  
<span class="lineno" id=line128></span>       |3 =&gt; SQLITE_PERM      
<span class="lineno" id=line129></span>       |4 =&gt; SQLITE_ABORT     
<span class="lineno" id=line130></span>       |5 =&gt; SQLITE_BUSY      
<span class="lineno" id=line131></span>       |6 =&gt; SQLITE_LOCKED    
<span class="lineno" id=line132></span>       |7 =&gt; SQLITE_NOMEM     
<span class="lineno" id=line133></span>       |8 =&gt; SQLITE_READONLY  
<span class="lineno" id=line134></span>       |9 =&gt; SQLITE_INTERRUPT 
<span class="lineno" id=line135></span>       |10 =&gt; SQLITE_IOERR    
<span class="lineno" id=line136></span>       |11 =&gt; SQLITE_CORRUPT  
<span class="lineno" id=line137></span>       |12 =&gt; SQLITE_NOTFOUND 
<span class="lineno" id=line138></span>       |13 =&gt; SQLITE_FULL     
<span class="lineno" id=line139></span>       |14 =&gt; SQLITE_CANTOPEN 
<span class="lineno" id=line140></span>       |15 =&gt; SQLITE_PROTOCOL 
<span class="lineno" id=line141></span>       |16 =&gt; SQLITE_EMPTY    
<span class="lineno" id=line142></span>       |17 =&gt; SQLITE_SCHEMA   
<span class="lineno" id=line143></span>       |18 =&gt; SQLITE_TOOBIG   
<span class="lineno" id=line144></span>       |19 =&gt; SQLITE_CONSTRAINT
<span class="lineno" id=line145></span>       |20 =&gt; SQLITE_MISMATCH 
<span class="lineno" id=line146></span>       |21 =&gt; SQLITE_MISUSE 
<span class="lineno" id=line147></span>       |22 =&gt; SQLITE_NOLFS  
<span class="lineno" id=line148></span>       |23 =&gt; SQLITE_AUTH   
<span class="lineno" id=line149></span>       |24 =&gt; SQLITE_FORMAT 
<span class="lineno" id=line150></span>       |25 =&gt; SQLITE_RANGE  
<span class="lineno" id=line151></span>       |26 =&gt; SQLITE_NOTADB 
<span class="lineno" id=line152></span>       |100 =&gt; SQLITE_ROW   
<span class="lineno" id=line153></span>       |101 =&gt; SQLITE_DONE 
<span class="lineno" id=line154></span>       | _   =&gt; SQLITE_UNK_RESULT;
<span class="lineno" id=line155></span>  
<span class="lineno" id=line156></span>    <span class="doccomment">Tag names for Sqlite3 data types.</span>
<span class="lineno" id=line157></span>    <span class="big_keyword" title="Elaborate an enumeration, a simple sum type">enum</span> sqlite3_types {
<span class="lineno" id=line158></span>      SQLITE_INTEGER  = 1,
<span class="lineno" id=line159></span>      SQLITE_FLOAT    = 2,
<span class="lineno" id=line160></span>      SQLITE_TEXT     = 3,
<span class="lineno" id=line161></span>      SQLITE_BLOB     = 4,
<span class="lineno" id=line162></span>      SQLITE_NULL     = 5,
<span class="lineno" id=line163></span>      SQLITE_UNK_TYPE = 999
<span class="lineno" id=line164></span>    }
<span class="lineno" id=line165></span>  
<span class="lineno" id=line166></span>    <span class="big_keyword" title="Provide an instance of a typeclass">instance</span> Eq[sqlite3_result_codes]  {
<span class="lineno" id=line167></span>      <span class="doccomment">Allow checking for specific return codes.</span>
<span class="lineno" id=line168></span>      <span class="big_keyword" title="Define a function with no side-effects">fun</span> ==: sqlite3_result_codes * sqlite3_result_codes -&gt; bool = <span class="fstring">"$1==$2"</span>;
<span class="lineno" id=line169></span>    }
<span class="lineno" id=line170></span>    <span class="big_keyword" title="Open a module or class">open</span> Eq[sqlite3_result_codes];
<span class="lineno" id=line171></span>  
<span class="lineno" id=line172></span>    <span class="doccomment">Conversion from int type to named Sqlite3 data type.</span>
<span class="lineno" id=line173></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> to_sqlite3_type: <span class="library" title="binding of C int type">int</span> -&gt; sqlite3_types =
<span class="lineno" id=line174></span>      |1 =&gt; SQLITE_INTEGER
<span class="lineno" id=line175></span>      |2 =&gt; SQLITE_FLOAT 
<span class="lineno" id=line176></span>      |4 =&gt; SQLITE_BLOB
<span class="lineno" id=line177></span>      |5 =&gt; SQLITE_NULL
<span class="lineno" id=line178></span>      |3 =&gt; SQLITE_TEXT
<span class="lineno" id=line179></span>      | _ =&gt; SQLITE_UNK_TYPE;
<span class="lineno" id=line180></span>  
<span class="lineno" id=line181></span>       
<span class="lineno" id=line182></span>    <span class="doccomment">Prepare an sqlite3 statement for execution.</span>
<span class="lineno" id=line183></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> sqlite3_prepare_v2: sqlite3_db_t * <span class="library" title="binding of C++ string type">string</span> * <span class="library" title="binding of C int type">int</span> * sqlite3_stmt_t *<span class="library" title="binding of C++ string type">string</span> -&gt; <span class="library" title="binding of C int type">int</span> =
<span class="lineno" id=line184></span>    <span class="fstring">"sqlite3_prepare_v2($1,$2.c_str(),$3,&amp;$4,NULL)"</span>;
<span class="lineno" id=line185></span>   
<span class="lineno" id=line186></span>    <span class="doccomment">Execute one step of the prepared statement.</span>
<span class="lineno" id=line187></span>    <span class="qualifier" title="Function or procedure which must not be inlined">noinline</span> <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> sqlite3_step: sqlite3_stmt_t -&gt; <span class="library" title="binding of C int type">int</span> = <span class="fstring">"sqlite3_step($1)"</span>;
<span class="lineno" id=line188></span>   
<span class="lineno" id=line189></span>    <span class="doccomment">Determine the number of columns (field) a statement will process.</span>
<span class="lineno" id=line190></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> sqlite3_column_count: sqlite3_stmt_t -&gt; <span class="library" title="binding of C int type">int</span> = <span class="fstring">"sqlite3_column_count($1)"</span>;
<span class="lineno" id=line191></span>  
<span class="lineno" id=line192></span>    <span class="doccomment">Determine the name of the n'th column to be processed.</span>
<span class="lineno" id=line193></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> sqlite3_column_name: sqlite3_stmt_t*<span class="library" title="binding of C int type">int</span> -&gt; <span class="library" title="binding of C++ string type">string</span> = <span class="fstring">"sqlite3_column_name($1,$2)"</span>;
<span class="lineno" id=line194></span>  
<span class="lineno" id=line195></span>    <span class="doccomment">Determine the type of the n'th column to be processed.</span>
<span class="lineno" id=line196></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> sqlite3_column_type: sqlite3_stmt_t*int-&gt;<span class="library" title="binding of C int type">int</span> = <span class="fstring">"sqlite3_column_type($1,$2)"</span>;
<span class="lineno" id=line197></span>  
<span class="lineno" id=line198></span>    <span class="doccomment">Fetch the value of a text field.</span>
<span class="lineno" id=line199></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> sqlite3_column_text: sqlite3_stmt_t*int-&gt;<span class="library" title="binding of C++ string type">string</span> = <span class="fstring">"(char *)(sqlite3_column_text($1,$2))"</span>;
<span class="lineno" id=line200></span>  
<span class="lineno" id=line201></span>    <span class="doccomment">Fetch the value of a double field.</span>
<span class="lineno" id=line202></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> sqlite3_column_double: sqlite3_stmt_t*int-&gt;<span class="library" title="binding of C double float type">double</span> = <span class="fstring">"sqlite3_column_double($1,$2)"</span>;
<span class="lineno" id=line203></span>  
<span class="lineno" id=line204></span>    <span class="doccomment">Fetch the value of a int field.</span>
<span class="lineno" id=line205></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> sqlite3_column_int: sqlite3_stmt_t*int-&gt;<span class="library" title="binding of C int type">int</span> = <span class="fstring">"sqlite3_column_int($1,$2)"</span>;
<span class="lineno" id=line206></span>  
<span class="lineno" id=line207></span>    <span class="doccomment">Fetch the value of a blob field.</span>
<span class="lineno" id=line208></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> sqlite3_column_blob: sqlite3_stmt_t*int-&gt;&amp;<span class="library" title="special binding of C unsigned char type">byte</span> = <span class="fstring">"(unsigned char *)sqlite3_column_blob($1,$2)"</span>;
<span class="lineno" id=line209></span>    
<span class="lineno" id=line210></span>    <span class="doccomment">Fetch the number of bytes of a field.</span>
<span class="lineno" id=line211></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> sqlite3_column_bytes: sqlite3_stmt_t*<span class="library" title="binding of C int type">int</span> -&gt; <span class="library" title="binding of C int type">int</span> = <span class="fstring">"sqlite3_column_bytes($1,$2)"</span>;
<span class="lineno" id=line212></span>  
<span class="lineno" id=line213></span>    <span class="doccomment">Finish up with stepping a statement.</span>
<span class="lineno" id=line214></span>    <span class="doccomment">Releases associated resources.</span>
<span class="lineno" id=line215></span>    <span class="doccomment">The statement handle becomes invalid afterwards.</span>
<span class="lineno" id=line216></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> sqlite3_finalize: sqlite3_stmt_t -&gt; <span class="library" title="binding of C int type">int</span> = <span class="fstring">"sqlite3_finalize($1)"</span>;
<span class="lineno" id=line217></span>  
<span class="lineno" id=line218></span>    <span class="doccomment">A unified type to fetch a field value.</span>
<span class="lineno" id=line219></span>    variant column_value =
<span class="lineno" id=line220></span>       |int_val of <span class="library" title="binding of C int type">int</span>
<span class="lineno" id=line221></span>       |double_val of <span class="library" title="binding of C double float type">double</span>
<span class="lineno" id=line222></span>       |text_val of <span class="library" title="binding of C++ string type">string</span>
<span class="lineno" id=line223></span>       |byte_val of <span class="library" title="binding of C int type">int</span>*&amp;<span class="library" title="special binding of C unsigned char type">byte</span>
<span class="lineno" id=line224></span>       |null_val;
<span class="lineno" id=line225></span>  
<span class="lineno" id=line226></span>    <span class="doccomment">A unified result of a statement.</span>
<span class="lineno" id=line227></span>    variant ret_val[t] =
<span class="lineno" id=line228></span>       |row of t
<span class="lineno" id=line229></span>       |row_fail of sqlite3_result_codes*<span class="library" title="binding of C++ string type">string</span>
<span class="lineno" id=line230></span>       |end_of_results;
<span class="lineno" id=line231></span>  
<span class="lineno" id=line232></span>    <span class="doccomment">A unified result code.</span>
<span class="lineno" id=line233></span>    variant result_code[t] =
<span class="lineno" id=line234></span>      | qry_ok of t
<span class="lineno" id=line235></span>      | qry_fail of sqlite3_result_codes*<span class="library" title="binding of C++ string type">string</span>;
<span class="lineno" id=line236></span>  
<span class="lineno" id=line237></span>    <span class="doccomment">Unified preparation of a query.</span>
<span class="lineno" id=line238></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> sqlite3_prepare_stmt (db:sqlite3_db_t,query:<span class="library" title="binding of C++ string type">string</span>):result_code[sqlite3_stmt_t] = {
<span class="lineno" id=line239></span>      <span class="big_keyword" title="Define a mutable variable">var</span> stmt:sqlite3_stmt_t;
<span class="lineno" id=line240></span>      <span class="small_keyword" title="return">return</span> <span class="small_keyword" title="match statement or expression">match</span> to_sqlite3_result_code ( sqlite3_prepare_v2(db, query, <span class="library" title="binding of C int type">int</span>(<span class="library" title="number of elements in data structure">len</span> query), stmt, <span class="fstring">""</span>)) <span class="small_keyword" title="type-class constraint">with</span>
<span class="lineno" id=line241></span>        | #SQLITE_OK =&gt;  qry_ok stmt
<span class="lineno" id=line242></span>        | c     =&gt; qry_fail[sqlite3_stmt_t] (c,<span class="library" title="Convert a value to a string">str</span>(sqlite3_errmsg(db)))
<span class="lineno" id=line243></span>      <span class="small_keyword" title="end a match statement or expression">endmatch</span>;
<span class="lineno" id=line244></span>    }
<span class="lineno" id=line245></span>  
<span class="lineno" id=line246></span>    <span class="doccomment">Fetch all the columns of a query at once.</span>
<span class="lineno" id=line247></span>    <span class="doccomment">Return them in a darray.</span>
<span class="lineno" id=line248></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> sqlite3_get_columns (stmt:sqlite3_stmt_t):<span class="library" title="array with unbounded dynamically variable limit">darray</span>[column_value] = {
<span class="lineno" id=line249></span>      <span class="big_keyword" title="Define an immutable value">val</span> n = sqlite3_column_count(stmt);
<span class="lineno" id=line250></span>      <span class="big_keyword" title="Define an immutable value">val</span> results = <span class="library" title="array with unbounded dynamically variable limit">darray</span>[column_value]( <span class="library" title="binding of C size_t type">size</span> n,null_val);
<span class="lineno" id=line251></span>      <span class="small_keyword" title="for loop">for</span> <span class="big_keyword" title="Define a mutable variable">var</span> i:<span class="library" title="binding of C int type">int</span> <span class="small_keyword" title="membership operator, function mem">in</span> 0 <span class="small_keyword" title="upwards counting for loop">upto</span> n - 1 <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line252></span>         <span class="big_keyword" title="Define a mutable variable">var</span> v = <span class="small_keyword" title="match statement or expression">match</span> to_sqlite3_type( sqlite3_column_type(stmt, i) ) <span class="small_keyword" title="type-class constraint">with</span>
<span class="lineno" id=line253></span>                   | #SQLITE_TEXT    =&gt; text_val (sqlite3_column_text(stmt, i))
<span class="lineno" id=line254></span>                   | #SQLITE_INTEGER     =&gt; int_val (sqlite3_column_int(stmt, i))
<span class="lineno" id=line255></span>                   | #SQLITE_FLOAT   =&gt; double_val (sqlite3_column_double(stmt, i))
<span class="lineno" id=line256></span>                   | #SQLITE_BLOB    =&gt; byte_val (sqlite3_column_bytes(stmt,i),
<span class="lineno" id=line257></span>                                                sqlite3_column_blob(stmt, i)) 
<span class="lineno" id=line258></span>                   | #SQLITE_NULL =&gt; null_val
<span class="lineno" id=line259></span>                 <span class="small_keyword" title="end a match statement or expression">endmatch</span>;
<span class="lineno" id=line260></span>         set(results,i,v );
<span class="lineno" id=line261></span>      <span class="small_keyword" title="end of body">done</span>;
<span class="lineno" id=line262></span>      <span class="small_keyword" title="return">return</span> results;
<span class="lineno" id=line263></span>    }
<span class="lineno" id=line264></span>  
<span class="lineno" id=line265></span>  
<span class="lineno" id=line266></span>    <span class="doccomment">A stream iterator which returns successive rows of a table.</span>
<span class="lineno" id=line267></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> sqlite3_row_iterator (stmt:sqlite3_stmt_t) () :ret_val[<span class="library" title="array with unbounded dynamically variable limit">darray</span>[column_value]]  = {
<span class="lineno" id=line268></span>      again:&gt; 
<span class="lineno" id=line269></span>        <span class="big_keyword" title="Define a mutable variable">var</span> result_code = to_sqlite3_result_code$ sqlite3_step(stmt);
<span class="lineno" id=line270></span>        <span class="small_keyword" title="conditional">if</span> result_code == SQLITE_BUSY <span class="small_keyword" title="imperative code begins">do</span> <span class="small_keyword" title="jump to label">goto</span> again; <span class="small_keyword" title="end of body">done</span>;
<span class="lineno" id=line271></span>         <span class="small_keyword" title="match statement or expression">match</span> result_code  <span class="small_keyword" title="type-class constraint">with</span>
<span class="lineno" id=line272></span>          | #SQLITE_DONE =&gt; {<span class="big_keyword" title="Define an immutable value">val</span> p=sqlite3_finalize(stmt);}(); <span class="small_keyword" title="return a value saving the current location for future resumption">yield</span> end_of_results[<span class="library" title="array with unbounded dynamically variable limit">darray</span>[column_value]];
<span class="lineno" id=line273></span>          | #SQLITE_ROW  =&gt; <span class="small_keyword" title="return a value saving the current location for future resumption">yield</span> ( row ( sqlite3_get_columns stmt) );
<span class="lineno" id=line274></span>        <span class="comment">//| #SQLITE_BUSY =&gt; { Faio::sleep (Faio::sys_clock,0.05); goto again; end_of_results[darray[column_value]];}</span>
<span class="lineno" id=line275></span>           | v =&gt;  {<span class="big_keyword" title="Define an immutable value">val</span> p=sqlite3_finalize stmt;}(); <span class="small_keyword" title="return a value saving the current location for future resumption">yield</span>  end_of_results[<span class="library" title="array with unbounded dynamically variable limit">darray</span>[column_value]];
<span class="lineno" id=line276></span>        <span class="small_keyword" title="end a match statement or expression">endmatch</span>;
<span class="lineno" id=line277></span>        <span class="small_keyword" title="jump to label">goto</span> again;
<span class="lineno" id=line278></span>        <span class="small_keyword" title="return a value saving the current location for future resumption">yield</span> end_of_results[<span class="library" title="array with unbounded dynamically variable limit">darray</span>[column_value]]; 
<span class="lineno" id=line279></span>    }
<span class="lineno" id=line280></span>  
<span class="lineno" id=line281></span>  
<span class="lineno" id=line282></span>    <span class="doccomment">Get the int value out of a int typed field.</span>
<span class="lineno" id=line283></span>    <span class="doccomment">Throws match failure if the field isn't an int type.</span>
<span class="lineno" id=line284></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> get_int_val: column_value-&gt;<span class="library" title="binding of C int type">int</span> = | int_val v =&gt; v;
<span class="lineno" id=line285></span>  
<span class="lineno" id=line286></span>    <span class="doccomment">Get the double value out of a double typed field.</span>
<span class="lineno" id=line287></span>    <span class="doccomment">Throws match failure if the field isn't a double type.</span>
<span class="lineno" id=line288></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> get_double_val:  column_value-&gt;<span class="library" title="binding of C double float type">double</span> = | double_val v =&gt; v;
<span class="lineno" id=line289></span>  
<span class="lineno" id=line290></span>    <span class="doccomment">Get the text value out of a text typed field.</span>
<span class="lineno" id=line291></span>    <span class="doccomment">Throws match failure if the field isn't a text type.</span>
<span class="lineno" id=line292></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> get_text_val:  column_value-&gt;<span class="library" title="binding of C++ string type">string</span> = | text_val v =&gt; v;
<span class="lineno" id=line293></span>  
<span class="lineno" id=line294></span>    <span class="doccomment">Get the statement handle out of a return code.</span>
<span class="lineno" id=line295></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> get_stmt: result_code[sqlite3_stmt_t]-&gt; sqlite3_stmt_t = | qry_ok v =&gt; v;
<span class="lineno" id=line296></span>  
<span class="lineno" id=line297></span>    <span class="doccomment">Get the next row from an row iterator.</span>
<span class="lineno" id=line298></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> get_next ( <span class="library" title="call procedure on each element of data structure">iter</span>:()-&gt;ret_val[<span class="library" title="array with unbounded dynamically variable limit">darray</span>[column_value]],row:&amp;ret_val[<span class="library" title="array with unbounded dynamically variable limit">darray</span>[column_value]]):bool = { 
<span class="lineno" id=line299></span>      row &lt;- <span class="library" title="call procedure on each element of data structure">iter</span>();
<span class="lineno" id=line300></span>       <span class="small_keyword" title="return">return</span> (<span class="small_keyword" title="match statement or expression">match</span> *row <span class="small_keyword" title="type-class constraint">with</span> 
<span class="lineno" id=line301></span>                | #end_of_results =&gt;<span class="library" title="false value">false</span> 
<span class="lineno" id=line302></span>                | #row_fail =&gt;<span class="library" title="false value">false</span> 
<span class="lineno" id=line303></span>                | _ =&gt; <span class="library" title="truth value">true</span>
<span class="lineno" id=line304></span>              <span class="small_keyword" title="end a match statement or expression">endmatch</span>); 
<span class="lineno" id=line305></span>    }
<span class="lineno" id=line306></span>  
<span class="lineno" id=line307></span>    <span class="doccomment">Execute an prepared statement.</span>
<span class="lineno" id=line308></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> sqlite3_execute (stmt:sqlite3_stmt_t) :bool  = {     
<span class="lineno" id=line309></span>        <span class="big_keyword" title="Define an immutable value">val</span> v= <span class="small_keyword" title="match statement or expression">match</span> to_sqlite3_result_code$ sqlite3_step(stmt)  <span class="small_keyword" title="type-class constraint">with</span>
<span class="lineno" id=line310></span>          | #SQLITE_BUSY =&gt; sqlite3_execute(stmt)
<span class="lineno" id=line311></span>          | #SQLITE_DONE =&gt; <span class="library" title="truth value">true</span>
<span class="lineno" id=line312></span>          | _           =&gt; <span class="library" title="false value">false</span>
<span class="lineno" id=line313></span>        <span class="small_keyword" title="end a match statement or expression">endmatch</span>;
<span class="lineno" id=line314></span>        <span class="big_keyword" title="Define an immutable value">val</span> n = sqlite3_finalize stmt;
<span class="lineno" id=line315></span>        <span class="small_keyword" title="return">return</span> v;
<span class="lineno" id=line316></span>    }
<span class="lineno" id=line317></span>  
<span class="lineno" id=line318></span>    <span class="big_keyword" title="Specify C code to be inserted into header file">header</span> """<span class="embedded_c">
<span class="lineno" id=line319></span>      <span class="small_keyword">std</span>::string sqlite3_quote_helper(<span class="qualifier">const</span> <span class="qualifier">char</span> *str) {
<span class="lineno" id=line320></span>        <span class="qualifier">const</span> <span class="qualifier">char</span> * val = sqlite3_mprintf(<span class="fstring">"%q"</span>,str);
<span class="lineno" id=line321></span>        <span class="small_keyword">std</span>::string ret = <span class="small_keyword">std</span>::string(val);
<span class="lineno" id=line322></span>        sqlite3_free((<span class="qualifier">char</span> *)val);
<span class="lineno" id=line323></span>        <span class="small_keyword">return</span> ret;
<span class="lineno" id=line324></span>      }
<span class="lineno" id=line325></span>    </span>""";
<span class="lineno" id=line326></span>  
<span class="lineno" id=line327></span>    <span class="doccomment">Quote a string for use in a query.</span>
<span class="lineno" id=line328></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> sqlite3_quote: string-&gt;<span class="library" title="binding of C++ string type">string</span> = <span class="fstring">"sqlite3_quote_helper($1.c_str())"</span>;
<span class="lineno" id=line329></span>  
<span class="lineno" id=line330></span>  }
<span class="lineno" id=line331></span>  
<span class="lineno" id=line332></span>  
</pre></p></div><h1 id='Test_Example_h'><img src='/share/src/web/images/minus.gif' id='Test Example' onclick='toggle(this,"Test_Example_d")' alt='+'/> 3.3 Test Example</h1><div id='Test_Example_d' style='display:block'>
<pre class='inclusion'>
$PWD/src/test/regress/rt/sqlite_01.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/db/sqlite3"</span>;
<span class="lineno" id=line2></span>  
<span class="lineno" id=line3></span>  <span class="big_keyword" title="Open a module or class">open</span> Sqlite3;
<span class="lineno" id=line4></span>  
<span class="lineno" id=line5></span>  <span class="big_keyword" title="Define a function with no side-effects">fun</span> subscript: + (+<span class="library" title="binding of C char type">char</span>) * <span class="library" title="binding of C int type">int</span> -&gt; +<span class="library" title="binding of C char type">char</span> = <span class="fstring">"$1[$2]"</span>;
<span class="lineno" id=line6></span>  
<span class="lineno" id=line7></span>  <span class="big_keyword" title="Define a C function">cfun</span> eh(data:<span class="library" title="special binding of C void* type">address</span>, ncols:<span class="library" title="binding of C int type">int</span>, values: + (+<span class="library" title="binding of C char type">char</span>), names: + (+<span class="library" title="binding of C char type">char</span>)):<span class="library" title="binding of C int type">int</span> =
<span class="lineno" id=line8></span>  {
<span class="lineno" id=line9></span>    <span class="big_keyword" title="Define a mutable variable">var</span> ii:<span class="library" title="binding of C int type">int</span> = 0;
<span class="lineno" id=line10></span>    <span class="small_keyword" title="while loop">while</span> ii&lt;ncols <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line11></span>      <span class="library" title="Print a string to standard output">print</span>$ <span class="library" title="Convert a value to a string">str</span> names.[ii] + <span class="fstring">"="</span> + <span class="library" title="Convert a value to a string">str</span> values.[ii];
<span class="lineno" id=line12></span>      <span class="small_keyword" title="conditional">if</span> ii&lt;ncols- 1  <span class="small_keyword" title="imperative code begins">do</span> <span class="library" title="Print a string to standard output">print</span> <span class="fstring">", "</span>;  <span class="small_keyword" title="end of body">done</span>;
<span class="lineno" id=line13></span>      ++ii;
<span class="lineno" id=line14></span>    <span class="small_keyword" title="end of body">done</span>;
<span class="lineno" id=line15></span>    <span class="library" title="Print a string to standard output with newline appended">println</span> <span class="fstring">""</span>;
<span class="lineno" id=line16></span>    <span class="small_keyword" title="return">return</span> 0;
<span class="lineno" id=line17></span>  }
<span class="lineno" id=line18></span>  
<span class="lineno" id=line19></span>  <span class="big_keyword" title="Define a procedure, a function with side-effects not returning a value">proc</span> run(db:sqlite3_db_t) {
<span class="lineno" id=line20></span>    sql :=
<span class="lineno" id=line21></span>      <span class="fstring">"drop table if exists fred;"</span>,
<span class="lineno" id=line22></span>      <span class="fstring">"create table fred (name, address);"</span>,
<span class="lineno" id=line23></span>      <span class="fstring">"insert into fred values('joe','wigram');"</span>,
<span class="lineno" id=line24></span>      <span class="fstring">"insert into fred values('max','gpr');"</span>,
<span class="lineno" id=line25></span>      <span class="fstring">"insert into fred values('lee','wax');"</span>,
<span class="lineno" id=line26></span>      <span class="fstring">"insert into fred values('henry','pollen');"</span>,
<span class="lineno" id=line27></span>      <span class="fstring">"select all name,address from fred;"</span>,
<span class="lineno" id=line28></span>      <span class="fstring">""</span>
<span class="lineno" id=line29></span>    ;
<span class="lineno" id=line30></span>    <span class="big_keyword" title="Define a mutable variable">var</span> usr: <span class="library" title="special binding of C void* type">address</span> =  <span class="library" title="special binding of C void* type">address</span> c<span class="fstring">"user pointer"</span>;
<span class="lineno" id=line31></span>    <span class="big_keyword" title="Define a mutable variable">var</span> errm: +<span class="library" title="binding of C char type">char</span> =  <span class="hack">C_hack</span>::cast[+<span class="library" title="binding of C char type">char</span>] c<span class="fstring">""</span>; <span class="comment">// cast const ptr to non-const</span>
<span class="lineno" id=line32></span>  
<span class="lineno" id=line33></span>    <span class="big_keyword" title="Define a mutable variable">var</span> i = 0;
<span class="lineno" id=line34></span>    <span class="big_keyword" title="Define a mutable variable">var</span> p = sql.i;
<span class="lineno" id=line35></span>    <span class="small_keyword" title="while loop">while</span> p != <span class="fstring">""</span> <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line36></span>      <span class="library" title="Print a string to standard output with newline appended">println</span> p;
<span class="lineno" id=line37></span>      <span class="big_keyword" title="Define an immutable value">val</span> cb : sqlite3_exec_callback_t = eh;
<span class="lineno" id=line38></span>      res := sqlite3_exec(db,p,cb,usr,&amp;errm);
<span class="lineno" id=line39></span>      <span class="small_keyword" title="conditional">if</span> res !=0 <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line40></span>        <span class="library" title="Print a string to standard output with newline appended">println</span>$ <span class="fstring">"exec DB error[abort]: "</span> + errm;
<span class="lineno" id=line41></span>        <span class="small_keyword" title="return">return</span>;
<span class="lineno" id=line42></span>      <span class="small_keyword" title="end of body">done</span>;
<span class="lineno" id=line43></span>      ++i;
<span class="lineno" id=line44></span>      p = sql.i;
<span class="lineno" id=line45></span>    <span class="small_keyword" title="end of body">done</span>;
<span class="lineno" id=line46></span>  }
<span class="lineno" id=line47></span>  
<span class="lineno" id=line48></span>  <span class="library" title="Print a string to standard output with newline appended">println</span> <span class="fstring">"Hello"</span>;
<span class="lineno" id=line49></span>  <span class="big_keyword" title="Define a mutable variable">var</span> db : sqlite3_db_t;
<span class="lineno" id=line50></span>  err := sqlite3_open(<span class="fstring">"mydb.db"</span>, &amp;db);
<span class="lineno" id=line51></span>  <span class="small_keyword" title="conditional">if</span> err != 0 <span class="small_keyword" title="imperative code begins">do</span>
<span class="lineno" id=line52></span>    <span class="library" title="Print a string to standard output">print</span> <span class="fstring">"open DB error[abort] "</span>;
<span class="lineno" id=line53></span>    <span class="library" title="Print a string to standard output with newline appended">println</span> $ sqlite3_errmsg db;
<span class="lineno" id=line54></span>    <span class="small_keyword" title="jump to label">goto</span> finish;
<span class="lineno" id=line55></span>  <span class="small_keyword" title="end of body">done</span>;
<span class="lineno" id=line56></span>  
<span class="lineno" id=line57></span>  run(db);
<span class="lineno" id=line58></span>  
<span class="lineno" id=line59></span>  finish:&gt;
<span class="lineno" id=line60></span>    sqlite3_close(db);
</pre></p><pre class='inclusion'>
$PWD/src/test/regress/rt/sqlite_01.expect</pre>
<p><pre class="prefmtbg">Hello
drop table if exists fred;
create table fred (name, address);
insert into fred values('joe','wigram');
insert into fred values('max','gpr');
insert into fred values('lee','wax');
insert into fred values('henry','pollen');
select all name,address from fred;
name=joe, address=wigram
name=max, address=gpr
name=lee, address=wax
name=henry, address=pollen
</pre></p></div><h1 id='Config_Data_h'><img src='/share/src/web/images/minus.gif' id='Config Data' onclick='toggle(this,"Config_Data_d")' alt='+'/> 3.4 Config Data</h1><div id='Config_Data_d' style='display:block'>
<pre class='inclusion'>
$PWD/src/config/unix/sqlite3.fpc</pre>
<p><pre class="prefmtbg">provides_dlib: -lflx_sqlite3_dynamic
provides_slib: -lflx_sqlite3_static
includes: '"flx_sqlite3.hpp"'
macros: BUILD_SQLITE3
build_includes: build/release/share/lib/rtl
library: flx_sqlite3
srcdir: src/sqlite3
src: sqlite3\.c
</pre></p><pre class='inclusion'>
$PWD/src/config/win/sqlite3.fpc</pre>
<p><pre class="prefmtbg">provides_dlib: /DEFAULTLIB:flx_sqlite3_dynamic
provides_slib: /DEFAULTLIB:flx_sqlite3_static
includes: "&lt;flx_sqlite3.hpp&gt;"
macros: BUILD_SQLITE3
build_includes: build/release/share/lib/rtl
library: flx_sqlite3
srcdir: src/sqlite3
src: sqlite3\.c
</pre></p><pre class='inclusion'>
share/lib/rtl/flx_sqlite3_config.hpp</pre>
<p><pre class='cppbg'>#<span class="preproc">ifndef</span> __FLX_SQLITE3_CONFIG_H__
#<span class="preproc">define</span> __FLX_SQLITE3_CONFIG_H__
#<span class="preproc">include</span> <span class="fstring">"flx_rtl_config.hpp"</span>
#<span class="preproc">ifdef</span> BUILD_SQLITE3
#<span class="preproc">define</span> SQLITE3_EXTERN FLX_EXPORT
#<span class="preproc">else</span>
#<span class="preproc">define</span> SQLITE3_EXTERN FLX_IMPORT
#<span class="preproc">endif</span>
#<span class="preproc">endif</span>
#<span class="preproc">define</span> SQLITE_API SQLITE3_EXTERN
</pre></p><pre class='inclusion'>
share/lib/rtl/flx_sqlite3.hpp</pre>
<p><pre class='cppbg'>#<span class="preproc">ifndef</span> _FLX_SQLITE3_HPP
#<span class="preproc">define</span> _FLX_SQLITE3_HPP
#<span class="preproc">include</span> <span class="fstring">"flx_sqlite3_config.hpp"</span>
#<span class="preproc">include</span> <span class="fstring">"sqlite3/sqlite3.h"</span>
#<span class="preproc">endif</span>
</pre></p></div><!--Main Content Body End-->

          </div> <!-- rightpanel contents end -->
          <hr>
        </span> <!-- rightpanel end -->

        <span id="panemover" style="cursor:col-resize;"
         onmousedown="dragStart(event, 'left', 'right'); return false;"
         onmousemove="drag(event, 'left', 'right');"
         onmouseout="dragRelease();"
         onmouseup="dragRelease();"
        >
        </span> <!-- panemover end -->
      </div> <!-- bottom panel end -->
    </div> <!-- container end -->
</body></html>

