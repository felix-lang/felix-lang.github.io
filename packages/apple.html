<html><head>
<style type="text/css">
body {margin:3%; }
h1 {color:gray; font-size:120%;}
h2 {color:gray; font-size:105%;}
h3 {font-size:100%;}
h4 {font-size:95%;}
h5 {font-size:95%;}
span.fstring {color:darkblue; font-style:italic; }
span.comment {font-family:arial; color:blue; font-style:italic; }
span.doccomment {font-family:arial; color:green; font-style:italic; }
span.big_keyword {color:#FF1010; }
span.small_keyword {color:#802040; }
span.qualifier {color:#A02020; }
span.library {color:#A02000; }
span.ctor {color:#406020; }
span.hack {color:#66DD00; }
span.preproc {color:#005500; }
span.embedded_c{background-color:#DDDDDD; }
span.fpc_fieldname {color:#DD0000; }
span.lineno {color:#101010; background-color:#E0E0E0; font-size:80%; font-family:"courier",monospace; font-style:normal; }
pre.flxbg {background-color:#A0FFA0; color:black; padding:2px; box-shadow:5px 5px 2px #807080; }
pre.uncheckedflxbg {background-color:#D0D0D0; color:black; padding:2px; box-shadow:5px 5px 2px #807080; }
pre.cppbg {background-color:#80FF80; color:black; }
pre.prefmtbg {background-color:#D0D0D0; color:black; }
pre.expected {background-color:#E0FF80; color:black; }
pre.input {background-color:#E08080; color:black; }
pre.inclusion {background-color:#D070D0; color:black; }
code.inclusion {background-color:#D070D0; color:black; }
.obsolete { background-color:#FFEFEF; font-size: small; color:black; }
.future { background-color:#FF8080; font-size: small; color:black; }
.implementation_detail { background-color:#E0E0E0; font-size: small; color:black;  }
.bug { background-color:#FFE0E0; font-size: small; color:black; }
.fixed{ background-color:#FFE0E0; font-size: small; color:black; }
.done { background-color:#FFE0E0; font-size: small; color:black; }
.caveat { background-color:#FF8080; color:black; }
</style>
<title>Apple Specific Config</title></head><body>
<style>
body {margin:3%; font-family: sans-serif; }
h1 {color:black; font-size:120%; border-bottom: 2px solid #ddd; padding: 0 0 3px 0;}
h2 {color:#202020; font-size:105%;}
h3 {font-size:100%;}
h4 {font-size:95%;}
h5 {font-size:95%;}
span.fstring {color:darkblue; font-style:italic; }
span.comment {font-family:arial; color:blue; font-style:italic; }
span.doccomment {font-family:arial; color:green; font-style:italic; }
span.big_keyword {color:#FF1010; }
span.small_keyword {color:#802040; }
span.qualifier {color:#A02020; }
span.library {color:#A02000; }
span.ctor {color:#406020; }
span.hack {color:#66DD00; }
span.preproc {color:#005500; }
span.embedded_c{background-color:#DDDDDD; }
span.fpc_fieldname {color:#DD0000; }
span.lineno {color:#101010; background-color:#E0E0E0; font-size:80%; font-family:"courier",monospace; font-style:normal; }
pre { border: 1px solid #ccc; color: black; box-shadow:3px 3px 2px rgba(0,0,0,0.1); padding:2px; }
pre.flxbg {background-color:#C2FDC2; box-shadow:3px 3px 2px rgba(0,0,0,0.1) }
pre.uncheckedflxbg {background-color:#eee; box-shadow:3px 3px 2px rgba(0,0,0,0.1); }
pre.cppbg {background-color:#C2FDC2; }
pre.prefmtbg {background-color:#F1F1F1; }
pre.expected {background-color:hsla(74,94%,88%,1); }
pre.input {background-color:hsla(20,94%,88%,1); }
pre.inclusion {
    font-family: Arial;
    font-weight: normal;
    font-size: 0.9em;
    color: #555;
    border: none;
    box-shadow: none;
    text-align: right;
    margin: -7px 11px -12px 0;
    padding: 0;
    background-color:#fafafa;
}
code.inclusion {background-color:#D070D0; color:black; }
.obsolete { background-color:#FFEFEF; font-size: small; color:black; }
.future { background-color:#FF8080; font-size: small; color:black; }
.implementation_detail { background-color:#E0E0E0; font-size: small; color:black;  }
.bug { background-color:#FFE0E0; font-size: small; color:black; }
.fixed{ background-color:#FFE0E0; font-size: small; color:black; }
.done { background-color:#FFE0E0; font-size: small; color:black; }
.caveat { background-color:hsla(0,100%,91%,1); color:black; padding: 0.6em; }
.container {
  position: fixed;
  top:0px;
  left:0px;
  height : 100%;
  width: 100%;
  background-color: grey;
  margin: 0px;
  padding: 0px;
  border-width: 0px;
  color: #404040;
}
.maincontent {
  padding:4px;
  padding-left:8px;
  line-height:1.3em;
  color:#404040; background-color:#fafafa;
}
.maincontent h1 { margin-left:-8px; position: relative; font-family: georgia, serif; font-size: 1.8em; font-weight: normal; }
.maincontent h2 { margin-left:-8px; position: relative; margin-bottom:-5px; }
.maincontent h3 { margin-left:-8px; position: relative; margin-bottom:-5px; }
.maincontent h4 { margin-left:-8px; position: relative; margin-bottom:-5px; }
.maincontent code { color:#902030; }
.toppanel {
  position:absolute; left:0px; top:0px; height:20px; right:0px;
  background-color: #e0e0e0;
}
.bottompanel {
  position:absolute; left:0px; top:22px; bottom:0px; right:0px;
  background-color: #fafafa;
  font-size:14px;
}
.leftpanel {
  position:absolute; left:0px; top:0px; bottom:0px; width: 150px;
  background-color: #eaeaea; overflow: auto;
}
.rightpanel {
  position:absolute; right: 0px; left:160px; top:0px; bottom: 0px;
  background-color: #fafafa; overflow: auto;
}
.divider {
  position:absolute; left: 150px; top:0px; bottom:0px;
  background-color: black; width:2px;
  box-shadow: 0 0 8px #000;
}

#panemover {
    position:absolute;
    left: 150px;
    width : 10px;
    top: 0px;
    bottom: 0px;
    opacity: 0.3;
    cursor:col-resize;
}

div.m {
    margin: 0px;
    padding:0px;
    border-width:2px;
    border-color: green;
}

div.m1 {
    background-color: #86E870;
    border-style:outset;
    border-color:#ccc;
    border-width:2px 0;
    font-size:90%;
    padding: 1px 0 2px 10px;
}

div.m2 {
    background-color: #70C070;
    padding-left:15px;
    padding-top:2px;
    border-style:outset;
    border-color:green;
    border-width:0 0 1px 0;
    font-size:80%;
}

div.m1:hover, div.m2:hover {
    background-color: white;
}

#leftmargintoc a {
    text-decoration: none;
    color: #404040;
}
</style>

<style>
div.m {
    margin: 0px;
    padding:0px;
    border-width:2px;
    border-color: green;
}

div.m1 {
    background-color: #86E870;
    border-style:outset;
    border-color:#ccc;
    border-width:2px 0;
    font-size:90%;
    padding: 1px 0 2px 10px;
}

div.m2 {
    background-color: #70C070;
    padding-left:15px;
    padding-top:2px;
    border-style:outset;
    border-color:green;
    border-width:0 0 1px 0;
    font-size:80%;
}

div.m1:hover, div.m2:hover {
    background-color: white;
}

#leftmargintoc a {
    text-decoration: none;
    color: #404040;
}


</style>

    <script async="true">
      function dragStart(e, left, right){
        document.getElementById("panemover").style.width="70%";
        document.getElementById("panemover").style.left="50px";
        mousedown = true;
        x = e.clientX
        dragOffsetLeft =
          document.getElementById(left).getBoundingClientRect().right -
          document.getElementById(left).getBoundingClientRect().left -
          x
        ;
        dragOffsetDivider= document.getElementById("divider").getBoundingClientRect().left - x;
        dragOffsetRight = document.getElementById(right).getBoundingClientRect().left - x;
      }
      function dragRelease(){
        document.getElementById('panemover').style.width = '10px';
        document.getElementById('panemover').style.left = document.getElementById('divider').offsetLeft + 'px';
        mousedown = false;
      }
      function drag(e, left, right){
        if(!mousedown){return}
        x = e.clientX
        tmpLeft = dragOffsetLeft + x
        tmpDivider= dragOffsetDivider + x
        tmpRight = dragOffsetRight + x
        document.getElementById(left).style.width= tmpLeft + 'px';
        document.getElementById("divider").style.left= tmpDivider + 'px';
        document.getElementById(right).style.left = tmpRight + 'px';
      };
    </script>

<script type="text/javascript">

  function mexpand(id)
  {
    var n = document.getElementById(id).style;
    n.display = "block";
  }

  function mcollapse(id)
  {
    var n = document.getElementById(id).style;
    n.display = "none";
  }

  var counter_max = 0;
  function mshow(id,loc)
  {
    var i;
    for(i=1; i<=counter_max; ++i)
      mcollapse("menu"+String(i));
    mexpand(id);
    window.location.replace(loc);
  }
</script>

<script type="text/javascript">

function expand(but,id)
{
  var n = document.getElementById(id).style;
  var button = document.getElementById(but);
  button.src = "/share/src/web/images/minus.gif";
  button.alt = "-";
  n.display = "block";
}
function collapse(but,id)
{
  var n = document.getElementById(id).style;
  var button = document.getElementById(but);
  button.src = "/share/src/web/images/plus.gif";
  button.alt = "+";
  n.display = "none";
}
function toggle(button,id)
{
  var n = document.getElementById(id).style;
  if (n.display == "none")
  {
    button.src = "/share/src/web/images/minus.gif";
    button.alt = "-";
    n.display = "block";
  }
  else
  {
    button.src = "/share/src/web/images/plus.gif";
    button.alt = "+";
    n.display = "none";
  }
}
var allbuttons = [
"Apple Frameworks"
];
function expand_all(dummy)
{
  for (i in allbuttons)
  {
    expand(allbuttons[i], allbuttons[i]+"_d");
  }
}
function collapse_all(dummy)
{
  for (i in allbuttons)
  {
    collapse(allbuttons[i], allbuttons[i]+"_d");
  }
}
</script>

<script>
function mouseover(id)
{
  var elt = document.getElementById(id);
  elt.style.display="none";
  var elt2 = document.getElementById(id+"_mo");
  elt2.style.display="inline";
}

function mouseout(id)
{
  var elt = document.getElementById(id+"_mo");
  elt.style.display="none";
  var elt2 = document.getElementById(id);
  elt2.style.display="inline";
}

</script>
<script> function nop(dummy) {} </script>
    <div class="container">
      <div class="toppanel">
    <!--Main Content top navbar-->
<span style="position:relative; bottom:6px"
  onmouseover="mouseover('expand')"
  onmouseout="mouseout('expand')"
  onclick="expand_all('expand')"
  ><span id="expand"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:blue;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Expand</text></svg></span><span id="expand_mo" style="display:none"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:red;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Expand</text></svg></span></span><span style="position:relative; bottom:6px"
  onmouseover="mouseover('collapse')"
  onmouseout="mouseout('collapse')"
  onclick="collapse_all('collapse')"
  ><span id="collapse"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:blue;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Collapse</text></svg></span><span id="collapse_mo" style="display:none"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:red;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Collapse</text></svg></span></span>    <!--Main Content top navbar End-->

      </div> <!-- toppanel end -->
      <div class="bottompanel">
        <span id="divider" class="divider"></span>

        <span id="left" class="leftpanel" >
          <div class="menucontent">
  <!--Left Margin Toc-->
  <div id="leftmargintoc">
    <!--Left Margin Toc Main Contents-->
      <div class=m1 onclick="mshow('menu1','#Apple Frameworks_h')"> <a href="#Apple_Frameworks_h">Apple Frameworks</a></div>
      <div class=sm id=menu1>
      </div>
    <script>counter_max=1;</script>
  </div>
  <!--End Left Margin Toc-->

          </div> <!-- leftpanel contents end -->
        </span> <!-- leftpanel end -->

        <span id="right" class="rightpanel">
          <div class="maincontent">
<!--Main Content Body-->
<h1 id='Apple_Frameworks_h'><img src='/share/src/web/images/minus.gif' id='Apple Frameworks' onclick='toggle(this,"Apple_Frameworks_d")' alt='+'/> 1 Apple Frameworks</h1><div id='Apple_Frameworks_d' style='display:block'>
<pre class='inclusion'>
share/lib/std/apple/Foundation.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Open a module or class">open</span> <span class="big_keyword" title="Define a type class">class</span> Foundation
<span class="lineno" id=line2></span>  {
<span class="lineno" id=line3></span>    <span class="big_keyword" title="specify requirements">requires</span> 
<span class="lineno" id=line4></span>      <span class="small_keyword" title="specifies an abstract package name">package</span> <span class="fstring">"objc"</span>,
<span class="lineno" id=line5></span>      <span class="small_keyword" title="specifies an abstract package name">package</span> <span class="fstring">"foundation"</span>
<span class="lineno" id=line6></span>    ;
<span class="lineno" id=line7></span>  
<span class="lineno" id=line8></span>    <span class="comment">// Data types</span>
<span class="lineno" id=line9></span>    <span class="big_keyword" title="Define a primitive type by binding to a C type">type</span> id = <span class="fstring">"id"</span>;
<span class="lineno" id=line10></span>  
<span class="lineno" id=line11></span>    <span class="big_keyword" title="Define a primitive type by binding to a C type">type</span> NSObject = <span class="fstring">"NSObject*"</span>;
<span class="lineno" id=line12></span>    supertype id : NSObject = <span class="fstring">"$1"</span>;
<span class="lineno" id=line13></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> description : NSObject -&gt; NSString = <span class="fstring">"[$1 description]"</span>;
<span class="lineno" id=line14></span>  
<span class="lineno" id=line15></span>    <span class="big_keyword" title="Define a primitive type by binding to a C type">type</span> NSString = <span class="fstring">"NSString*"</span>;
<span class="lineno" id=line16></span>    supertype NSObject : NSString = <span class="fstring">"$1"</span>;
<span class="lineno" id=line17></span>    <span class="big_keyword" title="Provide an instance of a typeclass">instance</span> Str[NSString] {
<span class="lineno" id=line18></span>      <span class="big_keyword" title="Define a function with no side-effects">fun</span> <span class="library" title="Convert a value to a string">str</span> : NSString -&gt; <span class="library" title="binding of C++ string type">string</span> = <span class="fstring">"::std::string([$1 cStringUsingEncoding:NSUTF8StringEncoding])"</span>;
<span class="lineno" id=line19></span>    }
<span class="lineno" id=line20></span>  
<span class="lineno" id=line21></span>    <span class="big_keyword" title="Define a primitive type by binding to a C type">type</span> NSNumber = <span class="fstring">"NSNumber*"</span>;;
<span class="lineno" id=line22></span>    supertype NSObject : NSNumber = <span class="fstring">"$1"</span>;
<span class="lineno" id=line23></span>  
<span class="lineno" id=line24></span>  
<span class="lineno" id=line25></span>    <span class="big_keyword" title="Define a primitive type by binding to a C type">type</span> NSArray = <span class="fstring">"NSArray*"</span>;
<span class="lineno" id=line26></span>    supertype NSObject : NSArray = <span class="fstring">"$1"</span>;
<span class="lineno" id=line27></span>    <span class="big_keyword" title="Define a value constructor or conversion operator for a type">ctor</span>[N:UNITSUM] NSArray : NSObject^N = <span class="fstring">"[NSArray arrayWithObjects:$a,nil]"</span>;
<span class="lineno" id=line28></span>  
<span class="lineno" id=line29></span>    <span class="comment">// Selector</span>
<span class="lineno" id=line30></span>    <span class="big_keyword" title="Define a primitive type by binding to a C type">type</span> SEL = <span class="fstring">"SEL"</span>;
<span class="lineno" id=line31></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> sel_getName : SEL  -&gt; +<span class="library" title="binding of C char type">char</span> = <span class="fstring">"sel_getName($1)"</span>;
<span class="lineno" id=line32></span>  
<span class="lineno" id=line33></span>    <span class="big_keyword" title="Provide an instance of a typeclass">instance</span> Str[SEL] {
<span class="lineno" id=line34></span>      <span class="big_keyword" title="Define a function with no side-effects">fun</span> <span class="library" title="Convert a value to a string">str</span> (sel: SEL) : <span class="library" title="binding of C++ string type">string</span>  =&gt; <span class="library" title="binding of C++ string type">string</span> (sel_getName sel);
<span class="lineno" id=line35></span>    } 
<span class="lineno" id=line36></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> selector : <span class="library" title="binding of C++ string type">string</span> -&gt; SEL = <span class="fstring">'@@selector($i)'</span>;
<span class="lineno" id=line37></span>   
<span class="lineno" id=line38></span>    <span class="comment">// Debug output</span>
<span class="lineno" id=line39></span>    <span class="big_keyword" title="Define a procedure, a function with side-effects not returning a value">proc</span> NSLog : NSString * ... = <span class="fstring">'NSLog($a);'</span>;
<span class="lineno" id=line40></span>    <span class="big_keyword" title="Define a procedure, a function with side-effects not returning a value">proc</span> NSLog[T] : T = <span class="fstring">'NSLog(@@"%@@",$1);'</span>;
<span class="lineno" id=line41></span>  }
</pre></p><pre class='inclusion'>
share/lib/std/apple/AppleOS.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Open a module or class">open</span> <span class="big_keyword" title="Define a type class">class</span> AppleOS {
<span class="lineno" id=line2></span>    <span class="big_keyword" title="Define a primitive type by binding to a C type">type</span> OSStatus= <span class="fstring">"OSStatus"</span>;
<span class="lineno" id=line3></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> noErr: OSStatus = <span class="fstring">"noErr"</span>;
<span class="lineno" id=line4></span>    <span class="big_keyword" title="Define an alias for a type expression">typedef</span> OSType = <span class="library" title="binding of C unsigned int type">uint</span>;
<span class="lineno" id=line5></span>    <span class="big_keyword" title="Provide an instance of a typeclass">instance</span> Eq[OSStatus] { 
<span class="lineno" id=line6></span>      <span class="big_keyword" title="Define a function with no side-effects">fun</span> == : OSStatus * OSStatus -&gt; bool = <span class="fstring">"$1==$2"</span>;
<span class="lineno" id=line7></span>    }
<span class="lineno" id=line8></span>  }
</pre></p><pre class='inclusion'>
share/lib/std/apple/AudioUnit.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/apple/AppleOS"</span>;
<span class="lineno" id=line2></span>  <span class="big_keyword" title="Open a module or class">open</span> <span class="big_keyword" title="Define a type class">class</span> AudioUnitAPI {
<span class="lineno" id=line3></span>    <span class="big_keyword" title="specify requirements">requires</span> <span class="small_keyword" title="specifies an abstract package name">package</span> <span class="fstring">"audiounit"</span>;
<span class="lineno" id=line4></span>  
<span class="lineno" id=line5></span>    <span class="comment">// We're not using this here so I'll just provide a binding with no access methods</span>
<span class="lineno" id=line6></span>    <span class="big_keyword" title="Define a primitive type by binding to a C type">type</span> AudioTimeStamp = <span class="fstring">"AudioTimeStamp"</span>;
<span class="lineno" id=line7></span>  
<span class="lineno" id=line8></span>    <span class="comment">// binds to C type of same name, defines</span>
<span class="lineno" id=line9></span>    <span class="comment">// the enumeration constants,</span>
<span class="lineno" id=line10></span>    <span class="comment">// and provides equality (needed for pattern matches)</span>
<span class="lineno" id=line11></span>    <span class="comment">// and also all standard C bitwise operations</span>
<span class="lineno" id=line12></span>    <span class="big_keyword" title="Lift an enumeration of flags from C">cflags</span> AudioUnitRenderActionFlags = 
<span class="lineno" id=line13></span>      kAudioUnitRenderAction_PreRender,
<span class="lineno" id=line14></span>      kAudioUnitRenderAction_PostRender,
<span class="lineno" id=line15></span>      kAudioUnitRenderAction_OutputIsSilence,
<span class="lineno" id=line16></span>      kAudioOfflineUnitRenderAction_Preflight,
<span class="lineno" id=line17></span>      kAudioOfflineUnitRenderAction_Render,
<span class="lineno" id=line18></span>      kAudioOfflineUnitRenderAction_Complete,
<span class="lineno" id=line19></span>      kAudioUnitRenderAction_PostRenderError,
<span class="lineno" id=line20></span>      kAudioUnitRenderAction_DoNotCheckRenderArgs
<span class="lineno" id=line21></span>    ;
<span class="lineno" id=line22></span>     
<span class="lineno" id=line23></span>  
<span class="lineno" id=line24></span>  
<span class="lineno" id=line25></span>    <span class="comment">// Manually define this structure too</span>
<span class="lineno" id=line26></span>    <span class="big_keyword" title="Define a primitive type by binding to a C type">type</span> AudioBuffer = <span class="fstring">"AudioBuffer"</span>;
<span class="lineno" id=line27></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> mDataByteSize : AudioBuffer -&gt; <span class="library" title="binding of C uint32_t type">uint32</span> = <span class="fstring">"$1.mDataByteSize"</span>;
<span class="lineno" id=line28></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> mNumberChannels : AudioBuffer -&gt; <span class="library" title="binding of C uint32_t type">uint32</span> = <span class="fstring">"$1.mNumberChannels"</span>;
<span class="lineno" id=line29></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> mData : AudioBuffer -&gt; <span class="library" title="special binding of C void* type">address</span> = <span class="fstring">"$1.mData"</span>;
<span class="lineno" id=line30></span>    <span class="big_keyword" title="Define a value constructor or conversion operator for a type">ctor</span> AudioBuffer : <span class="library" title="binding of C uint32_t type">uint32</span> * <span class="library" title="binding of C uint32_t type">uint32</span> * <span class="library" title="special binding of C void* type">address</span> = <span class="fstring">"AudioBuffer {.mDataByteSize=$1, .mNumberChannels=$2, .mData=$3}"</span>;
<span class="lineno" id=line31></span>  
<span class="lineno" id=line32></span>    <span class="comment">// Manually define this structure too</span>
<span class="lineno" id=line33></span>    <span class="big_keyword" title="Define a primitive type by binding to a C type">type</span> _AudioBufferList = <span class="fstring">"AudioBufferList"</span>;
<span class="lineno" id=line34></span>    <span class="big_keyword" title="Define an alias for a type expression">typedef</span> AudioBufferList = &amp;_AudioBufferList;
<span class="lineno" id=line35></span>  
<span class="lineno" id=line36></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> mNumberBuffers: AudioBufferList -&gt; <span class="library" title="binding of C uint32_t type">uint32</span> = <span class="fstring">"$1-&gt;mNumberBuffers"</span>;
<span class="lineno" id=line37></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> mBuffers: AudioBufferList -&gt; +AudioBuffer = <span class="fstring">"$1-&gt;mBuffers"</span>;
<span class="lineno" id=line38></span>  
<span class="lineno" id=line39></span>    <span class="comment">// This is a serious mess but its the only way</span>
<span class="lineno" id=line40></span>    <span class="comment">// An AudioBufferList object consist of a count followed by an array of </span>
<span class="lineno" id=line41></span>    <span class="comment">// pointers to AudioBuffers, so it must be dynamically allocated,</span>
<span class="lineno" id=line42></span>    <span class="comment">// either with malloc or alloca</span>
<span class="lineno" id=line43></span>    <span class="big_keyword" title="Define a value constructor or conversion operator for a type">ctor</span> AudioBufferList: <span class="library" title="binding of C uint32_t type">uint32</span> * +AudioBuffer = <span class="fstring">"""
<span class="lineno" id=line44></span>       ([=](){
<span class="lineno" id=line45></span>        int n = sizeof(AudioBuffer) + ($1-1)sizeof(void*);
<span class="lineno" id=line46></span>        return (AudioBufferList*)(::std::malloc(n));
<span class="lineno" id=line47></span>       }());
<span class="lineno" id=line48></span>    """</span>;
<span class="lineno" id=line49></span>    <span class="big_keyword" title="Define a procedure, a function with side-effects not returning a value">proc</span> deleteAudioBufferList : AudioBufferList = <span class="fstring">"::std::free($1);"</span>;
<span class="lineno" id=line50></span>    
<span class="lineno" id=line51></span>    <span class="comment">// However in our code we only ever need to construct an AudioBufferList</span>
<span class="lineno" id=line52></span>    <span class="comment">// with a single buffer which does not require a heap allocation</span>
<span class="lineno" id=line53></span>    <span class="comment">// Note the client has to store the result in a variable and take</span>
<span class="lineno" id=line54></span>    <span class="comment">// its address to get a Felix AudioBufferList since that's a pointer</span>
<span class="lineno" id=line55></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> mk_AudioBufferList1: AudioBuffer -&gt; _AudioBufferList = <span class="fstring">"AudioBufferList {.mNumberBuffers=1, .mBuffers = {$1}}"</span>;
<span class="lineno" id=line56></span>    
<span class="lineno" id=line57></span>    <span class="comment">// Some core Audio Unit Description parts</span>
<span class="lineno" id=line58></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioUnitType_Output: OSType;
<span class="lineno" id=line59></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioUnitSubType_HALOutput: OSType;
<span class="lineno" id=line60></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioUnitManufacturer_Apple: OSType;
<span class="lineno" id=line61></span>  
<span class="lineno" id=line62></span>    <span class="comment">// Audio Component Descriptor</span>
<span class="lineno" id=line63></span>    <span class="big_keyword" title="Provide a model for an existing C struct">cstruct</span> AudioComponentDescription {
<span class="lineno" id=line64></span>      componentType: OSType;
<span class="lineno" id=line65></span>      componentSubType: OSType;
<span class="lineno" id=line66></span>      componentManufacturer: OSType;
<span class="lineno" id=line67></span>      componentFlags: <span class="library" title="binding of C uint32_t type">uint32</span>;
<span class="lineno" id=line68></span>      componentFlagsMask: <span class="library" title="binding of C uint32_t type">uint32</span>;
<span class="lineno" id=line69></span>    };
<span class="lineno" id=line70></span>  
<span class="lineno" id=line71></span>    <span class="comment">// Audio Component Locators</span>
<span class="lineno" id=line72></span>    <span class="big_keyword" title="Define a set of primitive type by binding to C types with the same name">ctypes</span> AudioComponent;
<span class="lineno" id=line73></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> AudioComponentFindNext : AudioComponent * &amp;AudioComponentDescription -&gt; AudioComponent;
<span class="lineno" id=line74></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> AudioComponentFindFirst: &amp;AudioComponentDescription -&gt; AudioComponent =
<span class="lineno" id=line75></span>      <span class="fstring">"AudioComponentFindNext(NULL,$1)"</span>
<span class="lineno" id=line76></span>    ;
<span class="lineno" id=line77></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> isValid: AudioComponent -&gt; bool = <span class="fstring">"!($1==NULL)"</span>;
<span class="lineno" id=line78></span>  
<span class="lineno" id=line79></span>    <span class="big_keyword" title="Define a set of primitive type by binding to C types with the same name">ctypes</span> AudioComponentInstance;
<span class="lineno" id=line80></span>    <span class="big_keyword" title="Define an alias for a type expression">typedef</span> AudioUnit = AudioComponentInstance;
<span class="lineno" id=line81></span>  
<span class="lineno" id=line82></span>    <span class="comment">// Property IDs</span>
<span class="lineno" id=line83></span>    <span class="big_keyword" title="Define an alias for a type expression">typedef</span> AudioUnitPropertyID = <span class="library" title="binding of C uint32_t type">uint32</span>;
<span class="lineno" id=line84></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioUnitProperty_SetRenderCallback : AudioUnitPropertyID;
<span class="lineno" id=line85></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioOutputUnitProperty_SetInputCallback : AudioUnitPropertyID;
<span class="lineno" id=line86></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioOutputUnitProperty_EnableIO : AudioUnitPropertyID;
<span class="lineno" id=line87></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioUnitProperty_StreamFormat: AudioUnitPropertyID;
<span class="lineno" id=line88></span>  
<span class="lineno" id=line89></span>    <span class="comment">// Scopes</span>
<span class="lineno" id=line90></span>    <span class="big_keyword" title="Define an alias for a type expression">typedef</span> AudioUnitScope = <span class="library" title="binding of C uint32_t type">uint32</span>;
<span class="lineno" id=line91></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioUnitScope_Input : AudioUnitScope;
<span class="lineno" id=line92></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioUnitScope_Output : AudioUnitScope;
<span class="lineno" id=line93></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioUnitScope_Global : AudioUnitScope;
<span class="lineno" id=line94></span>  
<span class="lineno" id=line95></span>    <span class="comment">// Elements</span>
<span class="lineno" id=line96></span>    <span class="big_keyword" title="Define an alias for a type expression">typedef</span> AudioUnitElement = <span class="library" title="binding of C uint32_t type">uint32</span>;
<span class="lineno" id=line97></span>    <span class="big_keyword" title="Define an immutable value">val</span> GlobalElement = 0;
<span class="lineno" id=line98></span>  
<span class="lineno" id=line99></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> AudioUnitSetProperty:
<span class="lineno" id=line100></span>      AudioUnit * 
<span class="lineno" id=line101></span>      AudioUnitPropertyID *
<span class="lineno" id=line102></span>      AudioUnitScope * 
<span class="lineno" id=line103></span>      AudioUnitElement *
<span class="lineno" id=line104></span>      <span class="library" title="special binding of C void* type">address</span> * <span class="library" title="binding of C uint32_t type">uint32</span> <span class="comment">// property data</span>
<span class="lineno" id=line105></span>      -&gt; OSStatus
<span class="lineno" id=line106></span>    ;
<span class="lineno" id=line107></span>  
<span class="lineno" id=line108></span>    <span class="big_keyword" title="Define an alias for a type expression">typedef</span> AudioFormatFlags = <span class="library" title="binding of C uint32_t type">uint32</span>;
<span class="lineno" id=line109></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatFlagIsFloat : AudioFormatFlags;
<span class="lineno" id=line110></span>  
<span class="lineno" id=line111></span>    <span class="big_keyword" title="Define an alias for a type expression">typedef</span> AudioFormatID = <span class="library" title="binding of C uint32_t type">uint32</span>;
<span class="lineno" id=line112></span>  
<span class="lineno" id=line113></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatLinearPCM : AudioFormatID;
<span class="lineno" id=line114></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatAC3 : AudioFormatID;
<span class="lineno" id=line115></span>      <span class="comment">//A key that specifies an AC-3 codec. Uses no flags.</span>
<span class="lineno" id=line116></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormat60958AC3 : AudioFormatID;
<span class="lineno" id=line117></span>      <span class="comment">//A key that specifies an AC-3 codec that provides data packaged for transport over an IEC 60958 compliant digital audio interface. Uses the standard format flags in AudioStreamBasicDescription Flags.</span>
<span class="lineno" id=line118></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatAppleIMA4 : AudioFormatID;
<span class="lineno" id=line119></span>      <span class="comment">//A key that specifies Apple’s implementation of the IMA 4:1 ADPCM codec. Uses no flags.</span>
<span class="lineno" id=line120></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatMPEG4AAC : AudioFormatID;
<span class="lineno" id=line121></span>      <span class="comment">//A key that specifies an MPEG-4 AAC codec. The flags field contains the MPEG-4 audio object type constant listed in MPEG-4 Audio Object Type Constants indicating the specific kind of data.</span>
<span class="lineno" id=line122></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatMPEG4CELP : AudioFormatID;
<span class="lineno" id=line123></span>      <span class="comment">//A key that specifies an MPEG-4 CELP codec. The flags field contains the MPEG-4 audio object type constant listed in MPEG-4 Audio Object Type Constants indicating the specific kind of data.</span>
<span class="lineno" id=line124></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatMPEG4HVXC : AudioFormatID;
<span class="lineno" id=line125></span>      <span class="comment">//A key that specifies an MPEG-4 HVXC codec. The flags field contains the MPEG-4 audio object type constant listed in MPEG-4 Audio Object Type Constants indicating the specific kind of data.</span>
<span class="lineno" id=line126></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatMPEG4TwinVQ : AudioFormatID;
<span class="lineno" id=line127></span>      <span class="comment">//A key that specifies an MPEG-4 TwinVQ codec. The flags field contains the MPEG-4 audio object type constant listed in MPEG-4 Audio Object Type Constants indicating the specific kind of data.</span>
<span class="lineno" id=line128></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatMACE3 : AudioFormatID;
<span class="lineno" id=line129></span>      <span class="comment">//MACE 3:1. Uses no flags.</span>
<span class="lineno" id=line130></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatMACE6 : AudioFormatID;
<span class="lineno" id=line131></span>      <span class="comment">//MACE 6:1. Uses no flags.</span>
<span class="lineno" id=line132></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatULaw : AudioFormatID;
<span class="lineno" id=line133></span>      <span class="comment">//μLaw 2:1. Uses no flags.</span>
<span class="lineno" id=line134></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatALaw : AudioFormatID;
<span class="lineno" id=line135></span>      <span class="comment">//aLaw 2:1. Uses no flags.</span>
<span class="lineno" id=line136></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatQDesign : AudioFormatID;
<span class="lineno" id=line137></span>      <span class="comment">//QDesign music. Uses no flags</span>
<span class="lineno" id=line138></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatQDesign2 : AudioFormatID;
<span class="lineno" id=line139></span>      <span class="comment">//QDesign2 music. Uses no flags</span>
<span class="lineno" id=line140></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatQUALCOMM : AudioFormatID;
<span class="lineno" id=line141></span>      <span class="comment">//QUALCOMM PureVoice. Uses no flags</span>
<span class="lineno" id=line142></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatMPEGLayer1 : AudioFormatID;
<span class="lineno" id=line143></span>      <span class="comment">//MPEG-1/2, Layer 1 audio. Uses no flags</span>
<span class="lineno" id=line144></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatMPEGLayer2 : AudioFormatID;
<span class="lineno" id=line145></span>      <span class="comment">//MPEG-1/2, Layer 2 audio. Uses no flags</span>
<span class="lineno" id=line146></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatMPEGLayer3 : AudioFormatID;
<span class="lineno" id=line147></span>      <span class="comment">//MPEG-1/2, Layer 3 audio. Uses no flags</span>
<span class="lineno" id=line148></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatTimeCode : AudioFormatID;
<span class="lineno" id=line149></span>      <span class="comment">//A stream of IOAudioTimeStamp structures. Uses the IOAudioTimeStamp flags (see Audio Time Stamp Flags and Audio Time Stamp Flag Combination Constant).</span>
<span class="lineno" id=line150></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatMIDIStream : AudioFormatID;
<span class="lineno" id=line151></span>      <span class="comment">//A stream of MIDIPacketList structures where the time stamps in the MIDIPacket structures are sample offsets in the stream. The mSampleRate field in the AudioStreamBasicDescription structure is used to describe how time is passed in this kind of stream and an audio unit that receives or generates this stream can use this sample rate together with the number of frames it is rendering and the sample offsets within the MIDIPacketList to define the time for any MIDI event within this list. Uses no flags.</span>
<span class="lineno" id=line152></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatParameterValueStream : AudioFormatID;
<span class="lineno" id=line153></span>      <span class="comment">//A "side-chain" of Float32 data that can be fed or generated by an audio unit and that is used to send a high density of parameter value control information. An audio unit typically runs a parameter value stream at either the sample rate of the audio unit’s audio data, or some integer quotient of this (say a half or a third of the sample rate of the audio). The mSampleRate field in the AudioStreamBasicDescription structure describes this relationship. Uses no flags.</span>
<span class="lineno" id=line154></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatAppleLossless : AudioFormatID;
<span class="lineno" id=line155></span>      <span class="comment">//Apple Lossless. Uses no flags.</span>
<span class="lineno" id=line156></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatMPEG4AAC_HE : AudioFormatID;
<span class="lineno" id=line157></span>      <span class="comment">//MPEG-4 High Efficiency AAC audio object. Uses no flags.</span>
<span class="lineno" id=line158></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatMPEG4AAC_LD : AudioFormatID;
<span class="lineno" id=line159></span>      <span class="comment">//MPEG-4 AAC Low Delay audio object. Uses no flags.</span>
<span class="lineno" id=line160></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatMPEG4AAC_ELD : AudioFormatID;
<span class="lineno" id=line161></span>      <span class="comment">//MPEG-4 AAC Enhanced Low Delay audio object. Uses no flags.</span>
<span class="lineno" id=line162></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatMPEG4AAC_ELD_SBR : AudioFormatID;
<span class="lineno" id=line163></span>      <span class="comment">//MPEG-4 AAC Enhanced Low Delay audio object with SBR (spectral band replication) extension layer. Uses no flags.</span>
<span class="lineno" id=line164></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatMPEG4AAC_HE_V2 : AudioFormatID;
<span class="lineno" id=line165></span>      <span class="comment">//MPEG-4 High Efficiency AAC Version 2 audio object. Uses no flags.</span>
<span class="lineno" id=line166></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatMPEG4AAC_Spatial : AudioFormatID;
<span class="lineno" id=line167></span>      <span class="comment">//MPEG-4 Spatial Audio audio object. Uses no flags.</span>
<span class="lineno" id=line168></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatAMR : AudioFormatID;
<span class="lineno" id=line169></span>      <span class="comment">//The AMR (Adaptive Multi-Rate) narrow band speech codec.</span>
<span class="lineno" id=line170></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatAudible : AudioFormatID;
<span class="lineno" id=line171></span>      <span class="comment">//The codec used for Audible, Inc. audio books. Uses no flags.</span>
<span class="lineno" id=line172></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatiLBC : AudioFormatID;
<span class="lineno" id=line173></span>      <span class="comment">//The iLBC (internet Low Bitrate Codec) narrow band speech codec. Uses no flags.</span>
<span class="lineno" id=line174></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatDVIIntelIMA : AudioFormatID;
<span class="lineno" id=line175></span>      <span class="comment">//DVI/Intel IMA ADPCM - ACM code 17.</span>
<span class="lineno" id=line176></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatMicrosoftGSM : AudioFormatID;
<span class="lineno" id=line177></span>      <span class="comment">//Microsoft GSM 6.10 - ACM code 49.</span>
<span class="lineno" id=line178></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatAES3 : AudioFormatID;
<span class="lineno" id=line179></span>      <span class="comment">//The format defined by the AES3-2003 standard. Adopted into MXF and MPEG-2 containers and SDTI transport streams with SMPTE specs 302M-2002 and 331M-2000. Uses no flags.</span>
<span class="lineno" id=line180></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatAMR_WB : AudioFormatID;
<span class="lineno" id=line181></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatEnhancedAC3 : AudioFormatID;
<span class="lineno" id=line182></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatMPEG4AAC_ELD_V2 : AudioFormatID;
<span class="lineno" id=line183></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatFLAC : AudioFormatID;
<span class="lineno" id=line184></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatMPEGD_USAC : AudioFormatID;
<span class="lineno" id=line185></span>    <span class="big_keyword" title="Bind a Felix symbol to a C expression">const</span> kAudioFormatOpus : AudioFormatID;
<span class="lineno" id=line186></span>  
<span class="lineno" id=line187></span>    <span class="comment">// Audio Stream</span>
<span class="lineno" id=line188></span>    <span class="big_keyword" title="Provide a model for an existing C struct">cstruct</span> AudioStreamBasicDescription
<span class="lineno" id=line189></span>    {
<span class="lineno" id=line190></span>        <span class="library" title="binding of C double float type">double</span> mSampleRate;
<span class="lineno" id=line191></span>        AudioFormatID mFormatID;
<span class="lineno" id=line192></span>        AudioFormatFlags mFormatFlags;
<span class="lineno" id=line193></span>        <span class="library" title="binding of C uint32_t type">uint32</span> mBytesPerPacket;
<span class="lineno" id=line194></span>        <span class="library" title="binding of C uint32_t type">uint32</span> mFramesPerPacket;
<span class="lineno" id=line195></span>        <span class="library" title="binding of C uint32_t type">uint32</span> mBytesPerFrame;
<span class="lineno" id=line196></span>        <span class="library" title="binding of C uint32_t type">uint32</span> mChannelsPerFrame;
<span class="lineno" id=line197></span>        <span class="library" title="binding of C uint32_t type">uint32</span> mBitsPerChannel;
<span class="lineno" id=line198></span>        <span class="library" title="binding of C uint32_t type">uint32</span> mReserved;
<span class="lineno" id=line199></span>    };
<span class="lineno" id=line200></span>  
<span class="lineno" id=line201></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> AudioUnitInitialize: AudioUnit -&gt; OSStatus;
<span class="lineno" id=line202></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> AudioOutputUnitStart: AudioUnit -&gt; OSStatus;
<span class="lineno" id=line203></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> AudioOutputUnitStop: AudioUnit -&gt; OSStatus;
<span class="lineno" id=line204></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> AudioUnitUninitialize: AudioUnit -&gt; OSStatus;
<span class="lineno" id=line205></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> AudioComponentInstanceDispose: AudioUnit -&gt; OSStatus;
<span class="lineno" id=line206></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> AudioComponentInstanceNew : AudioComponent * &amp;AudioUnit -&gt; OSStatus;
<span class="lineno" id=line207></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> AudioUnitRender: 
<span class="lineno" id=line208></span>      AudioUnit * &amp;AudioUnitRenderActionFlags * &amp;&lt;AudioTimeStamp * <span class="library" title="binding of C uint32_t type">uint32</span> * <span class="library" title="binding of C uint32_t type">uint32</span> *  AudioBufferList
<span class="lineno" id=line209></span>      -&gt;
<span class="lineno" id=line210></span>      OSStatus
<span class="lineno" id=line211></span>    ;
<span class="lineno" id=line212></span>  
<span class="lineno" id=line213></span>    <span class="comment">// Define thunk for Felix</span>
<span class="lineno" id=line214></span>    <span class="qualifier" title="A C wrapper for a Felix callback">callback</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> audioRenderCallback_thunk :
<span class="lineno" id=line215></span>      audioRenderCallback_thunk *               <span class="comment">// void*</span>
<span class="lineno" id=line216></span>      &amp;AudioUnitRenderActionFlags *
<span class="lineno" id=line217></span>      &amp;&lt;AudioTimeStamp *
<span class="lineno" id=line218></span>      <span class="library" title="binding of C uint32_t type">uint32</span> *
<span class="lineno" id=line219></span>      <span class="library" title="binding of C uint32_t type">uint32</span> *
<span class="lineno" id=line220></span>      AudioBufferList
<span class="lineno" id=line221></span>      -&gt; OSStatus
<span class="lineno" id=line222></span>    ;
<span class="lineno" id=line223></span>  
<span class="lineno" id=line224></span>    <span class="comment">// C type of Apple Audio Callback</span>
<span class="lineno" id=line225></span>    <span class="big_keyword" title="Define an alias for a type expression">typedef</span> AURenderCallback = audioRenderCallback_thunk'c_callback_type
<span class="lineno" id=line226></span>  <span class="comment">/*
<span class="lineno" id=line227></span>      address *               // void*
<span class="lineno" id=line228></span>      &amp;AudioUnitRenderActionFlags *
<span class="lineno" id=line229></span>      &amp;&lt;AudioTimeStamp *
<span class="lineno" id=line230></span>      uint32 *
<span class="lineno" id=line231></span>      uint32 *
<span class="lineno" id=line232></span>      AudioBufferList
<span class="lineno" id=line233></span>      --&gt; OSStatus
<span class="lineno" id=line234></span>  */</span>
<span class="lineno" id=line235></span>    ;
<span class="lineno" id=line236></span>  
<span class="lineno" id=line237></span>    <span class="comment">// The type of the thunk doesn't quite agree with Apple</span>
<span class="lineno" id=line238></span>    <span class="big_keyword" title="Define an alias for a type expression">typedef</span> audioRenderCallback_thunk_t = audioRenderCallback_thunk'felix_thunk_type
<span class="lineno" id=line239></span>  <span class="comment">/*
<span class="lineno" id=line240></span>      (
<span class="lineno" id=line241></span>        &amp;AudioUnitRenderActionFlags *
<span class="lineno" id=line242></span>        &amp;&lt;AudioTimeStamp *
<span class="lineno" id=line243></span>        uint32 *
<span class="lineno" id=line244></span>        uint32 *
<span class="lineno" id=line245></span>        AudioBufferList
<span class="lineno" id=line246></span>        -&gt; OSStatus
<span class="lineno" id=line247></span>      ) *
<span class="lineno" id=line248></span>      &amp;AudioUnitRenderActionFlags *
<span class="lineno" id=line249></span>      &amp;&lt;AudioTimeStamp *
<span class="lineno" id=line250></span>      uint32 *
<span class="lineno" id=line251></span>      uint32 *
<span class="lineno" id=line252></span>      AudioBufferList
<span class="lineno" id=line253></span>      --&gt; OSStatus
<span class="lineno" id=line254></span>  */</span>
<span class="lineno" id=line255></span>    ;
<span class="lineno" id=line256></span>  
<span class="lineno" id=line257></span>    <span class="comment">// Force the Felix thunk to have the type Apple wants</span>
<span class="lineno" id=line258></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> castCB_thunk : audioRenderCallback_thunk_t -&gt; AURenderCallback = 
<span class="lineno" id=line259></span>      <span class="fstring">"reinterpret_cast&lt;AURenderCallback&gt;($1)"</span>
<span class="lineno" id=line260></span>    ;
<span class="lineno" id=line261></span>  
<span class="lineno" id=line262></span>    <span class="comment">// Apple Callback specification object type</span>
<span class="lineno" id=line263></span>    <span class="big_keyword" title="Provide a model for an existing C struct">cstruct</span> AURenderCallbackStruct {
<span class="lineno" id=line264></span>      inputProc: AURenderCallback;
<span class="lineno" id=line265></span>      inputProcRefCon: <span class="library" title="special binding of C void* type">address</span>;
<span class="lineno" id=line266></span>    };
<span class="lineno" id=line267></span>  
<span class="lineno" id=line268></span>  
<span class="lineno" id=line269></span>  } <span class="comment">// class</span>
</pre></p><pre class='inclusion'>
share/lib/std/apple/AppKit.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/apple/Foundation"</span>;
<span class="lineno" id=line2></span>  
<span class="lineno" id=line3></span>  <span class="big_keyword" title="Open a module or class">open</span> <span class="big_keyword" title="Define a type class">class</span> AppKit
<span class="lineno" id=line4></span>  {
<span class="lineno" id=line5></span>    <span class="big_keyword" title="specify requirements">requires</span> <span class="small_keyword" title="specifies an abstract package name">package</span> <span class="fstring">"appkit"</span>;
<span class="lineno" id=line6></span>    <span class="big_keyword" title="Define a primitive type by binding to a C type">type</span> NSSound = <span class="fstring">"NSSound*"</span>;
<span class="lineno" id=line7></span>    <span class="big_keyword" title="Define a primitive type by binding to a C type">type</span> NSColor = <span class="fstring">"NSColor*"</span>;
<span class="lineno" id=line8></span>  
<span class="lineno" id=line9></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> loadSound(filename:NSString)=&gt;
<span class="lineno" id=line10></span>      cexpr[NSSound] <span class="fstring">"""
<span class="lineno" id=line11></span>         [
<span class="lineno" id=line12></span>           [NSSound alloc] initWithContentsOfFile:$1 
<span class="lineno" id=line13></span>           byReference:NO
<span class="lineno" id=line14></span>         ]
<span class="lineno" id=line15></span>      """</span> filename endcexpr
<span class="lineno" id=line16></span>    ;
<span class="lineno" id=line17></span>    <span class="big_keyword" title="Define a procedure, a function with side-effects not returning a value">proc</span> play: NSSound = <span class="fstring">"[$1 play];"</span>;
<span class="lineno" id=line18></span>  }
</pre></p><pre class='inclusion'>
share/lib/std/apple/Cocoa.flx</pre>
<p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"std/apple/Foundation"</span>;
<span class="lineno" id=line2></span>  <span class="big_keyword" title="Open a module or class">open</span> <span class="big_keyword" title="Define a type class">class</span> Cocoa {
<span class="lineno" id=line3></span>    <span class="big_keyword" title="specify requirements">requires</span> <span class="small_keyword" title="specifies an abstract package name">package</span> <span class="fstring">"cocoa"</span>;
<span class="lineno" id=line4></span>    <span class="big_keyword" title="Define a primitive type by binding to a C type">type</span> NSWindow = <span class="fstring">"NSWindow*"</span>;
<span class="lineno" id=line5></span>    <span class="big_keyword" title="Define a function with no side-effects">fun</span> getProcessName: 1 -&gt; NSString = <span class="fstring">"[[NSProcessInfo processInfo] processName]"</span>;
<span class="lineno" id=line6></span>  
<span class="lineno" id=line7></span>    <span class="big_keyword" title="Define a generator, a function with side-effects returning a value">gen</span> createTitledWindow : NSString * <span class="library" title="binding of C int type">int</span> * <span class="library" title="binding of C int type">int</span> * <span class="library" title="binding of C int type">int</span> * <span class="library" title="binding of C int type">int</span> -&gt; NSWindow = <span class="fstring">"""
<span class="lineno" id=line8></span>      ([&amp;](){
<span class="lineno" id=line9></span>          NSWindow *x = [[NSWindow alloc] initWithContentRect:NSMakeRect(0, 0, $4, $5)
<span class="lineno" id=line10></span>             styleMask:NSTitledWindowMask backing:NSBackingStoreBuffered defer:NO];
<span class="lineno" id=line11></span>          [x cascadeTopLeftFromPoint:NSMakePoint($2,$3)];
<span class="lineno" id=line12></span>          [x setTitle: $1];
<span class="lineno" id=line13></span>          [x makeKeyAndOrderFront:nil];
<span class="lineno" id=line14></span>          return x;
<span class="lineno" id=line15></span>          }())
<span class="lineno" id=line16></span>    """</span>; <span class="comment">// Note use of C++ lambda</span>
<span class="lineno" id=line17></span>  
<span class="lineno" id=line18></span>    <span class="comment">// Starts main event loop</span>
<span class="lineno" id=line19></span>    <span class="comment">// do NOT confuse with Felix run procedure which creates a scheduler to run fibres</span>
<span class="lineno" id=line20></span>    <span class="big_keyword" title="Define a procedure, a function with side-effects not returning a value">proc</span> run : 1 = <span class="fstring">"[NSApp run];"</span>; 
<span class="lineno" id=line21></span>  }
</pre></p><pre class='inclusion'>
$PWD/src/config/macosx/foundation.fpc</pre>
<p><pre class="prefmtbg">Name: Foundation
Description: Foundation
Requires: objc
includes: '&lt;Foundation/Foundation.h&gt;'
provides_dlib: ---framework=Foundation
provides_slib: ---framework=Foundation
</pre></p><pre class='inclusion'>
$PWD/src/config/macosx/appkit.fpc</pre>
<p><pre class="prefmtbg">Name: AppKit 
Description: AppKit
Requires: foundation 
includes: '&lt;AppKit/AppKit.h&gt;'
provides_dlib: ---framework=AppKit
provides_slib: ---framework=AppKit
</pre></p><pre class='inclusion'>
$PWD/src/config/macosx/cocoa.fpc</pre>
<p><pre class="prefmtbg">Name: Cocoa
Description: Cocoa
Requires: foundation
includes: '&lt;Cocoa/Cocoa.h&gt;'
provides_dlib: ---framework=Cocoa
provides_slib: ---framework=Cocoa
</pre></p><pre class='inclusion'>
$PWD/src/config/macosx/corefoundation.fpc</pre>
<p><pre class="prefmtbg">Name: CoreFoundation
Description: CoreFoundation
provides_dlib: ---framework=CoreFoundation
provides_slib: ---framework=CoreFoundation
</pre></p><pre class='inclusion'>
$PWD/src/config/macosx/audiounit.fpc</pre>
<p><pre class="prefmtbg">Name: AudioUnit
Description: AudioUnit C API
includes: '&lt;AudioUnit/AudioUnit.h&gt;'
provides_dlib: ---framework=AudioUnit
provides_slib: ---framework=AudioUnit
</pre></p><pre class='inclusion'>
$PWD/src/config/macosx/coreaudio.fpc</pre>
<p><pre class="prefmtbg">Name: CoreAudio
Description: CoreAudio C API
includes: '&lt;CoreAudio/CoreAudio.h&gt;'
provides_dlib: ---framework=CoreAudio
provides_slib: ---framework=CoreAudio
</pre></p><pre class='inclusion'>
$PWD/src/config/macosx/audiotoolbox.fpc</pre>
<p><pre class="prefmtbg">Name: AudioToolbox
Description: AudioToolbox
provides_dlibs: ---framework=AudioToolbox
provides_slibs: ---framework=AudioToolbox
</pre></p><pre class='inclusion'>
$PWD/src/config/macosx/objc.fpc</pre>
<p><pre class="prefmtbg">Name: ObjC Runtime
Description: run time library for objective C
cflags: -ObjC++
provides_dlib: -L/usr/lib -lobjc
provides_slib: -L/usr/lib -lobjc
includes: '"/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/objc/runtime.h"'


 

</pre></p></div><!--Main Content Body End-->

          </div> <!-- rightpanel contents end -->
          <hr>
        </span> <!-- rightpanel end -->

        <span id="panemover" style="cursor:col-resize;"
         onmousedown="dragStart(event, 'left', 'right'); return false;"
         onmousemove="drag(event, 'left', 'right');"
         onmouseout="dragRelease();"
         onmouseup="dragRelease();"
        >
        </span> <!-- panemover end -->
      </div> <!-- bottom panel end -->
    </div> <!-- container end -->
</body></html>

