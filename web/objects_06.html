<html><head>
<style type="text/css">
body {margin:3%; }
h1 {color:gray; font-size:120%;}
h2 {color:gray; font-size:105%;}
h3 {font-size:100%;}
h4 {font-size:95%;}
h5 {font-size:95%;}
span.fstring {color:darkblue; font-style:italic; }
span.comment {font-family:arial; color:blue; font-style:italic; }
span.doccomment {font-family:arial; color:green; font-style:italic; }
span.big_keyword {color:#FF1010; }
span.small_keyword {color:#802040; }
span.qualifier {color:#A02020; }
span.library {color:#A02000; }
span.ctor {color:#406020; }
span.hack {color:#66DD00; }
span.preproc {color:#005500; }
span.embedded_c{background-color:#DDDDDD; }
span.fpc_fieldname {color:#DD0000; }
span.lineno {color:#101010; background-color:#E0E0E0; font-size:80%; font-family:"courier",monospace; font-style:normal; }
pre.flxbg {background-color:#A0FFA0; color:black; padding:2px; box-shadow:5px 5px 2px #807080; }
pre.uncheckedflxbg {background-color:#D0D0D0; color:black; padding:2px; box-shadow:5px 5px 2px #807080; }
pre.cppbg {background-color:#80FF80; color:black; }
pre.prefmtbg {background-color:#D0D0D0; color:black; }
pre.expected {background-color:#E0FF80; color:black; }
pre.input {background-color:#E08080; color:black; }
pre.inclusion {background-color:#D070D0; color:black; }
code.inclusion {background-color:#D070D0; color:black; }
.obsolete { background-color:#FFEFEF; font-size: small; color:black; }
.future { background-color:#FF8080; font-size: small; color:black; }
.implementation_detail { background-color:#E0E0E0; font-size: small; color:black;  }
.bug { background-color:#FFE0E0; font-size: small; color:black; }
.fixed{ background-color:#FFE0E0; font-size: small; color:black; }
.done { background-color:#FFE0E0; font-size: small; color:black; }
.caveat { background-color:#FF8080; color:black; }
</style>
<title>/Users/skaller/felix/src/web/tut/objects_06.html</title></head><body>
<style>
body {margin:3%; font-family: sans-serif; }
h1 {color:black; font-size:120%; border-bottom: 2px solid #ddd; padding: 0 0 3px 0;}
h2 {color:#202020; font-size:105%;}
h3 {font-size:100%;}
h4 {font-size:95%;}
h5 {font-size:95%;}
span.fstring {color:darkblue; font-style:italic; }
span.comment {font-family:arial; color:blue; font-style:italic; }
span.doccomment {font-family:arial; color:green; font-style:italic; }
span.big_keyword {color:#FF1010; }
span.small_keyword {color:#802040; }
span.qualifier {color:#A02020; }
span.library {color:#A02000; }
span.ctor {color:#406020; }
span.hack {color:#66DD00; }
span.preproc {color:#005500; }
span.embedded_c{background-color:#DDDDDD; }
span.fpc_fieldname {color:#DD0000; }
span.lineno {color:#101010; background-color:#E0E0E0; font-size:80%; font-family:"courier",monospace; font-style:normal; }
pre { border: 1px solid #ccc; color: black; box-shadow:3px 3px 2px rgba(0,0,0,0.1); padding:2px; }
pre.flxbg {background-color:#C2FDC2; box-shadow:3px 3px 2px rgba(0,0,0,0.1) }
pre.uncheckedflxbg {background-color:#eee; box-shadow:3px 3px 2px rgba(0,0,0,0.1); }
pre.cppbg {background-color:#C2FDC2; }
pre.prefmtbg {background-color:#F1F1F1; }
pre.expected {background-color:hsla(74,94%,88%,1); }
pre.input {background-color:hsla(20,94%,88%,1); }
pre.inclusion {
    font-family: Arial;
    font-weight: normal;
    font-size: 0.9em;
    color: #555;
    border: none;
    box-shadow: none;
    text-align: right;
    margin: -7px 11px -12px 0;
    padding: 0;
    background-color:#fafafa;
}
code.inclusion {background-color:#D070D0; color:black; }
.obsolete { background-color:#FFEFEF; font-size: small; color:black; }
.future { background-color:#FF8080; font-size: small; color:black; }
.implementation_detail { background-color:#E0E0E0; font-size: small; color:black;  }
.bug { background-color:#FFE0E0; font-size: small; color:black; }
.fixed{ background-color:#FFE0E0; font-size: small; color:black; }
.done { background-color:#FFE0E0; font-size: small; color:black; }
.caveat { background-color:hsla(0,100%,91%,1); color:black; padding: 0.6em; }
.container {
  position: fixed;
  top:0px;
  left:0px;
  height : 100%;
  width: 100%;
  background-color: grey;
  margin: 0px;
  padding: 0px;
  border-width: 0px;
  color: #404040;
}
.maincontent {
  padding:4px;
  padding-left:8px;
  line-height:1.3em;
  color:#404040; background-color:#fafafa;
}
.maincontent h1 { margin-left:-8px; position: relative; font-family: georgia, serif; font-size: 1.8em; font-weight: normal; }
.maincontent h2 { margin-left:-8px; position: relative; margin-bottom:-5px; }
.maincontent h3 { margin-left:-8px; position: relative; margin-bottom:-5px; }
.maincontent h4 { margin-left:-8px; position: relative; margin-bottom:-5px; }
.maincontent code { color:#902030; }
.toppanel {
  position:absolute; left:0px; top:0px; height:20px; right:0px;
  background-color: #e0e0e0;
}
.bottompanel {
  position:absolute; left:0px; top:22px; bottom:0px; right:0px;
  background-color: #fafafa;
  font-size:14px;
}
.leftpanel {
  position:absolute; left:0px; top:0px; bottom:0px; width: 150px;
  background-color: #eaeaea; overflow: auto;
}
.rightpanel {
  position:absolute; right: 0px; left:160px; top:0px; bottom: 0px;
  background-color: #fafafa; overflow: auto;
}
.divider {
  position:absolute; left: 150px; top:0px; bottom:0px;
  background-color: black; width:2px;
  box-shadow: 0 0 8px #000;
}

#panemover {
    position:absolute;
    left: 150px;
    width : 10px;
    top: 0px;
    bottom: 0px;
    opacity: 0.3;
    cursor:col-resize;
}

div.m {
    margin: 0px;
    padding:0px;
    border-width:2px;
    border-color: green;
}

div.m1 {
    background-color: #86E870;
    border-style:outset;
    border-color:#ccc;
    border-width:2px 0;
    font-size:90%;
    padding: 1px 0 2px 10px;
}

div.m2 {
    background-color: #70C070;
    padding-left:15px;
    padding-top:2px;
    border-style:outset;
    border-color:green;
    border-width:0 0 1px 0;
    font-size:80%;
}

div.m1:hover, div.m2:hover {
    background-color: white;
}

#leftmargintoc a {
    text-decoration: none;
    color: #404040;
}
</style>

<style>
div.m {
    margin: 0px;
    padding:0px;
    border-width:2px;
    border-color: green;
}

div.m1 {
    background-color: #86E870;
    border-style:outset;
    border-color:#ccc;
    border-width:2px 0;
    font-size:90%;
    padding: 1px 0 2px 10px;
}

div.m2 {
    background-color: #70C070;
    padding-left:15px;
    padding-top:2px;
    border-style:outset;
    border-color:green;
    border-width:0 0 1px 0;
    font-size:80%;
}

div.m1:hover, div.m2:hover {
    background-color: white;
}

#leftmargintoc a {
    text-decoration: none;
    color: #404040;
}


</style>

    <script async="true">
      function dragStart(e, left, right){
        document.getElementById("panemover").style.width="70%";
        document.getElementById("panemover").style.left="50px";
        mousedown = true;
        x = e.clientX
        dragOffsetLeft =
          document.getElementById(left).getBoundingClientRect().right -
          document.getElementById(left).getBoundingClientRect().left -
          x
        ;
        dragOffsetDivider= document.getElementById("divider").getBoundingClientRect().left - x;
        dragOffsetRight = document.getElementById(right).getBoundingClientRect().left - x;
      }
      function dragRelease(){
        document.getElementById('panemover').style.width = '10px';
        document.getElementById('panemover').style.left = document.getElementById('divider').offsetLeft + 'px';
        mousedown = false;
      }
      function drag(e, left, right){
        if(!mousedown){return}
        x = e.clientX
        tmpLeft = dragOffsetLeft + x
        tmpDivider= dragOffsetDivider + x
        tmpRight = dragOffsetRight + x
        document.getElementById(left).style.width= tmpLeft + 'px';
        document.getElementById("divider").style.left= tmpDivider + 'px';
        document.getElementById(right).style.left = tmpRight + 'px';
      };
    </script>

<script type="text/javascript">

  function mexpand(id)
  {
    var n = document.getElementById(id).style;
    n.display = "block";
  }

  function mcollapse(id)
  {
    var n = document.getElementById(id).style;
    n.display = "none";
  }

  var counter_max = 0;
  function mshow(id,loc)
  {
    var i;
    for(i=1; i<=counter_max; ++i)
      mcollapse("menu"+String(i));
    mexpand(id);
    window.location.replace(loc);
  }
</script>

<script type="text/javascript">

function expand(but,id)
{
  var n = document.getElementById(id).style;
  var button = document.getElementById(but);
  button.src = "/share/src/web/images/minus.gif";
  button.alt = "-";
  n.display = "block";
}
function collapse(but,id)
{
  var n = document.getElementById(id).style;
  var button = document.getElementById(but);
  button.src = "/share/src/web/images/plus.gif";
  button.alt = "+";
  n.display = "none";
}
function toggle(button,id)
{
  var n = document.getElementById(id).style;
  if (n.display == "none")
  {
    button.src = "/share/src/web/images/minus.gif";
    button.alt = "-";
    n.display = "block";
  }
  else
  {
    button.src = "/share/src/web/images/plus.gif";
    button.alt = "+";
    n.display = "none";
  }
}
var allbuttons = [
"Objects and Plugins"
];
function expand_all(dummy)
{
  for (i in allbuttons)
  {
    expand(allbuttons[i], allbuttons[i]+"_d");
  }
}
function collapse_all(dummy)
{
  for (i in allbuttons)
  {
    collapse(allbuttons[i], allbuttons[i]+"_d");
  }
}
</script>

<script>
function mouseover(id)
{
  var elt = document.getElementById(id);
  elt.style.display="none";
  var elt2 = document.getElementById(id+"_mo");
  elt2.style.display="inline";
}

function mouseout(id)
{
  var elt = document.getElementById(id+"_mo");
  elt.style.display="none";
  var elt2 = document.getElementById(id);
  elt2.style.display="inline";
}

</script>
<script> function nop(dummy) {} </script>
    <div class="container">
      <div class="toppanel">
    <!--Main Content top navbar-->
<span style="position:relative; bottom:6px"
  onmouseover="mouseover('expand')"
  onmouseout="mouseout('expand')"
  onclick="expand_all('expand')"
  ><span id="expand"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:blue;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Expand</text></svg></span><span id="expand_mo" style="display:none"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:red;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Expand</text></svg></span></span><span style="position:relative; bottom:6px"
  onmouseover="mouseover('collapse')"
  onmouseout="mouseout('collapse')"
  onclick="collapse_all('collapse')"
  ><span id="collapse"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:blue;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Collapse</text></svg></span><span id="collapse_mo" style="display:none"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:red;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Collapse</text></svg></span></span><a href='objects_05.html'><span style="position:relative; bottom:6px"
  onmouseover="mouseover('prev')"
  onmouseout="mouseout('prev')"
  onclick="nop('prev')"
  ><span id="prev"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:blue;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Prev</text></svg></span><span id="prev_mo" style="display:none"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:red;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Prev</text></svg></span></span></a> <a href='objects_07.html'><span style="position:relative; bottom:6px"
  onmouseover="mouseover('next')"
  onmouseout="mouseout('next')"
  onclick="nop('next')"
  ><span id="next"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:blue;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Next</text></svg></span><span id="next_mo" style="display:none"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:red;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Next</text></svg></span></span></a> <a href='objects_index.html'><span style="position:relative; bottom:6px"
  onmouseover="mouseover('index')"
  onmouseout="mouseout('index')"
  onclick="nop('index')"
  ><span id="index"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:blue;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Index</text></svg></span><span id="index_mo" style="display:none"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:red;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Index</text></svg></span></span></a>     <!--Main Content top navbar End-->

      </div> <!-- toppanel end -->
      <div class="bottompanel">
        <span id="divider" class="divider"></span>

        <span id="left" class="leftpanel" >
          <div class="menucontent">
  <!--Left Margin Toc-->
  <div id="leftmargintoc">
    <!--Left Margin Toc Main Contents-->
      <div class=m1 onclick="mshow('menu1','#Objects and Plugins_h')"> <a href="#Objects_and_Plugins_h">Objects and Plugins</a></div>
      <div class=sm id=menu1>
      </div>
    <script>counter_max=1;</script>
  </div>
  <!--End Left Margin Toc-->

          </div> <!-- leftpanel contents end -->
        </span> <!-- leftpanel end -->

        <span id="right" class="rightpanel">
          <div class="maincontent">
<!--Main Content Body-->
<h1 id='Objects_and_Plugins_h'><img src='/share/src/web/images/minus.gif' id='Objects and Plugins' onclick='toggle(this,"Objects_and_Plugins_d")' alt='+'/> 6.1 Objects and Plugins</h1><div id='Objects_and_Plugins_d' style='display:block'>
<p>Objects work well with plugins.
We'll look at a simple example, the paragraph control object
used by the html processor in the webserver.
</p><p><pre class='uncheckedflxbg'><span class="lineno" id=line1></span>  <span class="comment">// file doc_paragraph.flx</span>
<span class="lineno" id=line2></span>  <span class="big_keyword" title="define an object interface">interface</span> paragraph-control_t {
<span class="lineno" id=line3></span>    whatami: 1 -&gt; <span class="library" title="binding of C++ string type">string</span>;
<span class="lineno" id=line4></span>    sp : 1 -&gt; 0;
<span class="lineno" id=line5></span>    sp-clas : <span class="library" title="binding of C++ string type">string</span> -&gt; 0;
<span class="lineno" id=line6></span>    ep : 1 -&gt; 0;
<span class="lineno" id=line7></span>    bp : 1 -&gt; 0;
<span class="lineno" id=line8></span>  }
</pre></p><p></p><p>The interface has a <code>whatami</code> method to specify the kind
of object in a human readable format. Then it provides
method <code>sp</code> to start a paragraph, {sp-clas} to start 
a paragraph with a given HTML class attribute, so CSS
can modify the formatting.
</p><p></p><p>Then there's an end paragraph method and a method to
break paragraphs, that is, end one and start a new one.
Now lets look at the implementation:
</p><p><pre class='uncheckedflxbg'><span class="lineno" id=line1></span>  <span class="comment">// file html_paragraph.flx</span>
<span class="lineno" id=line2></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"./paragraph-interface"</span>;
<span class="lineno" id=line3></span>  
<span class="lineno" id=line4></span>  <span class="big_keyword" title="Define a function with no side-effects">fun</span> setup(config_data:<span class="library" title="binding of C++ string type">string</span>) = {
<span class="lineno" id=line5></span>    eprintln$ <span class="fstring">"Setup html_paragraph"</span> + config_data;
<span class="lineno" id=line6></span>    <span class="small_keyword" title="return">return</span> 0;
<span class="lineno" id=line7></span>  }
<span class="lineno" id=line8></span>  
<span class="lineno" id=line9></span>  
<span class="lineno" id=line10></span>  <span class="big_keyword" title="define an object factory">object</span> html_paragraph (write_string: <span class="library" title="binding of C++ string type">string</span> -&gt; 0) <span class="small_keyword" title="specify what interfaces an object implements">implements</span> paragraph-control_t = 
<span class="lineno" id=line11></span>  {
<span class="lineno" id=line12></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> whatami () =&gt; <span class="fstring">"Paragraph object"</span>;
<span class="lineno" id=line13></span>    <span class="big_keyword" title="Define a mutable variable">var</span> pstate = <span class="library" title="false value">false</span>;
<span class="lineno" id=line14></span>    <span class="big_keyword" title="Define a procedure, a function with side-effects not returning a value">proc</span> start_p () { write_string(<span class="fstring">"&lt;p&gt;"</span>); pstate=<span class="library" title="truth value">true</span>; }
<span class="lineno" id=line15></span>    <span class="big_keyword" title="Define a procedure, a function with side-effects not returning a value">proc</span> start_p (cls:<span class="library" title="binding of C++ string type">string</span>) { write_string(<span class="fstring">"&lt;p class='"</span>+cls+<span class="fstring">"'&gt;"</span>); pstate=<span class="library" title="truth value">true</span>; }
<span class="lineno" id=line16></span>    <span class="big_keyword" title="Define a procedure, a function with side-effects not returning a value">proc</span> end_p () { write_string(<span class="fstring">"&lt;/p&gt;"</span>); pstate=<span class="library" title="false value">false</span>; }
<span class="lineno" id=line17></span>    <span class="big_keyword" title="Define a procedure, a function with side-effects not returning a value">proc</span> break_p () { write_string(<span class="fstring">"&lt;/p&gt;&lt;p&gt;"</span>); }
<span class="lineno" id=line18></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a procedure, a function with side-effects not returning a value">proc</span> sp-clas (cls: <span class="library" title="binding of C++ string type">string</span>) { <span class="small_keyword" title="conditional">if</span> <span class="small_keyword" title="logical negation">not</span> pstate <span class="small_keyword" title="imperative code begins">do</span> start_p cls; <span class="small_keyword" title="end of body">done</span> }
<span class="lineno" id=line19></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a procedure, a function with side-effects not returning a value">proc</span> sp() { <span class="small_keyword" title="conditional">if</span> <span class="small_keyword" title="logical negation">not</span> pstate <span class="small_keyword" title="imperative code begins">do</span> start_p; <span class="small_keyword" title="end of body">done</span> }
<span class="lineno" id=line20></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a procedure, a function with side-effects not returning a value">proc</span> ep() { <span class="small_keyword" title="conditional">if</span> pstate <span class="small_keyword" title="imperative code begins">do</span> end_p; <span class="small_keyword" title="end of body">done</span> }
<span class="lineno" id=line21></span>    <span class="qualifier" title="A function depending only on its parameters">method</span> <span class="big_keyword" title="Define a procedure, a function with side-effects not returning a value">proc</span> bp() { <span class="small_keyword" title="conditional">if</span> pstate <span class="small_keyword" title="imperative code begins">do</span> end_p; <span class="small_keyword" title="end of body">done</span> start_p; }
<span class="lineno" id=line22></span>  }
<span class="lineno" id=line23></span>  
<span class="lineno" id=line24></span>  <span class="big_keyword" title="generate extern "C" wrapper">export</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> setup of (<span class="library" title="binding of C++ string type">string</span>) as <span class="fstring">"setup"</span>;
<span class="lineno" id=line25></span>  <span class="big_keyword" title="generate extern "C" wrapper">export</span> <span class="big_keyword" title="Define a function with no side-effects">fun</span> html_paragraph of (string-&gt;0) as <span class="fstring">"html_paragraph"</span>;
</pre></p><p></p><p>The <code>include</code> directive includes the file containing the interface
given above.
</p><p></p><p>The <code>setup</code> function here doesn't do anything, its required by
the plugin loader. In more complex plugins it can parse a configuration
string to extract any relevant data.
</p><p></p><p>Now you can see the methods implemented, and note that the
object closure contains local variable <code>pstate</code> which records
the current state: if true, we're in a paragraph, if false
then we're not.
</p><p></p><p>The procedures not marked as <code>method</code> are private
helpers.
</p><p></p><p>Finally, we have to export the <code>setup</code> and <code>html_paragraph</code>
functions so they get {extern "C"} linkage, so we can
use {dlsym()} or {GetProcAddress()} on them when we load
the plugin DLL (shared library).
</p><p></p><p>To use this stuff we do as follows in another plugin
or mainline.
</p><p><pre class='uncheckedflxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Include a Felix file">include</span> <span class="fstring">"./paragraph-interface"</span>;
<span class="lineno" id=line2></span>  <span class="big_keyword" title="Define a mutable variable">var</span> paragraph-maker : (string-&gt;0) -&gt; paragraph-control_t;
</pre></p><p>We haul in the file containing the interface, and create
an uninitialised global variable to hold the factory 
function. Next, in the <code>setup</code> phase of the caller:
</p><p><pre class='uncheckedflxbg'><span class="lineno" id=line1></span>    paragraph-maker = 
<span class="lineno" id=line2></span>      Dynlink::load-plugin-func1 
<span class="lineno" id=line3></span>       [paragraph-control_t, (string-&gt;0)] 
<span class="lineno" id=line4></span>       (dll-name=<span class="fstring">"html_paragraph"</span>)
<span class="lineno" id=line5></span>    ;
</pre></p><p>we assign the factory function loaded from the plugin
to the variable. The {load-plugin-func1} function actually
loads the DLL, creates a data frame for its global variables,
calls the <code>setup</code> function, and returns a closure of the
factory function bound to the data frame which we store
in the {paragraph-maker} variable.
</p><p></p><p>This isn't a paragraph control object yet.
To make one of those we call:
</p><p><pre class='uncheckedflxbg'><span class="lineno" id=line1></span>    <span class="big_keyword" title="Define a mutable variable">var</span> paragraph = paragraph-maker write_string of (<span class="library" title="binding of C++ string type">string</span>);
</pre></p><p>and now we can use the object:
</p><p><pre class='uncheckedflxbg'><span class="lineno" id=line1></span>    paragraph.sp ();
<span class="lineno" id=line2></span>    write_string <span class="fstring">"Hello"</span>;
<span class="lineno" id=line3></span>    paragraph.ep();
</pre></p><p>Although this seems complicated you should note what is happening:
there are two levels of binding. The first level creates the 
global of the factory function, which is modified by the <code>setup</code>
function. That environment is subsequently shared by all objects.
Each object is created by a second level of binding which passes
an argument to the factory function. You can use this to process
multiple texts at once by having a separate paragraph object
for each one.
</p><p></p><p>You should note that if another plugin also loads the paragraph
plugin as shown .. the two instances will be utterly distinct.
Each will have its own copy of the library's global environment.
The code is shared, the data is not. Felix always generates
reentrant code: there are no actual C level global variables.
So use of plugins by threads is safe if each thread creates
is own instance of the plugin.
</p><p></p><p>Of course you can share instances, but to do that you have
to use lower level library functions and pass the relevant
handles around yourself!
</p></div><!--Main Content Body End-->

          </div> <!-- rightpanel contents end -->
          <hr>
        </span> <!-- rightpanel end -->

        <span id="panemover" style="cursor:col-resize;"
         onmousedown="dragStart(event, 'left', 'right'); return false;"
         onmousemove="drag(event, 'left', 'right');"
         onmouseout="dragRelease();"
         onmouseup="dragRelease();"
        >
        </span> <!-- panemover end -->
      </div> <!-- bottom panel end -->
    </div> <!-- container end -->
</body></html>

