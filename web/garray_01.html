<html><head>
<style type="text/css">
body {margin:3%; }
h1 {color:gray; font-size:120%;}
h2 {color:gray; font-size:105%;}
h3 {font-size:100%;}
h4 {font-size:95%;}
h5 {font-size:95%;}
span.fstring {color:darkblue; font-style:italic; }
span.comment {font-family:arial; color:blue; font-style:italic; }
span.doccomment {font-family:arial; color:green; font-style:italic; }
span.big_keyword {color:#FF1010; }
span.small_keyword {color:#802040; }
span.qualifier {color:#A02020; }
span.library {color:#A02000; }
span.ctor {color:#406020; }
span.hack {color:#66DD00; }
span.preproc {color:#005500; }
span.embedded_c{background-color:#DDDDDD; }
span.fpc_fieldname {color:#DD0000; }
span.lineno {color:#101010; background-color:#E0E0E0; font-size:80%; font-family:"courier",monospace; font-style:normal; }
pre.flxbg {background-color:#A0FFA0; color:black; padding:2px; box-shadow:5px 5px 2px #807080; }
pre.uncheckedflxbg {background-color:#D0D0D0; color:black; padding:2px; box-shadow:5px 5px 2px #807080; }
pre.cppbg {background-color:#80FF80; color:black; }
pre.prefmtbg {background-color:#D0D0D0; color:black; }
pre.expected {background-color:#E0FF80; color:black; }
pre.input {background-color:#E08080; color:black; }
pre.inclusion {background-color:#D070D0; color:black; }
code.inclusion {background-color:#D070D0; color:black; }
.obsolete { background-color:#FFEFEF; font-size: small; color:black; }
.future { background-color:#FF8080; font-size: small; color:black; }
.implementation_detail { background-color:#E0E0E0; font-size: small; color:black;  }
.bug { background-color:#FFE0E0; font-size: small; color:black; }
.fixed{ background-color:#FFE0E0; font-size: small; color:black; }
.done { background-color:#FFE0E0; font-size: small; color:black; }
.caveat { background-color:#FF8080; color:black; }
</style>
<title>/Users/skaller/felix/src/web/tut/garray_01.html</title></head><body>
<style>
body {margin:3%; font-family: sans-serif; }
h1 {color:black; font-size:120%; border-bottom: 2px solid #ddd; padding: 0 0 3px 0;}
h2 {color:#202020; font-size:105%;}
h3 {font-size:100%;}
h4 {font-size:95%;}
h5 {font-size:95%;}
span.fstring {color:darkblue; font-style:italic; }
span.comment {font-family:arial; color:blue; font-style:italic; }
span.doccomment {font-family:arial; color:green; font-style:italic; }
span.big_keyword {color:#FF1010; }
span.small_keyword {color:#802040; }
span.qualifier {color:#A02020; }
span.library {color:#A02000; }
span.ctor {color:#406020; }
span.hack {color:#66DD00; }
span.preproc {color:#005500; }
span.embedded_c{background-color:#DDDDDD; }
span.fpc_fieldname {color:#DD0000; }
span.lineno {color:#101010; background-color:#E0E0E0; font-size:80%; font-family:"courier",monospace; font-style:normal; }
pre { border: 1px solid #ccc; color: black; box-shadow:3px 3px 2px rgba(0,0,0,0.1); padding:2px; }
pre.flxbg {background-color:#C2FDC2; box-shadow:3px 3px 2px rgba(0,0,0,0.1) }
pre.uncheckedflxbg {background-color:#eee; box-shadow:3px 3px 2px rgba(0,0,0,0.1); }
pre.cppbg {background-color:#C2FDC2; }
pre.prefmtbg {background-color:#F1F1F1; }
pre.expected {background-color:hsla(74,94%,88%,1); }
pre.input {background-color:hsla(20,94%,88%,1); }
pre.inclusion {
    font-family: Arial;
    font-weight: normal;
    font-size: 0.9em;
    color: #555;
    border: none;
    box-shadow: none;
    text-align: right;
    margin: -7px 11px -12px 0;
    padding: 0;
    background-color:#fafafa;
}
code.inclusion {background-color:#D070D0; color:black; }
.obsolete { background-color:#FFEFEF; font-size: small; color:black; }
.future { background-color:#FF8080; font-size: small; color:black; }
.implementation_detail { background-color:#E0E0E0; font-size: small; color:black;  }
.bug { background-color:#FFE0E0; font-size: small; color:black; }
.fixed{ background-color:#FFE0E0; font-size: small; color:black; }
.done { background-color:#FFE0E0; font-size: small; color:black; }
.caveat { background-color:hsla(0,100%,91%,1); color:black; padding: 0.6em; }
.container {
  position: fixed;
  top:0px;
  left:0px;
  height : 100%;
  width: 100%;
  background-color: grey;
  margin: 0px;
  padding: 0px;
  border-width: 0px;
  color: #404040;
}
.maincontent {
  padding:4px;
  padding-left:8px;
  line-height:1.3em;
  color:#404040; background-color:#fafafa;
}
.maincontent h1 { margin-left:-8px; position: relative; font-family: georgia, serif; font-size: 1.8em; font-weight: normal; }
.maincontent h2 { margin-left:-8px; position: relative; margin-bottom:-5px; }
.maincontent h3 { margin-left:-8px; position: relative; margin-bottom:-5px; }
.maincontent h4 { margin-left:-8px; position: relative; margin-bottom:-5px; }
.maincontent code { color:#902030; }
.toppanel {
  position:absolute; left:0px; top:0px; height:20px; right:0px;
  background-color: #e0e0e0;
}
.bottompanel {
  position:absolute; left:0px; top:22px; bottom:0px; right:0px;
  background-color: #fafafa;
  font-size:14px;
}
.leftpanel {
  position:absolute; left:0px; top:0px; bottom:0px; width: 150px;
  background-color: #eaeaea; overflow: auto;
}
.rightpanel {
  position:absolute; right: 0px; left:160px; top:0px; bottom: 0px;
  background-color: #fafafa; overflow: auto;
}
.divider {
  position:absolute; left: 150px; top:0px; bottom:0px;
  background-color: black; width:2px;
  box-shadow: 0 0 8px #000;
}

#panemover {
    position:absolute;
    left: 150px;
    width : 10px;
    top: 0px;
    bottom: 0px;
    opacity: 0.3;
    cursor:col-resize;
}

div.m {
    margin: 0px;
    padding:0px;
    border-width:2px;
    border-color: green;
}

div.m1 {
    background-color: #86E870;
    border-style:outset;
    border-color:#ccc;
    border-width:2px 0;
    font-size:90%;
    padding: 1px 0 2px 10px;
}

div.m2 {
    background-color: #70C070;
    padding-left:15px;
    padding-top:2px;
    border-style:outset;
    border-color:green;
    border-width:0 0 1px 0;
    font-size:80%;
}

div.m1:hover, div.m2:hover {
    background-color: white;
}

#leftmargintoc a {
    text-decoration: none;
    color: #404040;
}
</style>

<style>
div.m {
    margin: 0px;
    padding:0px;
    border-width:2px;
    border-color: green;
}

div.m1 {
    background-color: #86E870;
    border-style:outset;
    border-color:#ccc;
    border-width:2px 0;
    font-size:90%;
    padding: 1px 0 2px 10px;
}

div.m2 {
    background-color: #70C070;
    padding-left:15px;
    padding-top:2px;
    border-style:outset;
    border-color:green;
    border-width:0 0 1px 0;
    font-size:80%;
}

div.m1:hover, div.m2:hover {
    background-color: white;
}

#leftmargintoc a {
    text-decoration: none;
    color: #404040;
}


</style>

    <script async="true">
      function dragStart(e, left, right){
        document.getElementById("panemover").style.width="70%";
        document.getElementById("panemover").style.left="50px";
        mousedown = true;
        x = e.clientX
        dragOffsetLeft =
          document.getElementById(left).getBoundingClientRect().right -
          document.getElementById(left).getBoundingClientRect().left -
          x
        ;
        dragOffsetDivider= document.getElementById("divider").getBoundingClientRect().left - x;
        dragOffsetRight = document.getElementById(right).getBoundingClientRect().left - x;
      }
      function dragRelease(){
        document.getElementById('panemover').style.width = '10px';
        document.getElementById('panemover').style.left = document.getElementById('divider').offsetLeft + 'px';
        mousedown = false;
      }
      function drag(e, left, right){
        if(!mousedown){return}
        x = e.clientX
        tmpLeft = dragOffsetLeft + x
        tmpDivider= dragOffsetDivider + x
        tmpRight = dragOffsetRight + x
        document.getElementById(left).style.width= tmpLeft + 'px';
        document.getElementById("divider").style.left= tmpDivider + 'px';
        document.getElementById(right).style.left = tmpRight + 'px';
      };
    </script>

<script type="text/javascript">

  function mexpand(id)
  {
    var n = document.getElementById(id).style;
    n.display = "block";
  }

  function mcollapse(id)
  {
    var n = document.getElementById(id).style;
    n.display = "none";
  }

  var counter_max = 0;
  function mshow(id,loc)
  {
    var i;
    for(i=1; i<=counter_max; ++i)
      mcollapse("menu"+String(i));
    mexpand(id);
    window.location.replace(loc);
  }
</script>

<script type="text/javascript">

function expand(but,id)
{
  var n = document.getElementById(id).style;
  var button = document.getElementById(but);
  button.src = "/share/src/web/images/minus.gif";
  button.alt = "-";
  n.display = "block";
}
function collapse(but,id)
{
  var n = document.getElementById(id).style;
  var button = document.getElementById(but);
  button.src = "/share/src/web/images/plus.gif";
  button.alt = "+";
  n.display = "none";
}
function toggle(button,id)
{
  var n = document.getElementById(id).style;
  if (n.display == "none")
  {
    button.src = "/share/src/web/images/minus.gif";
    button.alt = "-";
    n.display = "block";
  }
  else
  {
    button.src = "/share/src/web/images/plus.gif";
    button.alt = "+";
    n.display = "none";
  }
}
var allbuttons = [
"Categorical Types."
];
function expand_all(dummy)
{
  for (i in allbuttons)
  {
    expand(allbuttons[i], allbuttons[i]+"_d");
  }
}
function collapse_all(dummy)
{
  for (i in allbuttons)
  {
    collapse(allbuttons[i], allbuttons[i]+"_d");
  }
}
</script>

<script>
function mouseover(id)
{
  var elt = document.getElementById(id);
  elt.style.display="none";
  var elt2 = document.getElementById(id+"_mo");
  elt2.style.display="inline";
}

function mouseout(id)
{
  var elt = document.getElementById(id+"_mo");
  elt.style.display="none";
  var elt2 = document.getElementById(id);
  elt2.style.display="inline";
}

</script>
<script> function nop(dummy) {} </script>
    <div class="container">
      <div class="toppanel">
    <!--Main Content top navbar-->
<span style="position:relative; bottom:6px"
  onmouseover="mouseover('expand')"
  onmouseout="mouseout('expand')"
  onclick="expand_all('expand')"
  ><span id="expand"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:blue;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Expand</text></svg></span><span id="expand_mo" style="display:none"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:red;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Expand</text></svg></span></span><span style="position:relative; bottom:6px"
  onmouseover="mouseover('collapse')"
  onmouseout="mouseout('collapse')"
  onclick="collapse_all('collapse')"
  ><span id="collapse"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:blue;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Collapse</text></svg></span><span id="collapse_mo" style="display:none"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:red;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Collapse</text></svg></span></span><a href='garray_02.html'><span style="position:relative; bottom:6px"
  onmouseover="mouseover('next')"
  onmouseout="mouseout('next')"
  onclick="nop('next')"
  ><span id="next"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:blue;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Next</text></svg></span><span id="next_mo" style="display:none"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:red;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Next</text></svg></span></span></a> <a href='garray_index.html'><span style="position:relative; bottom:6px"
  onmouseover="mouseover('index')"
  onmouseout="mouseout('index')"
  onclick="nop('index')"
  ><span id="index"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:blue;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Index</text></svg></span><span id="index_mo" style="display:none"><svg height="30px" width="65px"><rect x="4px" y="6px" rx="4px" ry="40px" width="60px" height="20px" style="fill:red;opacity:0.2;stroke:black;stroke-width:2"/><text x="13px" y="21px" fill="black" style="font-size:12px;">Index</text></svg></span></span></a>    <!--Main Content top navbar End-->

      </div> <!-- toppanel end -->
      <div class="bottompanel">
        <span id="divider" class="divider"></span>

        <span id="left" class="leftpanel" >
          <div class="menucontent">
  <!--Left Margin Toc-->
  <div id="leftmargintoc">
    <!--Left Margin Toc Main Contents-->
      <div class=m1 onclick="mshow('menu1','#Categorical Types._h')"> <a href="#Categorical_Types._h">Categorical Types.</a></div>
      <div class=sm id=menu1>
      </div>
    <script>counter_max=1;</script>
  </div>
  <!--End Left Margin Toc-->

          </div> <!-- leftpanel contents end -->
        </span> <!-- leftpanel end -->

        <span id="right" class="rightpanel">
          <div class="maincontent">
<!--Main Content Body-->
<h1 id='Categorical_Types._h'><img src='/share/src/web/images/minus.gif' id='Categorical Types.' onclick='toggle(this,"Categorical_Types._d")' alt='+'/> 1.1 Categorical Types.</h1><div id='Categorical_Types._d' style='display:block'>
<p>Before we can venture into the arena of Felix generalised array
support we need to review some basic category theory.
</p><p>We need to understand two basic type constructors: products and sums.
Products are well understood by all programmers. In math we
speak of <em>Cartesian Product</em> such as <em>R * R</em> representing
a plane in a Euclidean geometry, where <em>R</em> is of course the
real number line.
</p><p>In Felix, we just call these things tuples:
</p><p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Define a mutable variable">var</span> tup : <span class="library" title="binding of C++ string type">string</span> * <span class="library" title="binding of C int type">int</span> * <span class="library" title="binding of C double float type">double</span> = <span class="fstring">"Hello"</span>, 42, 3.141;
</pre></p><p>using a chain of {*} for non-associative n-ary product type
formation, and {,} for the corresponding value construction.
An integer constant can be used to denote a projection
function, which extracts one of the components.
</p><p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Define a mutable variable">var</span> c0 : <span class="library" title="binding of C++ string type">string</span> = 0 tup;
<span class="lineno" id=line2></span>  <span class="big_keyword" title="Define a mutable variable">var</span> c1 : <span class="library" title="binding of C int type">int</span> = tup . 1;
</pre></p><p>The reverse application operator {.} makes the second form
more intuitive. Projection functions are sometimes
called <em>fields</em>.
 
Such types are said to be structural because they do not
have a specified unique name but are identified by their shape:
Felix also has a nominally typed product, the usual C <code>struct</code>.
The theory is simpler with structural typing so we will stick
to that here.
</p><p>Much less understood by programmers is the sum or variant type.
Whilst a product may be thought of as "all of these things aggregated",
a sum type is "pick one of these things". It is the type of choices,
conditionals, and switched control flow.
</p><p>The best known sum type is the humble enumeration, and the best
understood enumeration is called <code>bool</code>. It is a type of two
choices: <code>false</code> or <code>true</code>.
</p><p>For structurally typed enumerations, we just use an integer constant
to denote the type:
</p><p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="small_keyword" title="end of extension">begin</span>
<span class="lineno" id=line2></span>    <span class="big_keyword" title="Define a mutable variable">var</span> f : 2 = <span class="small_keyword" title="Sum type selector">case</span> 0 of 2; <span class="comment">// aka false</span>
<span class="lineno" id=line3></span>    <span class="big_keyword" title="Define a mutable variable">var</span> t : 2 = <span class="small_keyword" title="Sum type selector">case</span> 1 of 2; <span class="comment">// aka true</span>
<span class="lineno" id=line4></span>  <span class="small_keyword" title="end of extension">end</span>
</pre></p><p>which is identical to the more familiar:
</p><p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="small_keyword" title="end of extension">begin</span>
<span class="lineno" id=line2></span>    <span class="big_keyword" title="Define a mutable variable">var</span> f : bool = <span class="library" title="false value">false</span>; <span class="comment">// aka false</span>
<span class="lineno" id=line3></span>    <span class="big_keyword" title="Define a mutable variable">var</span> t : bool = <span class="library" title="truth value">true</span>; <span class="comment">// aka true</span>
<span class="lineno" id=line4></span>  <span class="small_keyword" title="end of extension">end</span>
</pre></p><p>The <code>case</code> notation is a bit ugly, and it seems unnatural
to number cases from 0 upto {n-1} with zero origin notation,
but we have chosen that for consistency with tuple notation
and C.
</p><p>A more general sum type is shown below:
</p><p><pre class='flxbg'><span class="lineno" id=line1></span>  <span class="big_keyword" title="Define a mutable variable">var</span> s : <span class="library" title="binding of C++ string type">string</span> + <span class="library" title="binding of C int type">int</span> + <span class="library" title="binding of C double float type">double</span> = 
<span class="lineno" id=line2></span>    (<span class="small_keyword" title="Sum type selector">case</span> 0 of <span class="library" title="binding of C++ string type">string</span> + <span class="library" title="binding of C int type">int</span> + <span class="library" title="binding of C double float type">double</span>) <span class="fstring">"Hello"</span>
<span class="lineno" id=line3></span>  ;
<span class="lineno" id=line4></span>  
<span class="lineno" id=line5></span>  <span class="big_keyword" title="Define a procedure, a function with side-effects not returning a value">proc</span> p(x: <span class="library" title="binding of C++ string type">string</span> + <span class="library" title="binding of C int type">int</span> + <span class="library" title="binding of C double float type">double</span>) {
<span class="lineno" id=line6></span>    <span class="small_keyword" title="match statement or expression">match</span> x <span class="small_keyword" title="type-class constraint">with</span>
<span class="lineno" id=line7></span>    | <span class="small_keyword" title="Sum type selector">case</span> 0 x =&gt; <span class="library" title="Print a string to standard output with newline appended">println</span>$ x+<span class="fstring">" world"</span>;
<span class="lineno" id=line8></span>    | <span class="small_keyword" title="Sum type selector">case</span> 1 x =&gt; <span class="library" title="Print a string to standard output with newline appended">println</span>$ x+1;
<span class="lineno" id=line9></span>    | <span class="small_keyword" title="Sum type selector">case</span> 2 x =&gt; <span class="library" title="Print a string to standard output with newline appended">println</span>$ x+2.2;
<span class="lineno" id=line10></span>    <span class="small_keyword" title="end a match statement or expression">endmatch</span>;
<span class="lineno" id=line11></span>  }
<span class="lineno" id=line12></span>  
<span class="lineno" id=line13></span>  p s;
<span class="lineno" id=line14></span>  s = (<span class="small_keyword" title="Sum type selector">case</span> 1 of <span class="library" title="binding of C++ string type">string</span> + <span class="library" title="binding of C int type">int</span> + <span class="library" title="binding of C double float type">double</span>) 42;
<span class="lineno" id=line15></span>  p s;
<span class="lineno" id=line16></span>  s = (<span class="small_keyword" title="Sum type selector">case</span> 2 of <span class="library" title="binding of C++ string type">string</span> + <span class="library" title="binding of C int type">int</span> + <span class="library" title="binding of C double float type">double</span>) 3.141;
<span class="lineno" id=line17></span>  p s;
</pre></p><p>Here you see three cases which carry data of a specific type.
You use pattern matching to discover which of the three possible
cases is carried and then safely access that type.
</p><p>The case value thing is called a type constructor because
it takes a value of one of the components of a sum type and creates a
value of the sum type. This is the way to unify or homogenise 
heterogenous types. Note in the pattern matching we don't need
to specify the type, only the case tag (index value).
</p><p>Unlike products which are constructive types charactised by the
projection functions that inspect them, sums are destructive types
characterised by the injection functions that build them:
namely the type constructors.
</p></div><!--Main Content Body End-->

          </div> <!-- rightpanel contents end -->
          <hr>
        </span> <!-- rightpanel end -->

        <span id="panemover" style="cursor:col-resize;"
         onmousedown="dragStart(event, 'left', 'right'); return false;"
         onmousemove="drag(event, 'left', 'right');"
         onmouseout="dragRelease();"
         onmouseup="dragRelease();"
        >
        </span> <!-- panemover end -->
      </div> <!-- bottom panel end -->
    </div> <!-- container end -->
</body></html>

